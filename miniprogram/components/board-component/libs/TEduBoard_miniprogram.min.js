!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TEduBoard=e():t.TEduBoard=e()}(window,function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(o,i,function(e){return t[e]}.bind(null,i));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e,r){t.exports=function(t){function e(o){if(r[o])return r[o].exports;var i=r[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="D:\\github\\cos-wx-sdk-v5\\demo\\lib",e(e.s=4)}([function(t,e,r){"use strict";function o(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}function i(t){return l(t,function(t){return"object"==typeof t?i(t):t})}function n(t,e){return s(e,function(r,o){t[o]=e[o]}),t}function a(t){return t instanceof Array}function s(t,e){for(var r in t)t.hasOwnProperty(r)&&e(t[r],r)}function l(t,e){var r=a(t)?[]:{};for(var o in t)t.hasOwnProperty(o)&&(r[o]=e(t[o],o));return r}var c=r(8),u=r(6),d=r(10),h=r(7),p=r(5).btoa,f=function(){},g=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&null!==t[r]&&(e[r]=t[r]);return e},m=function(t,e){if(e=n({},e),"getAuth"!==t&&"getV4Auth"!==t&&"getObjectUrl"!==t){var r=e.Headers||{};e&&"object"==typeof e&&(function(){for(var t in e)e.hasOwnProperty(t)&&t.indexOf("x-cos-")>-1&&(r[t]=e[t])}(),y.each({"x-cos-mfa":"MFA","Content-MD5":"ContentMD5","Content-Length":"ContentLength","Content-Type":"ContentType",Expect:"Expect",Expires:"Expires","Cache-Control":"CacheControl","Content-Disposition":"ContentDisposition","Content-Encoding":"ContentEncoding",Range:"Range","If-Modified-Since":"IfModifiedSince","If-Unmodified-Since":"IfUnmodifiedSince","If-Match":"IfMatch","If-None-Match":"IfNoneMatch","x-cos-copy-source":"CopySource","x-cos-copy-source-Range":"CopySourceRange","x-cos-metadata-directive":"MetadataDirective","x-cos-copy-source-If-Modified-Since":"CopySourceIfModifiedSince","x-cos-copy-source-If-Unmodified-Since":"CopySourceIfUnmodifiedSince","x-cos-copy-source-If-Match":"CopySourceIfMatch","x-cos-copy-source-If-None-Match":"CopySourceIfNoneMatch","x-cos-acl":"ACL","x-cos-grant-read":"GrantRead","x-cos-grant-write":"GrantWrite","x-cos-grant-full-control":"GrantFullControl","x-cos-grant-read-acp":"GrantReadAcp","x-cos-grant-write-acp":"GrantWriteAcp","x-cos-storage-class":"StorageClass","x-cos-server-side-encryption-customer-algorithm":"SSECustomerAlgorithm","x-cos-server-side-encryption-customer-key":"SSECustomerKey","x-cos-server-side-encryption-customer-key-MD5":"SSECustomerKeyMD5","x-cos-server-side-encryption":"ServerSideEncryption","x-cos-server-side-encryption-cos-kms-key-id":"SSEKMSKeyId","x-cos-server-side-encryption-context":"SSEContext"},function(t,o){void 0!==e[t]&&(r[o]=e[t])}),e.Headers=g(r))}return e},_=function(t){return Date.now()+(t||0)},y={noop:f,formatParams:m,apiWrapper:function(t,e){return function(r,o){"function"==typeof r&&(o=r,r={}),r=m(t,r);var i=function(t){return t&&t.headers&&(t.headers["x-cos-version-id"]&&(t.VersionId=t.headers["x-cos-version-id"]),t.headers["x-cos-delete-marker"]&&(t.DeleteMarker=t.headers["x-cos-delete-marker"])),t},n=function(t,e){o&&o(i(t),i(e))};if("getService"!==t&&"abortUploadTask"!==t){var a;if(a=function(t,e){var r=e.Bucket,o=e.Region,i=e.Key;if(t.indexOf("Bucket")>-1||"deleteMultipleObject"===t||"multipartList"===t||"listObjectVersions"===t){if(!r)return"Bucket";if(!o)return"Region"}else if(t.indexOf("Object")>-1||t.indexOf("multipart")>-1||"sliceUploadFile"===t||"abortUploadTask"===t){if(!r)return"Bucket";if(!o)return"Region";if(!i)return"Key"}return!1}(t,r))return void n({error:"missing param "+a});if(r.Region){if(r.Region.indexOf("cos.")>-1)return void n({error:'param Region should not be start with "cos."'});if(!/^([a-z\d-]+)$/.test(r.Region))return void n({error:"Region format error."});this.options.CompatibilityMode||-1!==r.Region.indexOf("-")||"yfb"===r.Region||r.Region}if(r.Bucket){if(!/^([a-z\d-]+)-(\d+)$/.test(r.Bucket))if(r.AppId)r.Bucket=r.Bucket+"-"+r.AppId;else{if(!this.options.AppId)return void n({error:'Bucket should format as "test-1250000000".'});r.Bucket=r.Bucket+"-"+this.options.AppId}r.AppId&&delete r.AppId}}var s=e.call(this,r,n);if("getAuth"===t||"getObjectUrl"===t)return s}},xml2json:d,json2xml:h,md5:c,clearKey:g,getFileMd5:function(t,e){!function(t,e){var r,o=new FileReader;FileReader.prototype.readAsBinaryString?(r=FileReader.prototype.readAsBinaryString,o.onload=function(){e(this.result)}):FileReader.prototype.readAsArrayBuffer&&(r=function(t){var r="",o=new FileReader;o.onload=function(t){for(var i=new Uint8Array(o.result),n=i.byteLength,a=0;a<n;a++)r+=String.fromCharCode(i[a]);e(r)},o.readAsArrayBuffer(t)}),r.call(o,t)}(t,function(t){var r=c(t,!0);e(null,r)})},binaryBase64:function(t){var e,r,o,i="";for(e=0,r=t.length/2;e<r;e++)o=parseInt(t[2*e]+t[2*e+1],16),i+=String.fromCharCode(o);return p(i)},extend:n,isArray:a,isInArray:function(t,e){for(var r=!1,o=0;o<t.length;o++)if(e===t[o]){r=!0;break}return r},each:s,map:l,filter:function(t,e){var r=a(t),o=r?[]:{};for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)&&(r?o.push(t[i]):o[i]=t[i]);return o},clone:i,uuid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},camSafeUrlEncode:o,throttleOnProgress:function(t,e){function r(){if(i=0,e&&"function"==typeof e){o=Date.now();var r,n=Math.max(0,Math.round((s-a)/((o-l)/1e3)*100)/100);r=0===s&&0===t?1:Math.round(s/t*100)/100||0,l=o,a=s;try{e({loaded:s,total:t,speed:n,percent:r})}catch(t){}}}var o,i,n=this,a=0,s=0,l=Date.now();return function(e,o){if(e&&(s=e.loaded,t=e.total),o)clearTimeout(i),r();else{if(i)return;i=setTimeout(r,n.options.ProgressInterval)}}},getFileSize:function(t,e,r){var o;"string"==typeof e.Body&&(e.Body=new Blob([e.Body],{type:"text/plain"})),e.Body&&(e.Body instanceof Blob||"[object File]"===e.Body.toString()||"[object Blob]"===e.Body.toString())?(o=e.Body.size,e.ContentLength=o,r(null,o)):r({error:"params body format error, Only allow File|Blob|String."})},getSkewTime:_,getAuth:function(t){var e=(t=t||{}).SecretId,r=t.SecretKey,n=(t.method||t.Method||"get").toLowerCase(),a=i(t.Query||t.params||{}),s=i(t.Headers||t.headers||{}),l=t.Pathname||"/"+(t.Key||"");if(e&&r){var c=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e.sort(function(t,e){return(t=t.toLowerCase())===(e=e.toLowerCase())?0:t>e?1:-1})},d=function(t){var e,r,i,n=[],a=c(t);for(e=0;e<a.length;e++)i=void 0===t[r=a[e]]||null===t[r]?"":""+t[r],r=o(r=r.toLowerCase()),i=o(i)||"",n.push(r+"="+i);return n.join("&")},h=Math.round(_(t.SystemClockOffset)/1e3)-1,p=h,f=t.Expires||t.expires,g=e,m=h+";"+(p+=void 0===f?900:1*f||0),y=h+";"+p,b=c(s).join(";").toLowerCase(),T=c(a).join(";").toLowerCase(),C=u.HmacSHA1(y,r).toString(),E=[n,l,d(a),d(s),""].join("\n"),v=["sha1",m,u.SHA1(E).toString(),""].join("\n");return["q-sign-algorithm=sha1","q-ak="+g,"q-sign-time="+m,"q-key-time="+y,"q-header-list="+b,"q-url-param-list="+T,"q-signature="+u.HmacSHA1(v,C).toString()].join("&")}},isBrowser:!0,fileSlice:function(t,e,r){return t.slice?t.slice(e,r):t.mozSlice?t.mozSlice(e,r):t.webkitSlice?t.webkitSlice(e,r):void 0},getFileUUID:function(t,e){return t.name&&t.size&&t.lastModifiedDate&&e?y.md5([t.name,t.size,t.lastModifiedDate,e].join("::")):null},getBodyMd5:function(t,e,r){r=r||f,t&&"string"==typeof e?r(y.md5(e,!0)):r()}};t.exports=y},function(t,e){function r(t,e){for(var r in t)e[r]=t[r]}function o(t,e){function o(){}var i=t.prototype;if(Object.create){var n=Object.create(e.prototype);i.__proto__=n}i instanceof e||(o.prototype=e.prototype,r(i,o=new o),t.prototype=i=o),i.constructor!=t&&(i.constructor=t)}function i(t,e){if(e instanceof Error)var r=e;else r=this,Error.call(this,Q[t]),this.message=Q[t],Error.captureStackTrace&&Error.captureStackTrace(this,i);return r.code=t,e&&(this.message=this.message+": "+e),r}function n(){}function a(t,e){this._node=t,this._refresh=e,s(this)}function s(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var o=t._refresh(t._node);M(t,"length",o.length),r(o,t),t._inc=e}}function l(){}function c(t,e){for(var r=t.length;r--;)if(t[r]===e)return r}function u(t,e,r,o){if(o?e[c(e,o)]=r:e[e.length++]=r,t){r.ownerElement=t;var i=t.ownerDocument;i&&(o&&_(i,t,o),function(t,e,r){i&&i._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(e._nsMap[r.prefix?r.localName:""]=r.value)}(0,t,r))}}function d(t,e,r){var o=c(e,r);if(!(o>=0))throw i(et,new Error(t.tagName+"@"+r));for(var n=e.length-1;o<n;)e[o]=e[++o];if(e.length=n,t){var a=t.ownerDocument;a&&(_(a,t,r),r.ownerElement=null)}}function h(t){if(this._features={},t)for(var e in t)this._features=t[e]}function p(){}function f(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function g(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(g(t,e))return!0}while(t=t.nextSibling)}function m(){}function _(t,e,r,o){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete e._nsMap[r.prefix?r.localName:""]}function y(t,e,r){if(t&&t._inc){t._inc++;var o=e.childNodes;if(r)o[o.length++]=r;else{for(var i=e.firstChild,n=0;i;)o[n++]=i,i=i.nextSibling;o.length=n}}}function b(t,e){var r=e.previousSibling,o=e.nextSibling;return r?r.nextSibling=o:t.firstChild=o,o?o.previousSibling=r:t.lastChild=r,y(t.ownerDocument,t),e}function T(t,e,r){var o=e.parentNode;if(o&&o.removeChild(e),e.nodeType===X){var i=e.firstChild;if(null==i)return e;var n=e.lastChild}else i=n=e;var a=r?r.previousSibling:t.lastChild;i.previousSibling=a,n.nextSibling=r,a?a.nextSibling=i:t.firstChild=i,null==r?t.lastChild=n:r.previousSibling=n;do{i.parentNode=t}while(i!==n&&(i=i.nextSibling));return y(t.ownerDocument||t,t),e.nodeType==X&&(e.firstChild=e.lastChild=null),e}function C(){this._nsMap={}}function E(){}function v(){}function S(){}function D(){}function A(){}function x(){}function O(){}function B(){}function I(){}function R(){}function P(){}function w(){}function N(t,e){var r=[],o=9==this.nodeType?this.documentElement:this,i=o.prefix,n=o.namespaceURI;if(n&&null==i&&null==(i=o.lookupPrefix(n)))var a=[{namespace:n,prefix:null}];return q(this,r,t,e,a),r.join("")}function L(t,e,r){var o=t.prefix||"",i=t.namespaceURI;if(!o&&!i)return!1;if("xml"===o&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var n=r.length;n--;){var a=r[n];if(a.prefix==o)return a.namespace!=i}return!0}function q(t,e,r,o,i){if(o){if(!(t=o(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case U:i||(i=[]);var n=(i.length,t.attributes),a=n.length,s=t.firstChild,l=t.tagName;r=k===t.namespaceURI||r,e.push("<",l);for(var c=0;c<a;c++){"xmlns"==(u=n.item(c)).prefix?i.push({prefix:u.localName,namespace:u.value}):"xmlns"==u.nodeName&&i.push({prefix:"",namespace:u.value})}for(c=0;c<a;c++){var u;if(L(u=n.item(c),0,i)){var d=u.prefix||"",h=u.namespaceURI,p=d?" xmlns:"+d:" xmlns";e.push(p,'="',h,'"'),i.push({prefix:d,namespace:h})}q(u,e,r,o,i)}if(L(t,0,i)){d=t.prefix||"",h=t.namespaceURI,p=d?" xmlns:"+d:" xmlns";e.push(p,'="',h,'"'),i.push({prefix:d,namespace:h})}if(s||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(e.push(">"),r&&/^script$/i.test(l))for(;s;)s.data?e.push(s.data):q(s,e,r,o,i),s=s.nextSibling;else for(;s;)q(s,e,r,o,i),s=s.nextSibling;e.push("</",l,">")}else e.push("/>");return;case $:case X:for(s=t.firstChild;s;)q(s,e,r,o,i),s=s.nextSibling;return;case G:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,f),'"');case H:return e.push(t.data.replace(/[<&]/g,f));case j:return e.push("<![CDATA[",t.data,"]]>");case Y:return e.push("\x3c!--",t.data,"--\x3e");case V:var g=t.publicId,m=t.systemId;if(e.push("<!DOCTYPE ",t.name),g)e.push(' PUBLIC "',g),m&&"."!=m&&e.push('" "',m),e.push('">');else if(m&&"."!=m)e.push(' SYSTEM "',m,'">');else{var _=t.internalSubset;_&&e.push(" [",_,"]"),e.push(">")}return;case z:return e.push("<?",t.target," ",t.data,"?>");case K:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function M(t,e,r){t[e]=r}var k="http://www.w3.org/1999/xhtml",F={},U=F.ELEMENT_NODE=1,G=F.ATTRIBUTE_NODE=2,H=F.TEXT_NODE=3,j=F.CDATA_SECTION_NODE=4,K=F.ENTITY_REFERENCE_NODE=5,W=F.ENTITY_NODE=6,z=F.PROCESSING_INSTRUCTION_NODE=7,Y=F.COMMENT_NODE=8,$=F.DOCUMENT_NODE=9,V=F.DOCUMENT_TYPE_NODE=10,X=F.DOCUMENT_FRAGMENT_NODE=11,J=F.NOTATION_NODE=12,Z={},Q={},tt=(Z.INDEX_SIZE_ERR=(Q[1]="Index size error",1),Z.DOMSTRING_SIZE_ERR=(Q[2]="DOMString size error",2),Z.HIERARCHY_REQUEST_ERR=(Q[3]="Hierarchy request error",3)),et=(Z.WRONG_DOCUMENT_ERR=(Q[4]="Wrong document",4),Z.INVALID_CHARACTER_ERR=(Q[5]="Invalid character",5),Z.NO_DATA_ALLOWED_ERR=(Q[6]="No data allowed",6),Z.NO_MODIFICATION_ALLOWED_ERR=(Q[7]="No modification allowed",7),Z.NOT_FOUND_ERR=(Q[8]="Not found",8)),rt=(Z.NOT_SUPPORTED_ERR=(Q[9]="Not supported",9),Z.INUSE_ATTRIBUTE_ERR=(Q[10]="Attribute in use",10));Z.INVALID_STATE_ERR=(Q[11]="Invalid state",11),Z.SYNTAX_ERR=(Q[12]="Syntax error",12),Z.INVALID_MODIFICATION_ERR=(Q[13]="Invalid modification",13),Z.NAMESPACE_ERR=(Q[14]="Invalid namespace",14),Z.INVALID_ACCESS_ERR=(Q[15]="Invalid access",15),i.prototype=Error.prototype,r(Z,i),n.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var r=[],o=0;o<this.length;o++)q(this[o],r,t,e);return r.join("")}},a.prototype.item=function(t){return s(this),this[t]},o(a,n),l.prototype={length:0,item:n.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var r=this[e];if(r.nodeName==t)return r}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new i(rt);var r=this.getNamedItem(t.nodeName);return u(this._ownerElement,this,t,r),r},setNamedItemNS:function(t){var e,r=t.ownerElement;if(r&&r!=this._ownerElement)throw new i(rt);return e=this.getNamedItemNS(t.namespaceURI,t.localName),u(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return d(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var r=this.getNamedItemNS(t,e);return d(this._ownerElement,this,r),r},getNamedItemNS:function(t,e){for(var r=this.length;r--;){var o=this[r];if(o.localName==e&&o.namespaceURI==t)return o}return null}},h.prototype={hasFeature:function(t,e){var r=this._features[t.toLowerCase()];return!(!r||e&&!(e in r))},createDocument:function(t,e,r){var o=new m;if(o.implementation=this,o.childNodes=new n,o.doctype=r,r&&o.appendChild(r),e){var i=o.createElementNS(t,e);o.appendChild(i)}return o},createDocumentType:function(t,e,r){var o=new x;return o.name=t,o.nodeName=t,o.publicId=e,o.systemId=r,o}},p.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return T(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return b(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,r,o){var i=new r.constructor;for(var a in r){var s=r[a];"object"!=typeof s&&s!=i[a]&&(i[a]=s)}switch(r.childNodes&&(i.childNodes=new n),i.ownerDocument=e,i.nodeType){case U:var c=r.attributes,u=i.attributes=new l,d=c.length;u._ownerElement=i;for(var h=0;h<d;h++)i.setAttributeNode(t(e,c.item(h),!0));break;case G:o=!0}if(o)for(var p=r.firstChild;p;)i.appendChild(t(e,p,o)),p=p.nextSibling;return i}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==H&&t.nodeType==H?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var r=e._nsMap;if(r)for(var o in r)if(r[o]==t)return o;e=e.nodeType==G?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var r=e._nsMap;if(r&&t in r)return r[t];e=e.nodeType==G?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},r(F,p),r(F,p.prototype),m.prototype={nodeName:"#document",nodeType:$,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==X){for(var r=t.firstChild;r;){var o=r.nextSibling;this.insertBefore(r,e),r=o}return t}return null==this.documentElement&&t.nodeType==U&&(this.documentElement=t),T(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),b(this,t)},importNode:function(t,e){return function t(e,r,o){var i;switch(r.nodeType){case U:(i=r.cloneNode(!1)).ownerDocument=e;case X:break;case G:o=!0}if(i||(i=r.cloneNode(!1)),i.ownerDocument=e,i.parentNode=null,o)for(var n=r.firstChild;n;)i.appendChild(t(e,n,o)),n=n.nextSibling;return i}(this,t,e)},getElementById:function(t){var e=null;return g(this.documentElement,function(r){if(r.nodeType==U&&r.getAttribute("id")==t)return e=r,!0}),e},createElement:function(t){var e=new C;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new n,(e.attributes=new l)._ownerElement=e,e},createDocumentFragment:function(){var t=new R;return t.ownerDocument=this,t.childNodes=new n,t},createTextNode:function(t){var e=new S;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new D;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new A;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var r=new P;return r.ownerDocument=this,r.tagName=r.target=t,r.nodeValue=r.data=e,r},createAttribute:function(t){var e=new E;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new I;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var r=new C,o=e.split(":"),i=r.attributes=new l;return r.childNodes=new n,r.ownerDocument=this,r.nodeName=e,r.tagName=e,r.namespaceURI=t,2==o.length?(r.prefix=o[0],r.localName=o[1]):r.localName=e,i._ownerElement=r,r},createAttributeNS:function(t,e){var r=new E,o=e.split(":");return r.ownerDocument=this,r.nodeName=e,r.name=e,r.namespaceURI=t,r.specified=!0,2==o.length?(r.prefix=o[0],r.localName=o[1]):r.localName=e,r}},o(m,p),C.prototype={nodeType:U,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var r=this.ownerDocument.createAttribute(t);r.value=r.nodeValue=""+e,this.setAttributeNode(r)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===X?this.insertBefore(t,null):function(t,e){var r=e.parentNode;if(r){var o=t.lastChild;r.removeChild(e);o=t.lastChild}o=t.lastChild;return e.parentNode=t,e.previousSibling=o,e.nextSibling=null,o?o.nextSibling=e:t.firstChild=e,t.lastChild=e,y(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);r&&this.removeAttributeNode(r)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);return r&&r.value||""},setAttributeNS:function(t,e,r){var o=this.ownerDocument.createAttributeNS(t,e);o.value=o.nodeValue=""+r,this.setAttributeNode(o)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new a(this,function(e){var r=[];return g(e,function(o){o===e||o.nodeType!=U||"*"!==t&&o.tagName!=t||r.push(o)}),r})},getElementsByTagNameNS:function(t,e){return new a(this,function(r){var o=[];return g(r,function(i){i===r||i.nodeType!==U||"*"!==t&&i.namespaceURI!==t||"*"!==e&&i.localName!=e||o.push(i)}),o})}},m.prototype.getElementsByTagName=C.prototype.getElementsByTagName,m.prototype.getElementsByTagNameNS=C.prototype.getElementsByTagNameNS,o(C,p),E.prototype.nodeType=G,o(E,p),v.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(Q[tt])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,r){r=this.data.substring(0,t)+r+this.data.substring(t+e),this.nodeValue=this.data=r,this.length=r.length}},o(v,p),S.prototype={nodeName:"#text",nodeType:H,splitText:function(t){var e=this.data,r=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var o=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(o,this.nextSibling),o}},o(S,v),D.prototype={nodeName:"#comment",nodeType:Y},o(D,v),A.prototype={nodeName:"#cdata-section",nodeType:j},o(A,v),x.prototype.nodeType=V,o(x,p),O.prototype.nodeType=J,o(O,p),B.prototype.nodeType=W,o(B,p),I.prototype.nodeType=K,o(I,p),R.prototype.nodeName="#document-fragment",R.prototype.nodeType=X,o(R,p),P.prototype.nodeType=z,o(P,p),w.prototype.serializeToString=function(t,e,r){return N.call(t,e,r)},p.prototype.toString=N;try{Object.defineProperty&&(Object.defineProperty(a.prototype,"length",{get:function(){return s(this),this.$$length}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return function t(e){switch(e.nodeType){case U:case X:var r=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&r.push(t(e)),e=e.nextSibling;return r.join("");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case U:case X:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),M=function(t,e,r){t["$$"+e]=r})}catch(t){}e.DOMImplementation=h,e.XMLSerializer=w},function(t,e){var r=function(t){var e={},r=function(t){return!e[t]&&(e[t]=[]),e[t]};t.on=function(t,e){r(t).push(e)},t.off=function(t,e){for(var o=r(t),i=o.length-1;i>=0;i--)e===o[i]&&o.splice(i,1)},t.emit=function(t,e){for(var o=r(t).map(function(t){return t}),i=0;i<o.length;i++)o[i](e)}};t.exports.init=r,t.exports.EventProxy=function(){r(this)}},function(t,e,r){"use strict";var o=r(0),i=r(2),n=r(16),a=r(15),s=r(13),l={SecretId:"",SecretKey:"",XCosSecurityToken:"",FileParallelLimit:3,ChunkParallelLimit:3,ChunkSize:1048576,SliceSize:1048576,CopyChunkParallelLimit:20,CopyChunkSize:10485760,CopySliceSize:10485760,MaxPartNumber:1e4,ProgressInterval:1e3,UploadQueueSize:1e4,Domain:"",ServiceDomain:"",Protocol:"",CompatibilityMode:!1,ForcePathStyle:!1,CorrectClockSkew:!0,SystemClockOffset:0},c=function(t){this.options=o.extend(o.clone(l),t||{}),this.options.FileParallelLimit=Math.max(1,this.options.FileParallelLimit),this.options.ChunkParallelLimit=Math.max(1,this.options.ChunkParallelLimit),this.options.ChunkRetryTimes=Math.max(0,this.options.ChunkRetryTimes),this.options.ChunkSize=Math.max(1048576,this.options.ChunkSize),this.options.CopyChunkParallelLimit=Math.max(1,this.options.CopyChunkParallelLimit),this.options.CopyChunkSize=Math.max(1048576,this.options.CopyChunkSize),this.options.CopySliceSize=Math.max(0,this.options.CopySliceSize),this.options.MaxPartNumber=Math.max(1024,Math.min(1e4,this.options.MaxPartNumber)),this.options.Timeout=Math.max(0,this.options.Timeout),this.options.AppId,i.init(this),n.init(this)};a.init(c,n),s.init(c,n),c.getAuthorization=o.getAuth,c.version="0.7.3",t.exports=c},function(t,e,r){var o=r(3);t.exports=o},function(t,e){var r=function(t){var e=(t=t||{}).Base64,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(t){for(var e={},r=0,o=t.length;r<o;r++)e[t.charAt(r)]=r;return e}(r),i=String.fromCharCode,n=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?i(192|e>>>6)+i(128|63&e):i(224|e>>>12&15)+i(128|e>>>6&63)+i(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return i(240|e>>>18&7)+i(128|e>>>12&63)+i(128|e>>>6&63)+i(128|63&e)},a=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,s=function(t){return t.replace(a,n)},l=function(t){var e=[0,2,1][t.length%3],o=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[r.charAt(o>>>18),r.charAt(o>>>12&63),e>=2?"=":r.charAt(o>>>6&63),e>=1?"=":r.charAt(63&o)].join("")},c=t.btoa?function(e){return t.btoa(e)}:function(t){return t.replace(/[\s\S]{1,3}/g,l)},u=function(t){return c(s(t))},d=function(t,e){return e?u(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):u(String(t))},h=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),p=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return i(55296+(e>>>10))+i(56320+(1023&e));case 3:return i((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return i((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},f=function(t){return t.replace(h,p)},g=function(t){var e=t.length,r=e%4,n=(e>0?o[t.charAt(0)]<<18:0)|(e>1?o[t.charAt(1)]<<12:0)|(e>2?o[t.charAt(2)]<<6:0)|(e>3?o[t.charAt(3)]:0),a=[i(n>>>16),i(n>>>8&255),i(255&n)];return a.length-=[0,0,2,1][r],a.join("")},m=t.atob?function(e){return t.atob(e)}:function(t){return t.replace(/[\s\S]{1,4}/g,g)},_=function(t){return function(t){return f(m(t))}(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};return{VERSION:"2.1.9",atob:m,btoa:c,fromBase64:_,toBase64:d,utob:s,encode:d,encodeURI:function(t){return d(t,!0)},btou:f,decode:_,noConflict:function(){var r=t.Base64;return t.Base64=e,r}}}();t.exports=r},function(t,e){var r=r||function(t,e){var r={},o=r.lib={},i=function(){},n=o.Base={extend:function(t){i.prototype=this;var e=new i;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=n.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,r=t.words,o=this.sigBytes;if(t=t.sigBytes,this.clamp(),o%4)for(var i=0;i<t;i++)e[o+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(o+i)%4*8;else if(65535<r.length)for(i=0;i<t;i+=4)e[o+i>>>2]=r[i>>>2];else e.push.apply(e,r);return this.sigBytes+=t,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=n.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var r=[],o=0;o<e;o+=4)r.push(4294967296*t.random()|0);return new a.init(r,e)}}),s=r.enc={},l=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],o=0;o<t;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o+=2)r[o>>>3]|=parseInt(t.substr(o,2),16)<<24-o%8*4;return new a.init(r,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],o=0;o<t;o++)r.push(String.fromCharCode(e[o>>>2]>>>24-o%4*8&255));return r.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o++)r[o>>>2]|=(255&t.charCodeAt(o))<<24-o%4*8;return new a.init(r,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=o.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r=this._data,o=r.words,i=r.sigBytes,n=this.blockSize,s=i/(4*n);if(e=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*n,i=t.min(4*e,i),e){for(var l=0;l<e;l+=n)this._doProcessBlock(o,l);l=o.splice(0,e),r.sigBytes-=i}return new a.init(l,i)},clone:function(){var t=n.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});o.Hasher=d.extend({cfg:n.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new h.HMAC.init(t,r).finalize(e)}}});var h=r.algo={};return r}(Math);!function(){var t=r,e=(n=t.lib).WordArray,o=n.Hasher,i=[],n=t.algo.SHA1=o.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,o=r[0],n=r[1],a=r[2],s=r[3],l=r[4],c=0;80>c;c++){if(16>c)i[c]=0|t[e+c];else{var u=i[c-3]^i[c-8]^i[c-14]^i[c-16];i[c]=u<<1|u>>>31}u=(o<<5|o>>>27)+l+i[c],u=20>c?u+(1518500249+(n&a|~n&s)):40>c?u+(1859775393+(n^a^s)):60>c?u+((n&a|n&s|a&s)-1894007588):u+((n^a^s)-899497514),l=s,s=a,a=n<<30|n>>>2,n=o,o=u}r[0]=r[0]+o|0,r[1]=r[1]+n|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return e[o>>>5]|=128<<24-o%32,e[14+(o+64>>>9<<4)]=Math.floor(r/4294967296),e[15+(o+64>>>9<<4)]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=o._createHelper(n),t.HmacSHA1=o._createHmacHelper(n)}(),function(){var t=r,e=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,r){t=this._hasher=new t.init,"string"==typeof r&&(r=e.parse(r));var o=t.blockSize,i=4*o;r.sigBytes>i&&(r=t.finalize(r)),r.clamp();for(var n=this._oKey=r.clone(),a=this._iKey=r.clone(),s=n.words,l=a.words,c=0;c<o;c++)s[c]^=1549556828,l[c]^=909522486;n.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),function(){var t=r,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,o=this._map;t.clamp();for(var i=[],n=0;n<r;n+=3)for(var a=(e[n>>>2]>>>24-n%4*8&255)<<16|(e[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|e[n+2>>>2]>>>24-(n+2)%4*8&255,s=0;s<4&&n+.75*s<r;s++)i.push(o.charAt(a>>>6*(3-s)&63));var l=o.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(t){var r=t.length,o=this._map,i=o.charAt(64);if(i){var n=t.indexOf(i);-1!=n&&(r=n)}for(var a=[],s=0,l=0;l<r;l++)if(l%4){var c=o.indexOf(t.charAt(l-1))<<l%4*2,u=o.indexOf(t.charAt(l))>>>6-l%4*2;a[s>>>2]|=(c|u)<<24-s%4*8,s++}return e.create(a,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.exports=r},function(t,e){function r(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(i,"")}var o=new RegExp("^([^a-zA-Z_À-ÖØ-öø-ÿͰ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿿、-퟿豈-﷏ﷰ-�])|^((x|X)(m|M)(l|L))|([^a-zA-Z_À-ÖØ-öø-ÿͰ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿿、-퟿豈-﷏ﷰ-�-.0-9·̀-ͯ‿⁀])","g"),i=/[^\x09\x0A\x0D\x20-\xFF\x85\xA0-\uD7FF\uE000-\uFDCF\uFDE0-\uFFFD]/gm,n=function(t){var e=[];if(t instanceof Object)for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e},a=function(t,e){var i=function(t,r,i,n,a){var s=void 0!==e.indent?e.indent:"\t",l=e.prettyPrint?"\n"+new Array(n).join(s):"";e.removeIllegalNameCharacters&&(t=t.replace(o,"_"));var c=[l,"<",t,i||""];return r&&r.length>0?(c.push(">"),c.push(r),a&&c.push(l),c.push("</"),c.push(t),c.push(">")):c.push("/>"),c.join("")};return function t(o,a,s){var l=typeof o;switch((Array.isArray?Array.isArray(o):o instanceof Array)?l="array":o instanceof Date&&(l="date"),l){case"array":var c=[];return o.map(function(e){c.push(t(e,0,s+1))}),e.prettyPrint&&c.push("\n"),c.join("");case"date":return o.toJSON?o.toJSON():o+"";case"object":var u=[];for(var d in o)if(o[d]instanceof Array)for(var h in o[d])u.push(i(d,t(o[d][h],0,s+1),null,s+1,n(o[d][h]).length));else u.push(i(d,t(o[d],0,s+1),null,s+1));return e.prettyPrint&&u.length>0&&u.push("\n"),u.join("");case"function":return o();default:return e.escape?r(o):""+o}}(t,0,0)},s=function(t){var e=['<?xml version="1.0" encoding="UTF-8"'];return t&&e.push(' standalone="yes"'),e.push("?>"),e.join("")};t.exports=function(t,e){if(e||(e={xmlHeader:{standalone:!0},prettyPrint:!0,indent:"  "}),"string"==typeof t)try{t=JSON.parse(t.toString())}catch(t){return!1}var r="",o="";return e&&("object"==typeof e?(e.xmlHeader&&(r=s(!!e.xmlHeader.standalone)),void 0!==e.docType&&(o="<!DOCTYPE "+e.docType+">")):r=s()),[r,(e=e||{}).prettyPrint&&o?"\n":"",o,a(t,e)].join("").replace(/\n{2,}/g,"\n").replace(/\s+$/g,"")}},function(t,e){t.exports=function(t){function e(t,e){return t<<e|t>>>32-e}function r(t,e){var r,o,i,n,a;return i=2147483648&t,n=2147483648&e,a=(1073741823&t)+(1073741823&e),(r=1073741824&t)&(o=1073741824&e)?2147483648^a^i^n:r|o?1073741824&a?3221225472^a^i^n:1073741824^a^i^n:a^i^n}function o(t,o,i,n,a,s,l){return r(e(t=r(t,r(r(o&i|~o&n,a),l)),s),o)}function i(t,o,i,n,a,s,l){return r(e(t=r(t,r(r(o&n|i&~n,a),l)),s),o)}function n(t,o,i,n,a,s,l){return r(e(t=r(t,r(r(o^i^n,a),l)),s),o)}function a(t,o,i,n,a,s,l){return r(e(t=r(t,r(r(i^(o|~n),a),l)),s),o)}function s(t){var e,r="",o="";for(e=0;e<=3;e++)r+=(o="0"+(t>>>8*e&255).toString(16)).substr(o.length-2,2);return r}var l,c,u,d,h,p,f,g,m,_=Array();for(_=function(t){for(var e,r=t.length,o=r+8,i=16*((o-o%64)/64+1),n=Array(i-1),a=0,s=0;s<r;)a=s%4*8,n[e=(s-s%4)/4]=n[e]|t.charCodeAt(s)<<a,s++;return a=s%4*8,n[e=(s-s%4)/4]=n[e]|128<<a,n[i-2]=r<<3,n[i-1]=r>>>29,n}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var o=t.charCodeAt(r);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}(t)),p=1732584193,f=4023233417,g=2562383102,m=271733878,l=0;l<_.length;l+=16)c=p,u=f,d=g,h=m,p=o(p,f,g,m,_[l+0],7,3614090360),m=o(m,p,f,g,_[l+1],12,3905402710),g=o(g,m,p,f,_[l+2],17,606105819),f=o(f,g,m,p,_[l+3],22,3250441966),p=o(p,f,g,m,_[l+4],7,4118548399),m=o(m,p,f,g,_[l+5],12,1200080426),g=o(g,m,p,f,_[l+6],17,2821735955),f=o(f,g,m,p,_[l+7],22,4249261313),p=o(p,f,g,m,_[l+8],7,1770035416),m=o(m,p,f,g,_[l+9],12,2336552879),g=o(g,m,p,f,_[l+10],17,4294925233),f=o(f,g,m,p,_[l+11],22,2304563134),p=o(p,f,g,m,_[l+12],7,1804603682),m=o(m,p,f,g,_[l+13],12,4254626195),g=o(g,m,p,f,_[l+14],17,2792965006),p=i(p,f=o(f,g,m,p,_[l+15],22,1236535329),g,m,_[l+1],5,4129170786),m=i(m,p,f,g,_[l+6],9,3225465664),g=i(g,m,p,f,_[l+11],14,643717713),f=i(f,g,m,p,_[l+0],20,3921069994),p=i(p,f,g,m,_[l+5],5,3593408605),m=i(m,p,f,g,_[l+10],9,38016083),g=i(g,m,p,f,_[l+15],14,3634488961),f=i(f,g,m,p,_[l+4],20,3889429448),p=i(p,f,g,m,_[l+9],5,568446438),m=i(m,p,f,g,_[l+14],9,3275163606),g=i(g,m,p,f,_[l+3],14,4107603335),f=i(f,g,m,p,_[l+8],20,1163531501),p=i(p,f,g,m,_[l+13],5,2850285829),m=i(m,p,f,g,_[l+2],9,4243563512),g=i(g,m,p,f,_[l+7],14,1735328473),p=n(p,f=i(f,g,m,p,_[l+12],20,2368359562),g,m,_[l+5],4,4294588738),m=n(m,p,f,g,_[l+8],11,2272392833),g=n(g,m,p,f,_[l+11],16,1839030562),f=n(f,g,m,p,_[l+14],23,4259657740),p=n(p,f,g,m,_[l+1],4,2763975236),m=n(m,p,f,g,_[l+4],11,1272893353),g=n(g,m,p,f,_[l+7],16,4139469664),f=n(f,g,m,p,_[l+10],23,3200236656),p=n(p,f,g,m,_[l+13],4,681279174),m=n(m,p,f,g,_[l+0],11,3936430074),g=n(g,m,p,f,_[l+3],16,3572445317),f=n(f,g,m,p,_[l+6],23,76029189),p=n(p,f,g,m,_[l+9],4,3654602809),m=n(m,p,f,g,_[l+12],11,3873151461),g=n(g,m,p,f,_[l+15],16,530742520),p=a(p,f=n(f,g,m,p,_[l+2],23,3299628645),g,m,_[l+0],6,4096336452),m=a(m,p,f,g,_[l+7],10,1126891415),g=a(g,m,p,f,_[l+14],15,2878612391),f=a(f,g,m,p,_[l+5],21,4237533241),p=a(p,f,g,m,_[l+12],6,1700485571),m=a(m,p,f,g,_[l+3],10,2399980690),g=a(g,m,p,f,_[l+10],15,4293915773),f=a(f,g,m,p,_[l+1],21,2240044497),p=a(p,f,g,m,_[l+8],6,1873313359),m=a(m,p,f,g,_[l+15],10,4264355552),g=a(g,m,p,f,_[l+6],15,2734768916),f=a(f,g,m,p,_[l+13],21,1309151649),p=a(p,f,g,m,_[l+4],6,4149444226),m=a(m,p,f,g,_[l+11],10,3174756917),g=a(g,m,p,f,_[l+2],15,718787259),f=a(f,g,m,p,_[l+9],21,3951481745),p=r(p,c),f=r(f,u),g=r(g,d),m=r(m,h);return(s(p)+s(f)+s(g)+s(m)).toLowerCase()}},function(t,e){t.exports=function(t,e){var r,o=t.filePath,i=t.headers||{},n=t.url,a=t.method,s=t.onProgress,l=function(t,r){e(t,{statusCode:r.statusCode,headers:r.header},r.data)};if(o){var c,u=n.match(/^(https?:\/\/[^\/]+\/)([^\/]*\/?)(.*)$/);t.pathStyle?(c=decodeURIComponent(u[3]||""),n=u[1]+u[2]):(c=decodeURIComponent(u[2]+u[3]||""),n=u[1]);var d={key:c,success_action_status:200,Signature:i.Authorization},h=["Cache-Control","Content-Type","Content-Disposition","Content-Encoding","Expires","x-cos-storage-class","x-cos-security-token"];for(var p in t.headers)t.headers.hasOwnProperty(p)&&(p.indexOf("x-cos-meta-")>-1||h.indexOf(p)>-1)&&(d[p]=t.headers[p]);i["x-cos-acl"]&&(d.acl=i["x-cos-acl"]),!d["Content-Type"]&&(d["Content-Type"]=""),(r=wx.uploadFile({url:n,method:a,name:"file",filePath:o,formData:d,success:function(t){l(null,t)},fail:function(t){l(t.errMsg,t)}})).onProgressUpdate(function(t){s({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend,progress:t.progress/100})})}else{var f=t.qs&&function(t){var e,r,o,i=[],n=Object.keys(t);for(e=0;e<n.length;e++)o=t[r=n[e]]||"",i.push(r+"="+encodeURIComponent(o));return i.join("&")}(t.qs)||"";f&&(n+=(n.indexOf("?")>-1?"&":"?")+f),i["Content-Length"]&&delete i["Content-Length"],wx.request({url:n,method:a,header:i,dataType:"text",data:t.body,success:function(t){l(null,t)},fail:function(t){l(t.errMsg,t)}})}return r}},function(t,e,r){var o=r(11).DOMParser,i=function(t){"use strict";function e(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!=e||(e=t.nodeName),e}function r(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):t}function i(t,e,r,o){for(var i=0;i<t.length;i++){var n=t[i];if("string"==typeof n){if(n==o)break}else if(n instanceof RegExp){if(n.test(o))break}else if("function"==typeof n&&n(e,r,o))break}return i!=t.length}function n(e,r,o){switch(t.arrayAccessForm){case"property":e[r]instanceof Array?e[r+"_asArray"]=e[r]:e[r+"_asArray"]=[e[r]]}!(e[r]instanceof Array)&&t.arrayAccessFormPaths.length>0&&i(t.arrayAccessFormPaths,e,r,o)&&(e[r]=[e[r]])}function a(t){var e=t.split(/[-T:+Z]/g),r=new Date(e[0],e[1]-1,e[2]),o=e[5].split(".");if(r.setHours(e[3],e[4],o[0]),o.length>1&&r.setMilliseconds(o[1]),e[6]&&e[7]){var i=60*e[6]+Number(e[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(t)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==t.indexOf("Z",t.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function s(e,r,o){if(t.datetimeAccessFormPaths.length>0){var n=o.split(".#")[0];return i(t.datetimeAccessFormPaths,e,r,n)?a(e):e}return e}function l(e,r,o,n){return!(r==T.ELEMENT_NODE&&t.xmlElementsFilter.length>0)||i(t.xmlElementsFilter,e,o,n)}function c(r,o){if(r.nodeType==T.DOCUMENT_NODE){for(var i=new Object,a=r.childNodes,u=0;u<a.length;u++){if((d=a.item(u)).nodeType==T.ELEMENT_NODE)i[h=e(d)]=c(d,h)}return i}if(r.nodeType==T.ELEMENT_NODE){(i=new Object).__cnt=0;for(a=r.childNodes,u=0;u<a.length;u++){var d,h=e(d=a.item(u));if(d.nodeType!=T.COMMENT_NODE){var p=o+"."+h;l(i,d.nodeType,h,p)&&(i.__cnt++,null==i[h]?(i[h]=c(d,p),n(i,h,p)):(null!=i[h]&&(i[h]instanceof Array||(i[h]=[i[h]],n(i,h,p))),i[h][i[h].length]=c(d,p)))}}for(var f=0;f<r.attributes.length;f++){var g=r.attributes.item(f);i.__cnt++,i[t.attributePrefix+g.name]=g.value}var m=r.prefix;return null!=m&&""!=m&&(i.__cnt++,i.__prefix=m),null!=i["#text"]&&(i.__text=i["#text"],i.__text instanceof Array&&(i.__text=i.__text.join("\n")),t.stripWhitespaces&&(i.__text=i.__text.trim()),delete i["#text"],"property"==t.arrayAccessForm&&delete i["#text_asArray"],i.__text=s(i.__text,h,o+"."+h)),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],"property"==t.arrayAccessForm&&delete i["#cdata-section_asArray"]),0==i.__cnt&&"text"==t.emptyNodeForm?i="":1==i.__cnt&&null!=i.__text?i=i.__text:1!=i.__cnt||null==i.__cdata||t.keepCData?i.__cnt>1&&null!=i.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""==i.__text||""==i.__text.trim())&&delete i.__text:i=i.__cdata,delete i.__cnt,!t.enableToStringFunc||null==i.__text&&null==i.__cdata||(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}if(r.nodeType==T.TEXT_NODE||r.nodeType==T.CDATA_SECTION_NODE)return r.nodeValue}function u(e,o,i,n){var a="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+o;if(null!=i)for(var s=0;s<i.length;s++){var l=i[s],c=e[l];t.escapeMode&&(c=r(c)),a+=" "+l.substr(t.attributePrefix.length)+"=",t.useDoubleQuotes?a+='"'+c+'"':a+="'"+c+"'"}return a+(n?"/>":">")}function d(t,e){return"</"+(null!=t.__prefix?t.__prefix+":":"")+e+">"}function h(e,r){return!!("property"==t.arrayAccessForm&&function(t,e){return-1!==t.indexOf(e,t.length-e.length)}(r.toString(),"_asArray")||0==r.toString().indexOf(t.attributePrefix)||0==r.toString().indexOf("__")||e[r]instanceof Function)}function p(t){var e=0;if(t instanceof Object)for(var r in t)h(t,r)||e++;return e}function f(e,r,o){return 0==t.jsonPropertiesFilter.length||""==o||i(t.jsonPropertiesFilter,e,r,o)}function g(e){var r=[];if(e instanceof Object)for(var o in e)-1==o.toString().indexOf("__")&&0==o.toString().indexOf(t.attributePrefix)&&r.push(o);return r}function m(e){var o="";return e instanceof Object?o+=function(e){var o="";return null!=e.__cdata&&(o+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(t.escapeMode?o+=r(e.__text):o+=e.__text),o}(e):null!=e&&(t.escapeMode?o+=r(e):o+=e),o}function _(t,e){return""===t?e:t+"."+e}function y(t,e,r,o){var i="";if(0==t.length)i+=u(t,e,r,!0);else for(var n=0;n<t.length;n++)i+=u(t[n],e,g(t[n]),!1),i+=b(t[n],_(o,e)),i+=d(t[n],e);return i}function b(t,e){var r="";if(p(t)>0)for(var o in t)if(!h(t,o)&&(""==e||f(t,o,_(e,o)))){var i=t[o],n=g(i);if(null==i||null==i)r+=u(i,o,n,!0);else if(i instanceof Object)if(i instanceof Array)r+=y(i,o,n,e);else if(i instanceof Date)r+=u(i,o,n,!1),r+=i.toISOString(),r+=d(i,o);else{p(i)>0||null!=i.__text||null!=i.__cdata?(r+=u(i,o,n,!1),r+=b(i,_(e,o)),r+=d(i,o)):r+=u(i,o,n,!0)}else r+=u(i,o,n,!1),r+=m(i),r+=d(i,o)}return r+m(t)}void 0===(t=t||{}).escapeMode&&(t.escapeMode=!0),t.attributePrefix=t.attributePrefix||"_",t.arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[],void 0===t.useDoubleQuotes&&(t.useDoubleQuotes=!1),t.xmlElementsFilter=t.xmlElementsFilter||[],t.jsonPropertiesFilter=t.jsonPropertiesFilter||[],void 0===t.keepCData&&(t.keepCData=!1);var T={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(t){if(void 0===t)return null;var e;if(o){var r=new o,i=null;try{i=r.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(t){i=null}try{e=r.parseFromString(t,"text/xml"),null!=i&&e.getElementsByTagNameNS(i,"parsererror").length>0&&(e=null)}catch(t){e=null}}else 0==t.indexOf("<?")&&(t=t.substr(t.indexOf("?>")+2)),(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t);return e},this.asArray=function(t){return void 0===t||null==t?[]:t instanceof Array?t:[t]},this.toXmlDateTime=function(t){return t instanceof Date?t.toISOString():"number"==typeof t?new Date(t).toISOString():null},this.asDateTime=function(t){return"string"==typeof t?a(t):t},this.xml2json=function(t){return c(t)},this.xml_str2json=function(t){var e=this.parseXmlString(t);return null!=e?this.xml2json(e):null},this.json2xml_str=function(t){return b(t,"")},this.json2xml=function(t){var e=this.json2xml_str(t);return this.parseXmlString(e)},this.getVersion=function(){return"1.2.0"}};t.exports=function(t){if(!t)return null;var e=(new o).parseFromString(t,"text/xml"),r=(new i).xml2json(e);return r.html&&r.getElementsByTagName("parsererror").length?null:r}},function(t,e,r){function o(t){this.options=t||{locator:{}}}function i(){this.cdata=!1}function n(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function a(t,e,r){return"string"==typeof t?t.substr(e,r):t.length>=e+r||e?new java.lang.String(t,e,r)+"":t}function s(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}o.prototype.parseFromString=function(t,e){var r=this.options,o=new l,n=r.domBuilder||new i,a=r.errorHandler,s=r.locator,c=r.xmlns||{},u={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&n.setDocumentLocator(s),o.errorHandler=function(t,e,r){function o(e){var o=t[e];!o&&a&&(o=2==t.length?function(r){t(e,r)}:t),n[e]=o&&function(t){o("[xmldom "+e+"]\t"+t+function(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}(r))}||function(){}}if(!t){if(e instanceof i)return e;t=e}var n={},a=t instanceof Function;return r=r||{},o("warning"),o("error"),o("fatalError"),n}(a,n,s),o.domBuilder=r.domBuilder||n,/\/x?html?$/.test(e)&&(u.nbsp=" ",u.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",t?o.parse(t,c,u):o.errorHandler.error("invalid doc source"),n.doc},i.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,r,o){var i=this.doc,a=i.createElementNS(t,r||e),l=o.length;s(this,a),this.currentElement=a,this.locator&&n(this.locator,a);for(var c=0;c<l;c++){t=o.getURI(c);var u=o.getValue(c),d=(r=o.getQName(c),i.createAttributeNS(t,r));this.locator&&n(o.getLocator(c),d),d.value=d.nodeValue=u,a.setAttributeNode(d)}},endElement:function(t,e,r){var o=this.currentElement;o.tagName,this.currentElement=o.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var r=this.doc.createProcessingInstruction(t,e);this.locator&&n(this.locator,r),s(this,r)},ignorableWhitespace:function(t,e,r){},characters:function(t,e,r){if(t=a.apply(this,arguments)){if(this.cdata)var o=this.doc.createCDATASection(t);else o=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(o):/^\s*$/.test(t)&&this.doc.appendChild(o),this.locator&&n(this.locator,o)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,r){t=a.apply(this,arguments);var o=this.doc.createComment(t);this.locator&&n(this.locator,o),s(this,o)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,r){var o=this.doc.implementation;if(o&&o.createDocumentType){var i=o.createDocumentType(t,e,r);this.locator&&n(this.locator,i),s(this,i)}},warning:function(t){},error:function(t){},fatalError:function(t){throw t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){i.prototype[t]=function(){return null}});var l=r(12).XMLReader,c=e.DOMImplementation=r(1).DOMImplementation;e.XMLSerializer=r(1).XMLSerializer,e.DOMParser=o},function(t,e){function r(){}function o(t,e,r,o,c){function p(t){var e=t.slice(1,-1);return e in r?r[e]:"#"===e.charAt(0)?function(t){if(t>65535){var e=55296+((t-=65536)>>10),r=56320+(1023&t);return String.fromCharCode(e,r)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(c.error("entity not found:"+t),t)}function f(e){if(e>E){var r=t.substring(E,e).replace(/&#?\w+;/g,p);b&&g(E),o.characters(r,0,e-E),E=e}}function g(e,r){for(;e>=_&&(r=y.exec(t));)m=r.index,_=m+r[0].length,b.lineNumber++;b.columnNumber=e-m+1}for(var m=0,_=0,y=/.*(?:\r\n?|\n)|.*$/g,b=o.locator,T=[{currentNSMap:e}],C={},E=0;;){try{var v=t.indexOf("<",E);if(v<0){if(!t.substr(E).match(/^\s*$/)){var S=o.doc,D=S.createTextNode(t.substr(E));S.appendChild(D),o.currentElement=D}return}switch(v>E&&f(v),t.charAt(v+1)){case"/":var A=t.indexOf(">",v+3),x=t.substring(v+2,A),O=T.pop();A<0?(x=t.substring(v+2).replace(/[\s<].*/,""),c.error("end tag name: "+x+" is not complete:"+O.tagName),A=v+1+x.length):x.match(/\s</)&&(x=x.replace(/[\s<].*/,""),c.error("end tag name: "+x+" maybe not complete"),A=v+1+x.length);var B=O.localNSMap,I=O.tagName==x;if(I||O.tagName&&O.tagName.toLowerCase()==x.toLowerCase()){if(o.endElement(O.uri,O.localName,x),B)for(var R in B)o.endPrefixMapping(R);I||c.fatalError("end tag name: "+x+" is not match the current start tagName:"+O.tagName)}else T.push(O);A++;break;case"?":b&&g(v),A=d(t,v,o);break;case"!":b&&g(v),A=u(t,v,o,c);break;default:b&&g(v);var P=new h,w=T[T.length-1].currentNSMap,N=(A=n(t,v,P,w,p,c),P.length);if(!P.closed&&l(t,A,P.tagName,C)&&(P.closed=!0,r.nbsp||c.warning("unclosed xml attribute")),b&&N){for(var L=i(b,{}),q=0;q<N;q++){var M=P[q];g(M.offset),M.locator=i(b,{})}o.locator=L,a(P,o,w)&&T.push(P),o.locator=b}else a(P,o,w)&&T.push(P);"http://www.w3.org/1999/xhtml"!==P.uri||P.closed?A++:A=s(t,A,P.tagName,p,o)}}catch(t){c.error("element parse error: "+t),A=-1}A>E?E=A:f(Math.max(v,E)+1)}}function i(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function n(t,e,r,o,i,n){for(var a,s=++e,l=_;;){var c=t.charAt(s);switch(c){case"=":if(l===y)a=t.slice(e,s),l=T;else{if(l!==b)throw new Error("attribute equal must after attrName");l=T}break;case"'":case'"':if(l===T||l===y){if(l===y&&(n.warning('attribute value must after "="'),a=t.slice(e,s)),e=s+1,!((s=t.indexOf(c,e))>0))throw new Error("attribute value no end '"+c+"' match");u=t.slice(e,s).replace(/&#?\w+;/g,i),r.add(a,u,e-1),l=E}else{if(l!=C)throw new Error('attribute value must after "="');u=t.slice(e,s).replace(/&#?\w+;/g,i),r.add(a,u,e),n.warning('attribute "'+a+'" missed start quot('+c+")!!"),e=s+1,l=E}break;case"/":switch(l){case _:r.setTagName(t.slice(e,s));case E:case v:case S:l=S,r.closed=!0;case C:case y:case b:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return n.error("unexpected end of input"),l==_&&r.setTagName(t.slice(e,s)),s;case">":switch(l){case _:r.setTagName(t.slice(e,s));case E:case v:case S:break;case C:case y:"/"===(u=t.slice(e,s)).slice(-1)&&(r.closed=!0,u=u.slice(0,-1));case b:l===b&&(u=a),l==C?(n.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u.replace(/&#?\w+;/g,i),e)):("http://www.w3.org/1999/xhtml"===o[""]&&u.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),r.add(u,u,e));break;case T:throw new Error("attribute value missed!!")}return s;case"":c=" ";default:if(c<=" ")switch(l){case _:r.setTagName(t.slice(e,s)),l=v;break;case y:a=t.slice(e,s),l=b;break;case C:var u=t.slice(e,s).replace(/&#?\w+;/g,i);n.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u,e);case E:l=v}else switch(l){case b:r.tagName,"http://www.w3.org/1999/xhtml"===o[""]&&a.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),r.add(a,a,e),e=s,l=y;break;case E:n.warning('attribute space is required"'+a+'"!!');case v:l=y,e=s;break;case T:l=C,e=s;break;case S:throw new Error("elements closed character '/' and '>' must be connected to")}}s++}}function a(t,e,r){for(var o=t.tagName,i=null,n=t.length;n--;){var a=t[n],s=a.qName,l=a.value;if((p=s.indexOf(":"))>0)var u=a.prefix=s.slice(0,p),d=s.slice(p+1),h="xmlns"===u&&d;else d=s,u=null,h="xmlns"===s&&"";a.localName=d,!1!==h&&(null==i&&(i={},c(r,r={})),r[h]=i[h]=l,a.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(h,l))}for(n=t.length;n--;){(u=(a=t[n]).prefix)&&("xml"===u&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(a.uri=r[u||""]))}var p;(p=o.indexOf(":"))>0?(u=t.prefix=o.slice(0,p),d=t.localName=o.slice(p+1)):(u=null,d=t.localName=o);var f=t.uri=r[u||""];if(e.startElement(f,d,o,t),!t.closed)return t.currentNSMap=r,t.localNSMap=i,!0;if(e.endElement(f,d,o),i)for(u in i)e.endPrefixMapping(u)}function s(t,e,r,o,i){if(/^(?:script|textarea)$/i.test(r)){var n=t.indexOf("</"+r+">",e),a=t.substring(e+1,n);if(/[&<]/.test(a))return/^script$/i.test(r)?(i.characters(a,0,a.length),n):(a=a.replace(/&#?\w+;/g,o),i.characters(a,0,a.length),n)}return e+1}function l(t,e,r,o){var i=o[r];return null==i&&((i=t.lastIndexOf("</"+r+">"))<e&&(i=t.lastIndexOf("</"+r)),o[r]=i),i<e}function c(t,e){for(var r in t)e[r]=t[r]}function u(t,e,r,o){switch(t.charAt(e+2)){case"-":return"-"===t.charAt(e+3)?(i=t.indexOf("--\x3e",e+4))>e?(r.comment(t,e+4,i-e-4),i+3):(o.error("Unclosed comment"),-1):-1;default:if("CDATA["==t.substr(e+3,6)){var i=t.indexOf("]]>",e+9);return r.startCDATA(),r.characters(t,e+9,i-e-9),r.endCDATA(),i+3}var n=function(t,e){var r,o=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=e,i.exec(t);r=i.exec(t);)if(o.push(r),r[1])return o}(t,e),a=n.length;if(a>1&&/!doctype/i.test(n[0][0])){var s=n[1][0],l=a>3&&/^public$/i.test(n[2][0])&&n[3][0],c=a>4&&n[4][0],u=n[a-1];return r.startDTD(s,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),c&&c.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),u.index+u[0].length}}return-1}function d(t,e,r){var o=t.indexOf("?>",e);if(o){var i=t.substring(e,o).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return i?(i[0].length,r.processingInstruction(i[1],i[2]),o+2):-1}return-1}function h(t){}function p(t,e){return t.__proto__=e,t}var f=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,g=new RegExp("[\\-\\.0-9"+f.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),m=new RegExp("^"+f.source+g.source+"*(?::"+f.source+g.source+"*)?$"),_=0,y=1,b=2,T=3,C=4,E=5,v=6,S=7;r.prototype={parse:function(t,e,r){var i=this.domBuilder;i.startDocument(),c(e,e={}),o(t,e,r,i,this.errorHandler),i.endDocument()}},h.prototype={setTagName:function(t){if(!m.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,r){if(!m.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:r}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},p({},p.prototype)instanceof p||(p=function(t,e){function r(){}for(e in r.prototype=e,r=new r,t)r[e]=t[e];return r}),e.XMLReader=r},function(t,e,r){function o(t,e){var r=t.Bucket,o=t.Region,i=t.Key,n=t.AbortArray,s=t.AsyncLimit||1,l=this,c=0,u=new Array(n.length);a.eachLimit(n,s,function(e,n){var a=c;if(i&&i!==e.Key)return u[a]={error:{KeyNotMatch:!0}},void n(null);var s=e.UploadId||e.UploadID;l.multipartAbort({Bucket:r,Region:o,Key:e.Key,Headers:t.Headers,UploadId:s},function(t,i){var l={Bucket:r,Region:o,Key:e.Key,UploadId:s};u[a]={error:t,task:l},n(null)}),c++},function(t){if(t)return e(t);for(var r=[],o=[],i=0,n=u.length;i<n;i++){var a=u[i];a.task&&(a.error?o.push(a.task):r.push(a.task))}return e(null,{successList:r,errorList:o})})}function i(t,e){var r=this,o=[],i={Bucket:t.Bucket,Region:t.Region,Prefix:t.Key},n=function(){r.multipartList(i,function(t,r){if(t)return e(t);o.push.apply(o,r.Upload||[]),"true"==r.IsTruncated?(i.KeyMarker=r.NextKeyMarker,i.UploadIdMarker=r.NextUploadIdMarker,n()):e(null,{UploadList:o})})};n()}function n(t,e){var r=t.TaskId,o=t.Bucket,i=t.Region,n=t.Key,s=t.CopySource,l=t.UploadId,c=1*t.PartNumber,u=t.CopySourceRange,d=this.options.ChunkRetryTimes+1,h=this;a.retry(d,function(e){h.uploadPartCopy({TaskId:r,Bucket:o,Region:i,Key:n,CopySource:s,UploadId:l,PartNumber:c,CopySourceRange:u,onProgress:t.onProgress},function(t,r){e(t||null,r)})},function(t,r){return e(t,r)})}var a=r(14),s=r(2).EventProxy,l=r(0),c={abortUploadTask:function(t,e){var r=t.Bucket,n=t.Region,a=t.Key,l=t.UploadId,c=t.Level||"task",u=t.AsyncLimit,d=this,h=new s;if(h.on("error",function(t){return e(t)}),h.on("get_abort_array",function(i){o.call(d,{Bucket:r,Region:n,Key:a,Headers:t.Headers,AsyncLimit:u,AbortArray:i},function(t,r){if(t)return e(t);e(null,r)})}),"bucket"===c)i.call(d,{Bucket:r,Region:n},function(t,r){if(t)return e(t);h.emit("get_abort_array",r.UploadList||[])});else if("file"===c){if(!a)return e({error:"abort_upload_task_no_key"});i.call(d,{Bucket:r,Region:n,Key:a},function(t,r){if(t)return e(t);h.emit("get_abort_array",r.UploadList||[])})}else{if("task"!==c)return e({error:"abort_unknown_level"});if(!l)return e({error:"abort_upload_task_no_id"});if(!a)return e({error:"abort_upload_task_no_key"});h.emit("get_abort_array",[{Key:a,UploadId:l}])}},sliceCopyFile:function(t,e){var r=new s,o=this,i=t.Bucket,c=t.Region,u=t.Key,d=t.CopySource,h=d.match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^\/]+\/(.+)$/);if(h){var p=h[1],f=h[3],g=decodeURIComponent(h[4]),m=void 0===t.SliceSize?o.options.CopySliceSize:t.SliceSize;m=Math.max(0,Math.min(m,5368709120));var _,y,b=t.ChunkSize||this.options.CopyChunkSize,T=this.options.CopyChunkParallelLimit,C=0;r.on("copy_slice_complete",function(t){o.multipartComplete({Bucket:i,Region:c,Key:u,UploadId:t.UploadId,Parts:t.PartList},function(t,r){if(t)return y(null,!0),e(t);y({loaded:_,total:_},!0),e(null,r)})}),r.on("get_copy_data_finish",function(t){a.eachLimit(t.PartList,T,function(e,r){var a=e.PartNumber,s=e.CopySourceRange,l=e.end-e.start,h=0;n.call(o,{Bucket:i,Region:c,Key:u,CopySource:d,UploadId:t.UploadId,PartNumber:a,CopySourceRange:s,onProgress:function(t){C+=t.loaded-h,h=t.loaded,y({loaded:C,total:_})}},function(t,o){if(t)return r(t);y({loaded:C,total:_}),C+=l-h,e.ETag=o.ETag,r(t||null,o)})},function(o){if(o)return y(null,!0),e(o);r.emit("copy_slice_complete",t)})}),r.on("get_file_size_finish",function(n){var a;!function(){for(var e=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,5120],r=1048576,i=0;i<e.length&&!(_/(r=1024*e[i]*1024)<=o.options.MaxPartNumber);i++);t.ChunkSize=b=Math.max(b,r);for(var n=Math.ceil(_/b),a=[],s=1;s<=n;s++){var l=(s-1)*b,c=s*b<_?s*b-1:_-1,u={PartNumber:s,start:l,end:c,CopySourceRange:"bytes="+l+"-"+c};a.push(u)}t.PartList=a}(),(a="Replaced"===t.Headers["x-cos-metadata-directive"]?t.Headers:n)["x-cos-storage-class"]=t.Headers["x-cos-storage-class"]||n["x-cos-storage-class"],a=l.clearKey(a),o.multipartInit({Bucket:i,Region:c,Key:u,Headers:a},function(o,i){if(o)return e(o);t.UploadId=i.UploadId,r.emit("get_copy_data_finish",t)})}),o.headObject({Bucket:p,Region:f,Key:g},function(i,n){if(i)e(i.statusCode&&404===i.statusCode?{ErrorStatus:g+" Not Exist"}:i);else if(void 0!==(_=t.FileSize=n.headers["content-length"])&&_)if(y=l.throttleOnProgress.call(o,_,t.onProgress),_<=m)t.Headers["x-cos-metadata-directive"]||(t.Headers["x-cos-metadata-directive"]="Copy"),o.putObjectCopy(t,function(t,r){if(t)return y(null,!0),e(t);y({loaded:_,total:_},!0),e(t,r)});else{var a=n.headers,s={"Cache-Control":a["cache-control"],"Content-Disposition":a["content-disposition"],"Content-Encoding":a["content-encoding"],"Content-Type":a["content-type"],Expires:a.expires,"x-cos-storage-class":a["x-cos-storage-class"]};l.each(a,function(t,e){0===e.indexOf("x-cos-meta-")&&e.length>"x-cos-meta-".length&&(s[e]=t)}),r.emit("get_file_size_finish",s)}else e({error:'get Content-Length error, please add "Content-Length" to CORS ExposeHeader setting.'})})}else e({error:"CopySource format error"})}};t.exports.init=function(t,e){l.each(c,function(e,r){t.prototype[r]=l.apiWrapper(r,e)})}},function(t,e){t.exports={eachLimit:function(t,e,r,o){if(o=o||function(){},!t.length||e<=0)return o();var i=0,n=0,a=0;!function s(){if(i>=t.length)return o();for(;a<e&&n<t.length;)a+=1,r(t[(n+=1)-1],function(e){e?(o(e),o=function(){}):(a-=1,(i+=1)>=t.length?o():s())})}()},retry:function(t,e,r){var o=function(i){e(function(e,n){e&&i<t?o(i+1):r(e,n)})};t<1?r():o(1)}}},function(t,e,r){"use strict";function o(t){var e={GrantFullControl:[],GrantWrite:[],GrantRead:[],GrantReadAcp:[],GrantWriteAcp:[],ACL:""},r={FULL_CONTROL:"GrantFullControl",WRITE:"GrantWrite",READ:"GrantRead",READ_ACP:"GrantReadAcp",WRITE_ACP:"GrantWriteAcp"},o=t.AccessControlList.Grant;o&&(o=c.isArray(o)?o:[o]);var n={READ:0,WRITE:0,FULL_CONTROL:0};return o.length&&c.each(o,function(o){"qcs::cam::anyone:anyone"===o.Grantee.ID||"http://cam.qcloud.com/groups/global/AllUsers"===o.Grantee.URI?n[o.Permission]=1:o.Grantee.ID!==t.Owner.ID&&e[r[o.Permission]].push('id="'+o.Grantee.ID+'"')}),n.FULL_CONTROL||n.WRITE&&n.READ?e.ACL="public-read-write":n.READ?e.ACL="public-read":e.ACL="private",c.each(r,function(t){e[t]=i(e[t].join(","))}),e}function i(t){var e,r,o=t.split(","),i={};for(e=0;e<o.length;)i[r=o[e].trim()]?o.splice(e,1):(i[r]=!0,o[e]=r,e++);return o.join(",")}function n(t){var e=t.bucket,r=e.substr(0,e.lastIndexOf("-")),o=e.substr(e.lastIndexOf("-")+1),i=t.domain,n=t.region,a=t.object;i||(i=["cn-south","cn-south-2","cn-north","cn-east","cn-southwest","sg"].indexOf(n)>-1?"{Region}.myqcloud.com":"cos.{Region}.myqcloud.com",t.ForcePathStyle||(i="{Bucket}."+i)),i=(i=i.replace(/\{\{AppId\}\}/gi,o).replace(/\{\{Bucket\}\}/gi,r).replace(/\{\{Region\}\}/gi,n).replace(/\{\{.*?\}\}/gi,"")).replace(/\{AppId\}/gi,o).replace(/\{BucketName\}/gi,r).replace(/\{Bucket\}/gi,e).replace(/\{Region\}/gi,n).replace(/\{.*?\}/gi,""),/^[a-zA-Z]+:\/\//.test(i)||(i="https://"+i),"/"===i.slice(-1)&&(i=i.slice(0,-1));var s=i;return t.ForcePathStyle&&(s+="/"+e),s+="/",a&&(s+=c.camSafeUrlEncode(a).replace(/%2F/g,"/")),t.isLocation&&(s=s.replace(/^https?:\/\//,"")),s}function a(t,e){var r=c.clone(t.Headers);delete r["Content-Type"],delete r["Cache-Control"],c.each(r,function(t,e){""===t&&delete r[e]});var o=function(t){var r=!1,o=t.Authorization;if(o)if(o.indexOf(" ")>-1)r=!1;else if(o.indexOf("q-sign-algorithm=")>-1&&o.indexOf("q-ak=")>-1&&o.indexOf("q-sign-time=")>-1&&o.indexOf("q-key-time=")>-1&&o.indexOf("q-url-param-list=")>-1)r=!0;else try{(o=atob(o)).indexOf("a=")>-1&&o.indexOf("k=")>-1&&o.indexOf("t=")>-1&&o.indexOf("r=")>-1&&o.indexOf("b=")>-1&&(r=!0)}catch(t){}r?e&&e(null,t):e&&e("authorization error")},i=this,n=t.Bucket||"",a=t.Region||"",s="name/cos:PostObject"!==t.Action&&t.Key?t.Key:"";i.options.ForcePathStyle&&n&&(s=n+"/"+s);var l="/"+s,u={},d=t.Scope;if(!d){var h=t.Action||"",p=t.ResourceKey||t.Key||"";d=t.Scope||[{action:h,bucket:n,region:a,prefix:p}]}var f=c.md5(JSON.stringify(d));i._StsCache=i._StsCache||[],function(){var t,e;for(t=i._StsCache.length-1;t>=0;t--){e=i._StsCache[t];var r=Math.round(c.getSkewTime(i.options.SystemClockOffset)/1e3)+30;if(e.StartTime&&r<e.StartTime||r>=e.ExpiredTime)i._StsCache.splice(t,1);else if(!e.ScopeLimit||e.ScopeLimit&&e.ScopeKey===f){u=e;break}}}();var g=function(){var e={Authorization:c.getAuth({SecretId:u.TmpSecretId,SecretKey:u.TmpSecretKey,Method:t.Method,Pathname:l,Query:t.Query,Headers:r,Expires:t.Expires,SystemClockOffset:i.options.SystemClockOffset}),XCosSecurityToken:u.XCosSecurityToken||"",Token:u.Token||"",ClientIP:u.ClientIP||"",ClientUA:u.ClientUA||""};o(e)};if(u.ExpiredTime&&u.ExpiredTime-c.getSkewTime(i.options.SystemClockOffset)/1e3>60)g();else if(i.options.getAuthorization)i.options.getAuthorization.call(i,{Bucket:n,Region:a,Method:t.Method,Key:s,Pathname:l,Query:t.Query,Headers:r,Scope:d},function(t){"string"==typeof t&&(t={Authorization:t}),t.TmpSecretId&&t.TmpSecretKey&&t.XCosSecurityToken&&t.ExpiredTime?((u=t||{}).Scope=d,u.ScopeKey=f,i._StsCache.push(u),g()):o(t)});else{if(!i.options.getSTS)return function(){var e={Authorization:c.getAuth({SecretId:t.SecretId||i.options.SecretId,SecretKey:t.SecretKey||i.options.SecretKey,Method:t.Method,Pathname:l,Query:t.Query,Headers:r,Expires:t.Expires,SystemClockOffset:i.options.SystemClockOffset}),XCosSecurityToken:i.options.XCosSecurityToken};return o(e),e}();i.options.getSTS.call(i,{Bucket:n,Region:a},function(t){(u=t||{}).Scope=d,u.ScopeKey=f,u.TmpSecretId=u.SecretId,u.TmpSecretKey=u.SecretKey,i._StsCache.push(u),g()})}return""}function s(t,e){var r=this;!t.headers&&(t.headers={}),!t.qs&&(t.qs={}),t.VersionId&&(t.qs.versionId=t.VersionId),t.qs=c.clearKey(t.qs),t.headers&&(t.headers=c.clearKey(t.headers)),t.qs&&(t.qs=c.clearKey(t.qs));var o=c.clone(t.qs);t.action&&(o[t.action]="");var i=function(s){var u=r.options.SystemClockOffset;a.call(r,{Bucket:t.Bucket||"",Region:t.Region||"",Method:t.method,Key:t.Key,Query:o,Headers:t.headers,Action:t.Action,ResourceKey:t.ResourceKey,Scope:t.Scope},function(o,a){t.AuthData=a,function(t,e){var r=this,o=t.TaskId;if(!o||r._isRunningTask(o)){var i=t.Bucket,a=t.Region,s=t.Key,u=t.method||"GET",d=t.url,h=t.body,p=t.json,f=t.rawBody;d=d||n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:i,region:a,object:s}),t.action&&(d=d+"?"+t.action);var g={method:u,url:d,headers:t.headers,qs:t.qs,filePath:t.filePath,body:h,json:p};g.headers.Authorization=t.AuthData.Authorization,t.AuthData.Token&&(g.headers.token=t.AuthData.Token),t.AuthData.ClientIP&&(g.headers.clientIP=t.AuthData.ClientIP),t.AuthData.ClientUA&&(g.headers.clientUA=t.AuthData.ClientUA),t.AuthData.XCosSecurityToken&&(g.headers["x-cos-security-token"]=t.AuthData.XCosSecurityToken),g.headers&&(g.headers=c.clearKey(g.headers)),g=c.clearKey(g),t.onProgress&&"function"==typeof t.onProgress&&(g.onProgress=function(e){if(!o||r._isRunningTask(o)){var i=e?e.loaded:0;t.onProgress({loaded:i,total:e.total})}}),r.options.ForcePathStyle&&(g.pathStyle=r.options.ForcePathStyle);var m=l(g,function(t,i,n){var a,s=function(t,n){if(o&&r.off("inner-kill-task",_),!a){a=!0;var s={};i&&i.statusCode&&(s.statusCode=i.statusCode),i&&i.headers&&(s.headers=i.headers),t?(t=c.extend(t||{},s),e(t,null)):(n=c.extend(n||{},s),e(null,n))}};if(!t){var l;try{l=c.xml2json(n)||{}}catch(t){l=n||{}}var u=i.statusCode;return 2!==Math.floor(u/100)?void s({error:l.Error||l}):(f&&((l={}).body=n),l.Error?void s({error:l.Error}):void s(null,l))}s({error:t})}),_=function(t){t.TaskId===o&&(m&&m.abort&&m.abort(),r.off("inner-kill-task",_))};o&&r.on("inner-kill-task",_)}}.call(r,t,function(o,n){o&&s<2&&(u!==r.options.SystemClockOffset||function(t){var e=!1,r=!1,o=t.headers&&(t.headers.date||t.headers.Date)||"";try{var i=t.error.Code,n=t.error.Message;("RequestTimeTooSkewed"===i||"AccessDenied"===i&&"Request has expired"===n)&&(r=!0)}catch(t){}if(t)if(r&&o){var a=Date.parse(o);this.options.CorrectClockSkew&&Math.abs(c.getSkewTime(this.options.SystemClockOffset)-a)>=3e4&&(this.options.SystemClockOffset=a-Date.now(),e=!0)}else 5===Math.round(t.statusCode/100)&&(e=!0);return e}.call(r,o))?(t.headers&&(delete t.headers.Authorization,delete t.headers.token,delete t.headers.clientIP,delete t.headers.clientUA,delete t.headers["x-cos-security-token"]),i(s+1)):e(o,n)})})};i(0)}var l=r(9),c=r(0),u={getService:function(t,e){"function"==typeof t&&(e=t,t={});var r=this.options.ServiceDomain,o=t.AppId||this.options.appId;r?(r=r.replace(/\{\{AppId\}\}/gi,o||"").replace(/\{\{.*?\}\}/gi,""),/^[a-zA-Z]+:\/\//.test(r)||(r="https://"+r),"/"===r.slice(-1)&&(r=r.slice(0,-1))):r="https://service.cos.myqcloud.com",s.call(this,{Action:"name/cos:GetService",url:r+"/",method:"GET"},function(t,r){if(t)return e(t);var o=r&&r.ListAllMyBucketsResult&&r.ListAllMyBucketsResult.Buckets&&r.ListAllMyBucketsResult.Buckets.Bucket||[];o=c.isArray(o)?o:[o],e(null,{Buckets:o,statusCode:r.statusCode,headers:r.headers})})},putBucket:function(t,e){var r=this,o={};o["x-cos-acl"]=t.ACL,o["x-cos-grant-read"]=t.GrantRead,o["x-cos-grant-write"]=t.GrantWrite,o["x-cos-grant-read-acp"]=t.GrantReadAcp,o["x-cos-grant-write-acp"]=t.GrantWriteAcp,o["x-cos-grant-full-control"]=t.GrantFullControl,s.call(this,{Action:"name/cos:PutBucket",method:"PUT",Bucket:t.Bucket,Region:t.Region,headers:o},function(o,i){if(o)return e(o);var a=n({domain:r.options.Domain,bucket:t.Bucket,region:t.Region,isLocation:!0});e(null,{Location:a,statusCode:i.statusCode,headers:i.headers})})},getBucket:function(t,e){var r={};r.prefix=t.Prefix||"",r.delimiter=t.Delimiter,r.marker=t.Marker,r["max-keys"]=t.MaxKeys,r["encoding-type"]=t.EncodingType,s.call(this,{Action:"name/cos:GetBucket",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);var o=r.ListBucketResult||{},i=o.Contents||[],n=o.CommonPrefixes||[];i=c.isArray(i)?i:[i],n=c.isArray(n)?n:[n];var a=c.clone(o);c.extend(a,{Contents:i,CommonPrefixes:n,statusCode:r.statusCode,headers:r.headers}),e(null,a)})},headBucket:function(t,e){s.call(this,{Action:"name/cos:HeadBucket",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,method:"HEAD"},function(t,r){e(t,r)})},deleteBucket:function(t,e){s.call(this,{Action:"name/cos:DeleteBucket",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,method:"DELETE"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketAcl:function(t,e){s.call(this,{Action:"name/cos:GetBucketACL",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"acl"},function(t,r){if(t)return e(t);var i=r.AccessControlPolicy||{},n=i.Owner||{},a=i.AccessControlList.Grant||[];a=c.isArray(a)?a:[a];var s=o(i);r.headers&&r.headers["x-cos-acl"]&&(s.ACL=r.headers["x-cos-acl"]),s=c.extend(s,{Owner:n,Grants:a,statusCode:r.statusCode,headers:r.headers}),e(null,s)})},putBucketAcl:function(t,e){var r=t.Headers,o="";if(t.AccessControlPolicy){var n=c.clone(t.AccessControlPolicy||{}),a=n.Grants||n.Grant;a=c.isArray(a)?a:[a],delete n.Grant,delete n.Grants,n.AccessControlList={Grant:a},o=c.json2xml({AccessControlPolicy:n}),r["Content-Type"]="application/xml",r["Content-MD5"]=c.binaryBase64(c.md5(o))}c.each(r,function(t,e){0===e.indexOf("x-cos-grant-")&&(r[e]=i(r[e]))}),s.call(this,{Action:"name/cos:PutBucketACL",method:"PUT",Bucket:t.Bucket,Region:t.Region,headers:r,action:"acl",body:o},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketCors:function(t,e){s.call(this,{Action:"name/cos:GetBucketCORS",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"cors"},function(t,r){if(t)if(404===t.statusCode&&t.error&&"NoSuchCORSConfiguration"===t.error.Code){var o={CORSRules:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else e(t);else{var i=r.CORSConfiguration||{},n=i.CORSRules||i.CORSRule||[];n=c.clone(c.isArray(n)?n:[n]),c.each(n,function(t){c.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(e,r){var o=e+"s",i=t[o]||t[e]||[];delete t[e],t[o]=c.isArray(i)?i:[i]})}),e(null,{CORSRules:n,statusCode:r.statusCode,headers:r.headers})}})},putBucketCors:function(t,e){var r=(t.CORSConfiguration||{}).CORSRules||t.CORSRules||[];r=c.clone(c.isArray(r)?r:[r]),c.each(r,function(t){c.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(e,r){var o=e+"s",i=t[o]||t[e]||[];delete t[o],t[e]=c.isArray(i)?i:[i]})});var o=c.json2xml({CORSConfiguration:{CORSRule:r}}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.binaryBase64(c.md5(o)),s.call(this,{Action:"name/cos:PutBucketCORS",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"cors",headers:i},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketCors:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketCORS",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"cors"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode||t.statusCode,headers:r.headers})})},getBucketLocation:function(t,e){s.call(this,{Action:"name/cos:GetBucketLocation",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"location"},function(t,r){if(t)return e(t);e(null,r)})},putBucketTagging:function(t,e){var r=t.Tagging||{},o=r.TagSet||r.Tags||t.Tags||[];o=c.clone(c.isArray(o)?o:[o]);var i=c.json2xml({Tagging:{TagSet:{Tag:o}}}),n=t.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.binaryBase64(c.md5(i)),s.call(this,{Action:"name/cos:PutBucketTagging",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:i,action:"tagging",headers:n},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketTagging:function(t,e){s.call(this,{Action:"name/cos:GetBucketTagging",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"tagging"},function(t,r){if(t)if(404!==t.statusCode||!t.error||"Not Found"!==t.error&&"NoSuchTagSet"!==t.error.Code)e(t);else{var o={Tags:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else{var i=[];try{i=r.Tagging.TagSet.Tag||[]}catch(t){}i=c.clone(c.isArray(i)?i:[i]),e(null,{Tags:i,statusCode:r.statusCode,headers:r.headers})}})},deleteBucketTagging:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketTagging",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"tagging"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketPolicy:function(t,e){s.call(this,{Action:"name/cos:GetBucketPolicy",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"policy",rawBody:!0},function(t,r){if(t)return e(t.statusCode&&403===t.statusCode?{ErrorStatus:"Access Denied"}:t.statusCode&&405===t.statusCode?{ErrorStatus:"Method Not Allowed"}:t.statusCode&&404===t.statusCode?{ErrorStatus:"Policy Not Found"}:t);var o={};try{o=JSON.parse(r.body)}catch(t){}e(null,{Policy:o,statusCode:r.statusCode,headers:r.headers})})},putBucketPolicy:function(t,e){var r=t.Policy,o=r;try{"string"==typeof r?r=JSON.parse(o):o=JSON.stringify(r)}catch(t){e({error:"Policy format error"})}var i=t.Headers;i["Content-Type"]="application/json",i["Content-MD5"]=c.binaryBase64(c.md5(o)),s.call(this,{Action:"name/cos:PutBucketPolicy",method:"PUT",Bucket:t.Bucket,Region:t.Region,action:"policy",body:c.isBrowser?o:r,headers:i,json:!0},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketPolicy:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketPolicy",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"policy"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode||t.statusCode,headers:r.headers})})},getBucketLifecycle:function(t,e){s.call(this,{Action:"name/cos:GetBucketLifecycle",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"lifecycle"},function(t,r){if(t)if(404===t.statusCode&&t.error&&"NoSuchLifecycleConfiguration"===t.error.Code){var o={Rules:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else e(t);else{var i=[];try{i=r.LifecycleConfiguration.Rule||[]}catch(t){}i=c.clone(c.isArray(i)?i:[i]),e(null,{Rules:i,statusCode:r.statusCode,headers:r.headers})}})},putBucketLifecycle:function(t,e){var r=(t.LifecycleConfiguration||{}).Rules||[];r=c.clone(r);var o=c.json2xml({LifecycleConfiguration:{Rule:r}}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.binaryBase64(c.md5(o)),s.call(this,{Action:"name/cos:PutBucketLifecycle",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"lifecycle",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketLifecycle:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketLifecycle",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"lifecycle"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},putBucketVersioning:function(t,e){if(t.VersioningConfiguration){var r=t.VersioningConfiguration||{},o=c.json2xml({VersioningConfiguration:r}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.binaryBase64(c.md5(o)),s.call(this,{Action:"name/cos:PutBucketVersioning",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"versioning",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})}else e({error:"missing param VersioningConfiguration"})},getBucketVersioning:function(t,e){s.call(this,{Action:"name/cos:GetBucketVersioning",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"versioning"},function(t,r){t||!r.VersioningConfiguration&&(r.VersioningConfiguration={}),e(t,r)})},putBucketReplication:function(t,e){var r=c.clone(t.ReplicationConfiguration),o=c.json2xml({ReplicationConfiguration:r});o=(o=o.replace(/<(\/?)Rules>/gi,"<$1Rule>")).replace(/<(\/?)Tags>/gi,"<$1Tag>");var i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=c.binaryBase64(c.md5(o)),s.call(this,{Action:"name/cos:PutBucketReplication",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"replication",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketReplication:function(t,e){s.call(this,{Action:"name/cos:GetBucketReplication",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"replication"},function(t,r){if(t)if(404!==t.statusCode||!t.error||"Not Found"!==t.error&&"ReplicationConfigurationnotFoundError"!==t.error.Code)e(t);else{var o={ReplicationConfiguration:{Rules:[]},statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else t||!r.ReplicationConfiguration&&(r.ReplicationConfiguration={}),r.ReplicationConfiguration.Rule&&(r.ReplicationConfiguration.Rules=r.ReplicationConfiguration.Rule,delete r.ReplicationConfiguration.Rule),e(t,r)})},deleteBucketReplication:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketReplication",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"replication"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getObject:function(t,e){var r={};r["response-content-type"]=t.ResponseContentType,r["response-content-language"]=t.ResponseContentLanguage,r["response-expires"]=t.ResponseExpires,r["response-cache-control"]=t.ResponseCacheControl,r["response-content-disposition"]=t.ResponseContentDisposition,r["response-content-encoding"]=t.ResponseContentEncoding,s.call(this,{Action:"name/cos:GetObject",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers,qs:r,rawBody:!0},function(r,o){if(r){var i=r.statusCode;return t.Headers["If-Modified-Since"]&&i&&304===i?e(null,{NotModified:!0}):e(r)}var n={};n.Body=o.body,o.headers&&o.headers.etag&&(n.ETag=o.headers&&o.headers.etag),c.extend(n,{statusCode:o.statusCode,headers:o.headers}),e(null,n)})},headObject:function(t,e){s.call(this,{Action:"name/cos:HeadObject",method:"HEAD",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers},function(r,o){if(r){var i=r.statusCode;return t.Headers["If-Modified-Since"]&&i&&304===i?e(null,{NotModified:!0,statusCode:i}):e(r)}o.headers&&o.headers.etag&&(o.ETag=o.headers&&o.headers.etag),e(null,o)})},listObjectVersions:function(t,e){var r={};r.prefix=t.Prefix||"",r.delimiter=t.Delimiter,r["key-marker"]=t.KeyMarker,r["version-id-marker"]=t.VersionIdMarker,r["max-keys"]=t.MaxKeys,r["encoding-type"]=t.EncodingType,s.call(this,{Action:"name/cos:GetBucketObjectVersions",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r,action:"versions"},function(t,r){if(t)return e(t);var o=r.ListVersionsResult||{},i=o.DeleteMarker||[];i=c.isArray(i)?i:[i];var n=o.Version||[];n=c.isArray(n)?n:[n];var a=c.clone(o);delete a.DeleteMarker,delete a.Version,c.extend(a,{DeleteMarkers:i,Versions:n,statusCode:r.statusCode,headers:r.headers}),e(null,a)})},putObject:function(t,e){var r=this,o=t.ContentLength,i=c.throttleOnProgress.call(r,o,t.onProgress);c.getBodyMd5(r.options.UploadCheckContentMd5,t.Body,function(a){a&&(t.Headers["Content-MD5"]=c.binaryBase64(a)),void 0!==t.ContentLength&&(t.Headers["Content-Length"]=t.ContentLength),s.call(r,{Action:"name/cos:PutObject",TaskId:t.TaskId,method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,body:t.Body,onProgress:i},function(a,s){if(a)return i(null,!0),e(a);if(i({loaded:o,total:o},!0),s&&s.headers&&s.headers.etag){var l=n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key});return l=l.substr(l.indexOf("://")+3),e(null,{Location:l,ETag:s.headers.etag,statusCode:s.statusCode,headers:s.headers})}e(null,s)})})},postObject:function(t,e){var r=this,o={};o["Cache-Control"]=t.CacheControl,o["Content-Disposition"]=t.ContentDisposition,o["Content-Encoding"]=t.ContentEncoding,o["Content-MD5"]=t.ContentMD5,o["Content-Length"]=t.ContentLength,o["Content-Type"]=t.ContentType,o.Expect=t.Expect,o.Expires=t.Expires,o["x-cos-acl"]=t.ACL,o["x-cos-grant-read"]=t.GrantRead,o["x-cos-grant-write"]=t.GrantWrite,o["x-cos-grant-full-control"]=t.GrantFullControl,o["x-cos-storage-class"]=t.StorageClass;var i=t.FilePath;for(var a in t)a.indexOf("x-cos-meta-")>-1&&(o[a]=t[a]);var l=c.throttleOnProgress.call(r,o["Content-Length"],t.onProgress);s.call(this,{Action:"name/cos:PostObject",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:o,filePath:i,onProgress:l},function(o,i){if(l(null,!0),o)return e(o);if(i){var a=n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key,isLocation:!0});return e(null,{Location:a,statusCode:i.statusCode})}e(null,i)})},deleteObject:function(t,e){s.call(this,{Action:"name/cos:DeleteObject",method:"DELETE",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,VersionId:t.VersionId},function(t,r){if(t){var o=t.statusCode;return o&&204===o?e(null,{statusCode:o}):o&&404===o?e(null,{BucketNotFound:!0,statusCode:o}):e(t)}e(null,{statusCode:r.statusCode,headers:r.headers})})},getObjectAcl:function(t,e){s.call(this,{Action:"name/cos:GetObjectACL",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,action:"acl"},function(t,r){if(t)return e(t);var i=r.AccessControlPolicy||{},n=i.Owner||{},a=i.AccessControlList&&i.AccessControlList.Grant||[];a=c.isArray(a)?a:[a];var s=o(i);r.headers&&r.headers["x-cos-acl"]&&(s.ACL=r.headers["x-cos-acl"]),s=c.extend(s,{Owner:n,Grants:a,statusCode:r.statusCode,headers:r.headers}),e(null,s)})},putObjectAcl:function(t,e){var r=t.Headers,o="";if(t.AccessControlPolicy){var n=c.clone(t.AccessControlPolicy||{}),a=n.Grants||n.Grant;a=c.isArray(a)?a:[a],delete n.Grant,delete n.Grants,n.AccessControlList={Grant:a},o=c.json2xml({AccessControlPolicy:n}),r["Content-Type"]="application/xml",r["Content-MD5"]=c.binaryBase64(c.md5(o))}c.each(r,function(t,e){0===e.indexOf("x-cos-grant-")&&(r[e]=i(r[e]))}),s.call(this,{Action:"name/cos:PutObjectACL",method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,action:"acl",headers:r,body:o},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},optionsObject:function(t,e){var r=t.Headers;r.Origin=t.Origin,r["Access-Control-Request-Method"]=t.AccessControlRequestMethod,r["Access-Control-Request-Headers"]=t.AccessControlRequestHeaders,s.call(this,{Action:"name/cos:OptionsObject",method:"OPTIONS",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:r},function(t,r){if(t)return t.statusCode&&403===t.statusCode?e(null,{OptionsForbidden:!0,statusCode:t.statusCode}):e(t);var o=r.headers||{};e(null,{AccessControlAllowOrigin:o["access-control-allow-origin"],AccessControlAllowMethods:o["access-control-allow-methods"],AccessControlAllowHeaders:o["access-control-allow-headers"],AccessControlExposeHeaders:o["access-control-expose-headers"],AccessControlMaxAge:o["access-control-max-age"],statusCode:r.statusCode,headers:r.headers})})},putObjectCopy:function(t,e){var r=(t.CopySource||"").match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^\/]+\/(.+)$/);if(r){var o=r[1],i=r[3],n=decodeURIComponent(r[4]);s.call(this,{Scope:[{action:"name/cos:GetObject",bucket:o,region:i,prefix:n},{action:"name/cos:PutObject",bucket:t.Bucket,region:t.Region,prefix:t.Key}],method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers},function(t,r){if(t)return e(t);var o=c.clone(r.CopyObjectResult||{});c.extend(o,{statusCode:r.statusCode,headers:r.headers}),e(null,o)})}else e({error:"CopySource format error"})},deleteMultipleObject:function(t,e){var r=t.Objects||[],o=t.Quiet;r=c.isArray(r)?r:[r];var i=c.json2xml({Delete:{Object:r,Quiet:o||!1}}),n=t.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=c.binaryBase64(c.md5(i));var a=c.map(r,function(e){return{action:"name/cos:DeleteObject",bucket:t.Bucket,region:t.Region,prefix:e.Key}});s.call(this,{Scope:a,method:"POST",Bucket:t.Bucket,Region:t.Region,body:i,action:"delete",headers:n},function(t,r){if(t)return e(t);var o=r.DeleteResult||{},i=o.Deleted||[],n=o.Error||[];i=c.isArray(i)?i:[i],n=c.isArray(n)?n:[n];var a=c.clone(o);c.extend(a,{Error:n,Deleted:i,statusCode:r.statusCode,headers:r.headers}),e(null,a)})},restoreObject:function(t,e){var r=t.Headers;if(t.RestoreRequest){var o=t.RestoreRequest||{},i=c.json2xml({RestoreRequest:o});r["Content-Type"]="application/xml",r["Content-MD5"]=c.binaryBase64(c.md5(i)),s.call(this,{Action:"name/cos:RestoreObject",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,body:i,action:"restore",headers:r},function(t,r){e(t,r)})}else e({error:"missing param RestoreRequest"})},uploadPartCopy:function(t,e){var r=(t.CopySource||"").match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^\/]+\/(.+)$/);if(r){var o=r[1],i=r[3],n=decodeURIComponent(r[4]);s.call(this,{Scope:[{action:"name/cos:GetObject",bucket:o,region:i,prefix:n},{action:"name/cos:PutObject",bucket:t.Bucket,region:t.Region,prefix:t.Key}],method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,qs:{partNumber:t.PartNumber,uploadId:t.UploadId},headers:t.Headers},function(t,r){if(t)return e(t);var o=c.clone(r.CopyPartResult||{});c.extend(o,{statusCode:r.statusCode,headers:r.headers}),e(null,o)})}else e({error:"CopySource format error"})},multipartInit:function(t,e){s.call(this,{Action:"name/cos:InitiateMultipartUpload",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,action:"uploads",headers:t.Headers},function(t,r){return t?e(t):(r=c.clone(r||{}))&&r.InitiateMultipartUploadResult?e(null,c.extend(r.InitiateMultipartUploadResult,{statusCode:r.statusCode,headers:r.headers})):void e(null,r)})},multipartUpload:function(t,e){var r=this;c.getFileSize("multipartUpload",t,function(){c.getBodyMd5(r.options.UploadCheckContentMd5,t.Body,function(o){o&&(t.Headers["Content-MD5"]=c.binaryBase64(o)),s.call(r,{Action:"name/cos:UploadPart",TaskId:t.TaskId,method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,qs:{partNumber:t.PartNumber,uploadId:t.UploadId},headers:t.Headers,onProgress:t.onProgress,body:t.Body||null},function(t,r){if(t)return e(t);r.headers=r.headers||{},e(null,{ETag:r.headers.etag||"",statusCode:r.statusCode,headers:r.headers})})})})},multipartComplete:function(t,e){for(var r=this,o=t.UploadId,i=t.Parts,a=0,l=i.length;a<l;a++)0!==i[a].ETag.indexOf('"')&&(i[a].ETag='"'+i[a].ETag+'"');var u=c.json2xml({CompleteMultipartUpload:{Part:i}}),d=t.Headers;d["Content-Type"]="application/xml",d["Content-MD5"]=c.binaryBase64(c.md5(u)),s.call(this,{Action:"name/cos:CompleteMultipartUpload",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,qs:{uploadId:o},body:u,headers:d},function(o,i){if(o)return e(o);var a=n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key,isLocation:!0}),s=i.CompleteMultipartUploadResult||{},l=c.extend(s,{Location:a,statusCode:i.statusCode,headers:i.headers});e(null,l)})},multipartList:function(t,e){var r={};r.delimiter=t.Delimiter,r["encoding-type"]=t.EncodingType,r.prefix=t.Prefix||"",r["max-uploads"]=t.MaxUploads,r["key-marker"]=t.KeyMarker,r["upload-id-marker"]=t.UploadIdMarker,r=c.clearKey(r),s.call(this,{Action:"name/cos:ListMultipartUploads",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r,action:"uploads"},function(t,r){if(t)return e(t);if(r&&r.ListMultipartUploadsResult){var o=r.ListMultipartUploadsResult.Upload||[],i=r.ListMultipartUploadsResult.CommonPrefixes||[];i=c.isArray(i)?i:[i],o=c.isArray(o)?o:[o],r.ListMultipartUploadsResult.Upload=o,r.ListMultipartUploadsResult.CommonPrefixes=i}var n=c.clone(r.ListMultipartUploadsResult||{});c.extend(n,{statusCode:r.statusCode,headers:r.headers}),e(null,n)})},multipartListPart:function(t,e){var r={};r.uploadId=t.UploadId,r["encoding-type"]=t.EncodingType,r["max-parts"]=t.MaxParts,r["part-number-marker"]=t.PartNumberMarker,s.call(this,{Action:"name/cos:ListParts",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);var o=r.ListPartsResult||{},i=o.Part||[];i=c.isArray(i)?i:[i],o.Part=i;var n=c.clone(o);c.extend(n,{statusCode:r.statusCode,headers:r.headers}),e(null,n)})},multipartAbort:function(t,e){var r={};r.uploadId=t.UploadId,s.call(this,{Action:"name/cos:AbortMultipartUpload",method:"DELETE",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},getObjectUrl:function(t,e){var r=this,o=n({ForcePathStyle:r.options.ForcePathStyle,protocol:t.Protocol||r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key});if(void 0!==t.Sign&&!t.Sign)return e(null,{Url:o}),o;var i=a.call(this,{Action:"PUT"===(t.Method||"").toUpperCase()?"name/cos:PutObject":"name/cos:GetObject",Bucket:t.Bucket||"",Region:t.Region||"",Method:t.Method||"get",Key:t.Key,Expires:t.Expires},function(t,r){if(e){if(t)return void e(t);var i=o;i+="?"+(r.Authorization.indexOf("q-signature")>-1?r.Authorization:"sign="+encodeURIComponent(r.Authorization)),r.XCosSecurityToken&&(i+="&x-cos-security-token="+r.XCosSecurityToken),r.ClientIP&&(i+="&clientIP="+r.ClientIP),r.ClientUA&&(i+="&clientUA="+r.ClientUA),r.Token&&(i+="&token="+r.Token),setTimeout(function(){e(null,{Url:i})})}});return i?o+"?"+i.Authorization+(i.XCosSecurityToken?"&x-cos-security-token="+i.XCosSecurityToken:""):o},getAuth:function(t){return c.getAuth({SecretId:t.SecretId||this.options.SecretId||"",SecretKey:t.SecretKey||this.options.SecretKey||"",Method:t.Method,Key:t.Key,Query:t.Query,Headers:t.Headers,Expires:t.Expires,SystemClockOffset:this.options.SystemClockOffset})}};t.exports.init=function(t,e){e.transferToTaskMethod(u,"postObject"),c.each(u,function(e,r){t.prototype[r]=c.apiWrapper(r,e)})}},function(t,e,r){var o=r(0),i={};t.exports.transferToTaskMethod=function(t,e){i[e]=t[e],t[e]=function(t,r){t.SkipTask?i[e].call(this,t,r):this._addTask(e,t,r)}},t.exports.init=function(t){var e=[],r={},n=0,a=0,s=function(t){var e={id:t.id,Bucket:t.Bucket,Region:t.Region,Key:t.Key,FilePath:t.FilePath,state:t.state,loaded:t.loaded,size:t.size,speed:t.speed,percent:t.percent,hashPercent:t.hashPercent,error:t.error};return t.FilePath&&(e.FilePath=t.FilePath),e},l=function(){t.emit("list-update",{list:o.map(e,s)})},c=function(){var r;if(e.length>t.options.UploadQueueSize)for(r=0;r<e.length&&e.length>t.options.UploadQueueSize&&r<a;r++)e[r]&&"waiting"===e[r].state||(e.splice(r,1),a--)},u=function(){if(a<e.length&&n<t.options.FileParallelLimit){var r=e[a];if("waiting"===r.state){n++,r.state="checking";var s=o.formatParams(r.api,r.params);i[r.api].call(t,s,function(e,o){t._isRunningTask(r.id)&&("checking"!==r.state&&"uploading"!==r.state||(r.state=e?"error":"success",e&&(r.error=e),n--,l(),u(t),r.callback&&r.callback(e,o),"success"===r.state&&(r.params&&(delete r.params.Body,delete r.params),delete r.callback)),c())}),l()}a++,u(t)}},d=function(e,o){var i=r[e];if(i){var a=i&&"waiting"===i.state,s=i&&("checking"===i.state||"uploading"===i.state);if("canceled"===o&&"canceled"!==i.state||"paused"===o&&a||"paused"===o&&s){if("paused"===o&&i.params.Body&&"function"==typeof i.params.Body.pipe)return;i.state=o,t.emit("inner-kill-task",{TaskId:e,toState:o}),l(),s&&(n--,u(t)),"canceled"===o&&(i.params&&(delete i.params.Body,delete i.params),delete i.callback)}c()}};t._addTasks=function(e){o.each(e,function(e){t._addTask(e.api,e.params,e.callback,!0)}),l()},t._addTask=function(i,n,a,s){n=o.formatParams(i,n);var d=o.uuid();n.TaskId=d,n.TaskReady&&n.TaskReady(d);var h={params:n,callback:a,api:i,index:e.length,id:d,Bucket:n.Bucket,Region:n.Region,Key:n.Key,FilePath:n.FilePath||"",state:"waiting",loaded:0,size:0,speed:0,percent:0,hashPercent:0,error:null},p=n.onHashProgress;n.onHashProgress=function(e){t._isRunningTask(h.id)&&(h.hashPercent=e.percent,p&&p(e),l())};var f=n.onProgress;return n.onProgress=function(e){t._isRunningTask(h.id)&&("checking"===h.state&&(h.state="uploading"),h.loaded=e.loaded,h.size=e.total,h.speed=e.speed,h.percent=e.percent,f&&f(e),l())},r[d]=h,e.push(h),h.size=n.FileSize,!s&&l(),u(t),c(),d},t._isRunningTask=function(t){var e=r[t];return!(!e||"checking"!==e.state&&"uploading"!==e.state)},t.getTaskList=function(){return o.map(e,s)},t.cancelTask=function(t){d(t,"canceled")},t.pauseTask=function(t){d(t,"paused")},t.restartTask=function(t){var e=r[t];!e||"paused"!==e.state&&"error"!==e.state||(e.state="waiting",l(),a=Math.min(a,e.index),u())}}}])},function(t,e){t.exports=o;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function o(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function i(t){return!0===(t&&t.__isLong__)}o.prototype.__isLong__,Object.defineProperty(o.prototype,"__isLong__",{value:!0}),o.isLong=i;var n={},a={};function s(t,e){var r,o,i;return e?(i=0<=(t>>>=0)&&t<256)&&(o=a[t])?o:(r=c(t,(0|t)<0?-1:0,!0),i&&(a[t]=r),r):(i=-128<=(t|=0)&&t<128)&&(o=n[t])?o:(r=c(t,t<0?-1:0,!1),i&&(n[t]=r),r)}function l(t,e){if(isNaN(t))return e?y:_;if(e){if(t<0)return y;if(t>=f)return v}else{if(t<=-g)return S;if(t+1>=g)return E}return t<0?l(-t,e).neg():c(t%p|0,t/p|0,e)}function c(t,e,r){return new o(t,e,r)}o.fromInt=s,o.fromNumber=l,o.fromBits=c;var u=Math.pow;function d(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return _;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var o;if((o=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===o)return d(t.substring(1),e,r).neg();for(var i=l(u(r,8)),n=_,a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a),c=parseInt(t.substring(a,a+s),r);if(s<8){var h=l(u(r,s));n=n.mul(h).add(l(c))}else n=(n=n.mul(i)).add(l(c))}return n.unsigned=e,n}function h(t,e){return"number"==typeof t?l(t,e):"string"==typeof t?d(t,e):c(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}o.fromString=d,o.fromValue=h;var p=4294967296,f=p*p,g=f/2,m=s(1<<24),_=s(0);o.ZERO=_;var y=s(0,!0);o.UZERO=y;var b=s(1);o.ONE=b;var T=s(1,!0);o.UONE=T;var C=s(-1);o.NEG_ONE=C;var E=c(-1,2147483647,!1);o.MAX_VALUE=E;var v=c(-1,-1,!0);o.MAX_UNSIGNED_VALUE=v;var S=c(0,-2147483648,!1);o.MIN_VALUE=S;var D=o.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},D.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var e=l(t),r=this.div(e),o=r.mul(e).sub(this);return r.toString(t)+o.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=l(u(t,6),this.unsigned),n=this,a="";;){var s=n.div(i),c=(n.sub(s.mul(i)).toInt()>>>0).toString(t);if((n=s).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},D.isZero=function(){return 0===this.high&&0===this.low},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&this.high<0},D.isPositive=function(){return this.unsigned||this.high>=0},D.isOdd=function(){return 1==(1&this.low)},D.isEven=function(){return 0==(1&this.low)},D.equals=function(t){return i(t)||(t=h(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},D.eq=D.equals,D.notEquals=function(t){return!this.eq(t)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(t){return this.comp(t)<0},D.lt=D.lessThan,D.lessThanOrEqual=function(t){return this.comp(t)<=0},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(t){return this.comp(t)>0},D.gt=D.greaterThan,D.greaterThanOrEqual=function(t){return this.comp(t)>=0},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(t){if(i(t)||(t=h(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(b)},D.neg=D.negate,D.add=function(t){i(t)||(t=h(t));var e=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,a=t.high>>>16,s=65535&t.high,l=t.low>>>16,u=0,d=0,p=0,f=0;return p+=(f+=n+(65535&t.low))>>>16,d+=(p+=o+l)>>>16,u+=(d+=r+s)>>>16,u+=e+a,c((p&=65535)<<16|(f&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},D.subtract=function(t){return i(t)||(t=h(t)),this.add(t.neg())},D.sub=D.subtract,D.multiply=function(t){if(this.isZero())return _;if(i(t)||(t=h(t)),r)return c(r.mul(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned);if(t.isZero())return _;if(this.eq(S))return t.isOdd()?S:_;if(t.eq(S))return this.isOdd()?S:_;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return l(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,o=65535&this.high,n=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,d=t.low>>>16,p=65535&t.low,f=0,g=0,y=0,b=0;return y+=(b+=a*p)>>>16,g+=(y+=n*p)>>>16,y&=65535,g+=(y+=a*d)>>>16,f+=(g+=o*p)>>>16,g&=65535,f+=(g+=n*d)>>>16,g&=65535,f+=(g+=a*u)>>>16,f+=e*p+o*d+n*u+a*s,c((y&=65535)<<16|(b&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},D.mul=D.multiply,D.divide=function(t){if(i(t)||(t=h(t)),t.isZero())throw Error("division by zero");var e,o,n;if(r)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?c((this.unsigned?r.div_u:r.div_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:_;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return T;n=y}else{if(this.eq(S))return t.eq(b)||t.eq(C)?S:t.eq(S)?b:(e=this.shr(1).div(t).shl(1)).eq(_)?t.isNegative()?b:C:(o=this.sub(t.mul(e)),n=e.add(o.div(t)));if(t.eq(S))return this.unsigned?y:_;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=_}for(o=this;o.gte(t);){e=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(e)/Math.LN2),s=a<=48?1:u(2,a-48),d=l(e),p=d.mul(t);p.isNegative()||p.gt(o);)p=(d=l(e-=s,this.unsigned)).mul(t);d.isZero()&&(d=b),n=n.add(d),o=o.sub(p)}return n},D.div=D.divide,D.modulo=function(t){return i(t)||(t=h(t)),r?c((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return c(~this.low,~this.high,this.unsigned)},D.and=function(t){return i(t)||(t=h(t)),c(this.low&t.low,this.high&t.high,this.unsigned)},D.or=function(t){return i(t)||(t=h(t)),c(this.low|t.low,this.high|t.high,this.unsigned)},D.xor=function(t){return i(t)||(t=h(t)),c(this.low^t.low,this.high^t.high,this.unsigned)},D.shiftLeft=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):c(0,this.low<<t-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):c(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(t){if(i(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?c(this.low>>>t|e<<32-t,e>>>t,this.unsigned):c(32===t?e:e>>>t-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},D.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},D.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},o.fromBytes=function(t,e,r){return r?o.fromBytesLE(t,e):o.fromBytesBE(t,e)},o.fromBytesLE=function(t,e){return new o(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},o.fromBytesBE=function(t,e){return new o(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */!function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(5),ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var createOutputMethod=function(t){return function(e){return new Md5(!0).update(e)[t]()}},createMethod=function(){var t=createOutputMethod("hex");NODE_JS&&(t=nodeWrap(t)),t.create=function(){return new Md5},t.update=function(e){return t.create().update(e)};for(var e=0;e<OUTPUT_TYPES.length;++e){var r=OUTPUT_TYPES[e];t[r]=createOutputMethod(r)}return t},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(t){if("string"==typeof t)return crypto.createHash("md5").update(t,"utf8").digest("hex");if(null==t)throw ERROR;return t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),Array.isArray(t)||ArrayBuffer.isView(t)||t.constructor===Buffer?crypto.createHash("md5").update(new Buffer(t)).digest("hex"):method(t)};return nodeMethod};function Md5(t){if(t)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var e=new ArrayBuffer(68);this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(t){if(!this.finalized){var e,r=typeof t;if("string"!==r){if("object"!==r)throw ERROR;if(null===t)throw ERROR;if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||ARRAY_BUFFER&&ArrayBuffer.isView(t)))throw ERROR;e=!0}for(var o,i,n=0,a=t.length,s=this.blocks,l=this.buffer8;n<a;){if(this.hashed&&(this.hashed=!1,s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)if(ARRAY_BUFFER)for(i=this.start;n<a&&i<64;++n)l[i++]=t[n];else for(i=this.start;n<a&&i<64;++n)s[i>>2]|=t[n]<<SHIFT[3&i++];else if(ARRAY_BUFFER)for(i=this.start;n<a&&i<64;++n)(o=t.charCodeAt(n))<128?l[i++]=o:o<2048?(l[i++]=192|o>>6,l[i++]=128|63&o):o<55296||o>=57344?(l[i++]=224|o>>12,l[i++]=128|o>>6&63,l[i++]=128|63&o):(o=65536+((1023&o)<<10|1023&t.charCodeAt(++n)),l[i++]=240|o>>18,l[i++]=128|o>>12&63,l[i++]=128|o>>6&63,l[i++]=128|63&o);else for(i=this.start;n<a&&i<64;++n)(o=t.charCodeAt(n))<128?s[i>>2]|=o<<SHIFT[3&i++]:o<2048?(s[i>>2]|=(192|o>>6)<<SHIFT[3&i++],s[i>>2]|=(128|63&o)<<SHIFT[3&i++]):o<55296||o>=57344?(s[i>>2]|=(224|o>>12)<<SHIFT[3&i++],s[i>>2]|=(128|o>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&o)<<SHIFT[3&i++]):(o=65536+((1023&o)<<10|1023&t.charCodeAt(++n)),s[i>>2]|=(240|o>>18)<<SHIFT[3&i++],s[i>>2]|=(128|o>>12&63)<<SHIFT[3&i++],s[i>>2]|=(128|o>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&o)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[e>>2]|=EXTRA[3&e],e>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,t[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var t,e,r,o,i,n,a=this.blocks;this.first?e=((e=((t=((t=a[0]-680876937)<<7|t>>>25)-271733879<<0)^(r=((r=(-271733879^(o=((o=(-1732584194^2004318071&t)+a[1]-117830708)<<12|o>>>20)+t<<0)&(-271733879^t))+a[2]-1126478375)<<17|r>>>15)+o<<0)&(o^t))+a[3]-1316259209)<<22|e>>>10)+r<<0:(t=this.h0,e=this.h1,r=this.h2,e=((e+=((t=((t+=((o=this.h3)^e&(r^o))+a[0]-680876936)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[1]-389564586)<<12|o>>>20)+t<<0)&(t^e))+a[2]+606105819)<<17|r>>>15)+o<<0)&(o^t))+a[3]-1044525330)<<22|e>>>10)+r<<0),e=((e+=((t=((t+=(o^e&(r^o))+a[4]-176418897)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[5]+1200080426)<<12|o>>>20)+t<<0)&(t^e))+a[6]-1473231341)<<17|r>>>15)+o<<0)&(o^t))+a[7]-45705983)<<22|e>>>10)+r<<0,e=((e+=((t=((t+=(o^e&(r^o))+a[8]+1770035416)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[9]-1958414417)<<12|o>>>20)+t<<0)&(t^e))+a[10]-42063)<<17|r>>>15)+o<<0)&(o^t))+a[11]-1990404162)<<22|e>>>10)+r<<0,e=((e+=((t=((t+=(o^e&(r^o))+a[12]+1804603682)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[13]-40341101)<<12|o>>>20)+t<<0)&(t^e))+a[14]-1502002290)<<17|r>>>15)+o<<0)&(o^t))+a[15]+1236535329)<<22|e>>>10)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[1]-165796510)<<5|t>>>27)+e<<0)^e))+a[6]-1069501632)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[11]+643717713)<<14|r>>>18)+o<<0)^o))+a[0]-373897302)<<20|e>>>12)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[5]-701558691)<<5|t>>>27)+e<<0)^e))+a[10]+38016083)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[15]-660478335)<<14|r>>>18)+o<<0)^o))+a[4]-405537848)<<20|e>>>12)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[9]+568446438)<<5|t>>>27)+e<<0)^e))+a[14]-1019803690)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[3]-187363961)<<14|r>>>18)+o<<0)^o))+a[8]+1163531501)<<20|e>>>12)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[13]-1444681467)<<5|t>>>27)+e<<0)^e))+a[2]-51403784)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[7]+1735328473)<<14|r>>>18)+o<<0)^o))+a[12]-1926607734)<<20|e>>>12)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[5]-378558)<<4|t>>>28)+e<<0))+a[8]-2022574463)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[11]+1839030562)<<16|r>>>16)+o<<0))+a[14]-35309556)<<23|e>>>9)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[1]-1530992060)<<4|t>>>28)+e<<0))+a[4]+1272893353)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[7]-155497632)<<16|r>>>16)+o<<0))+a[10]-1094730640)<<23|e>>>9)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[13]+681279174)<<4|t>>>28)+e<<0))+a[0]-358537222)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[3]-722521979)<<16|r>>>16)+o<<0))+a[6]+76029189)<<23|e>>>9)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[9]-640364487)<<4|t>>>28)+e<<0))+a[12]-421815835)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[15]+530742520)<<16|r>>>16)+o<<0))+a[2]-995338651)<<23|e>>>9)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[0]-198630844)<<6|t>>>26)+e<<0)|~r))+a[7]+1126891415)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[14]-1416354905)<<15|r>>>17)+o<<0)|~t))+a[5]-57434055)<<21|e>>>11)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[12]+1700485571)<<6|t>>>26)+e<<0)|~r))+a[3]-1894986606)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[10]-1051523)<<15|r>>>17)+o<<0)|~t))+a[1]-2054922799)<<21|e>>>11)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[8]+1873313359)<<6|t>>>26)+e<<0)|~r))+a[15]-30611744)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[6]-1560198380)<<15|r>>>17)+o<<0)|~t))+a[13]+1309151649)<<21|e>>>11)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[4]-145523070)<<6|t>>>26)+e<<0)|~r))+a[11]-1120210379)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[2]+718787259)<<15|r>>>17)+o<<0)|~t))+a[9]-343485551)<<21|e>>>11)+r<<0,this.first?(this.h0=t+1732584193<<0,this.h1=e-271733879<<0,this.h2=r-1732584194<<0,this.h3=o+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+r<<0,this.h3=this.h3+o<<0)},Md5.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,o=this.h3;return HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,o=this.h3;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&o,o>>8&255,o>>16&255,o>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),e=new Uint32Array(t);return e[0]=this.h0,e[1]=this.h1,e[2]=this.h2,e[3]=this.h3,t},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var t,e,r,o="",i=this.array(),n=0;n<15;)t=i[n++],e=i[n++],r=i[n++],o+=BASE64_ENCODE_CHAR[t>>>2]+BASE64_ENCODE_CHAR[63&(t<<4|e>>>4)]+BASE64_ENCODE_CHAR[63&(e<<2|r>>>6)]+BASE64_ENCODE_CHAR[63&r];return t=i[n],o+(BASE64_ENCODE_CHAR[t>>>2]+BASE64_ENCODE_CHAR[t<<4&63]+"==")};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()}).call(this,__webpack_require__(3),__webpack_require__(4))},function(t,e){var r,o,i=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(t){r=n}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(t){o=a}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&p())}function p(){if(!u){var t=s(h);u=!0;for(var e=c.length;e;){for(l=c,c=[];++d<e;)l&&l[d].run();d=-1,e=c.length}l=null,u=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||u||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,r){"use strict";function o(){this.VERSION="2.3.3",this.REPORT_VERSION=this.VERSION+"_20190821_1108",this.NATIVEVERSION="web",this.PLATFORM="web",this.SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whiteboard?sdkappid=",this.TEST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/whiteboard?sdkappid=",this.COS_SERVER_URL="https://cloud.tim.qq.com/v4/ilvb_cos/cos",this.TEST_COS_SERVER_URL="https://cloud-test.tim.qq.com/v4/ilvb_cos_test/cos",this.WHITELIST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whitelist?sdkappid=",this.TEST_WHITELIST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/whitelist?sdkappid=",this.SUB_CMD={GET_BOARD_DATA:"get_board_data",REPORT_BOARD_DATA:"report_board_data"},this.PROGRESS_ENABLE=!1,this.PROGRESS_SHOW_DELAY=100,this.COMMON_GROUP="#DEFAULT",this.COMMON_DEFAULT_BOARD="#DEFAULT",this.SCALE=100,this.MAX_SCALE=1600,this.MIN_SCALE=100,this.RATIO="16:9",this.THIN=100,this.SMOOTH_LEVEL=.1,this.MIN_LINE_WIDTH=1,this.MIN_FONT_SIZE=10,this.TEXT_MAX_LENGTH=2e3,this.TEXT_SIZE=320,this.TEXT_COLOR=0,this.TEXT_FONT_FAMILY="customFontFamily,sans-serif,serif,monospace",this.DATA_SYNC_ENABLE=!0,this.PRELOAD_DEPTH=5,this.TEXT_FONT_STYLE={NORMAL:0,BOLD:1,ITALIC:2,BOLD_ITALIC:3},this.FILE_TYPE={IMG:0,H5:1},this.ABOUTBLANK="about:blank",this.penCursorIcon="https://tic-res-1259648581.file.myqcloud.com/board/icons/pen2.png",this.laserCursorIcon="https://tic-res-1259648581.file.myqcloud.com/board/icons/laserpen.png",this.ICONS={0:{cursor:"auto"},1:{cursor:"none",offset:[0,0]},2:{cursor:"auto"},3:{cursor:"none"},4:{cursor:"crosshair"},5:{cursor:"crosshair"},6:{cursor:"crosshair"},7:{cursor:"crosshair"},8:{cursor:"crosshair"},9:{cursor:"auto"},10:{cursor:"crosshair"},11:{cursor:"text"},12:{cursor:"move"}},this.PROTOCOL_ACTION={LINE_START_ACTION:1,LINE_MOVE_ACTION:2,LINE_END_ACTION:3,RASER_SHOW_ACTION:6,RASER_HIDE_ACTION:7,ERASER_ACTION:8,MOVE_LINE_GRAPH_ACTION:9,GRAPH_LINE_ACTION:10,GRAPH_CIRCLE_ACTION:11,GRAPH_RECT_ACTION:12,INPUT_TEXT_ACTION:13,GRAPH_CLEAR_ALL_ACTION:101,GRAPH_CLEAR_ACTION:102,FILE_CLEAR_ACTION:103,RESET_DATA_ACTION:104,SET_BOARD_RATIO_ACTION:105,SET_BOARD_FIT_MODE_ACTION:106,UPDATE_BG_IMG_ACTION:201,DELETE_BG_IMG_ACTION:202,UPDATE_BG_COLOR_ACTION:203,BOARD_MOVE_SCALE_ACTION:301,SWITCH_ACTION:401,ADD_FILE_ACTION:501}}r.r(e),o.prototype.setPlatform=function(t){this.PLATFORM=t},o.prototype.setNativeVersion=function(t){this.NATIVEVERSION=t};var i=new o,n=function(t,e){this.user=t,this.type=e.type,this.seq=e.seq},a=r(1),s=r.n(a),l={serverTime:0,localTime:0,localServerTimeDiff:0,seq:0,getCurrentTimeStamp(){return isNaN(this.localServerTimeDiff)&&(this.localServerTimeDiff=0),Date.now()-this.localServerTimeDiff},getSeq(){var t=parseInt(this.getCurrentTimeStamp()/1e3);return 1*new s.a(t>>>0<<15|32767&this.seq++,t>>>0>>17).toString()}},c={decimalToRgba(t){var e=[];return t.replace(/../g,function(t){e.push(parseInt(t,16))}),"rgba("+e.join(",")+",1)"},hexToRgba(t){var e;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(e=t.substring(1).split("")).length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),t="#"+e.join(""),"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+",1)"},rgbaToDecimal(t){for(var e=t.toString().match(/\d+/g),r="",o=0;o<3;o++)r+=("0"+Number(e[o]).toString(16)).slice(-2);return r},dealColor(t){if(t<0)return"rgba("+(t>>24&255)+","+(t>>16&255)+","+(t>>8&255)+",1)";var e=parseInt(t).toString(16);return e=(e="000000"+(e=e.substr(0,e.length-2))).substring(e.length-6,e.length),this.decimalToRgba(e)},formatColor(t){var e=this.rgbaToDecimal(t);return parseInt(e+"ff",16)},getEffectivePoint:(t,e)=>(t<=0?t=Math.floor(e/2):t>=1e4&&(t=1e4-Math.floor(e/2)),t),getAVSdkTimestamp(){var t=this.getTimeStamp()+"",e=t.substring(0,5)+"00000000",r=t.substr(5),o=parseInt(e,10).toString(2).substr(-32);return parseInt(o,2)+(4294967295&r)},getTimeStamp:()=>l.getCurrentTimeStamp(),getSecondTime(){return parseInt(this.getTimeStamp()/1e3)},getTimeDiff(t){return this.getTimeStamp()-t},boardId2Fid:t=>t.substring(t.indexOf("#")),boardId2Uid(t){if(t===i.COMMON_DEFAULT_BOARD)return"";var e="";try{e=(e=t.substring(0,t.match(/_\d+_\d+_#\w+$/).index)).substring(e.indexOf("_")+1)}catch(t){}return e},boardIdGetSeq:t=>t.match(/\d+_#/)[0].replace(/\D/gi,""),isCosUrl:t=>t.indexOf("myqcloud.com")>-1&&t.indexOf("cos")>-1,cosUrlExtractFileName(t){t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e=t.substring(t.lastIndexOf("/")+1);return t.indexOf("-1257240443")>-1&&e.match(/\d+_/)&&(e=e.substr(e.match(/^\d+_/)[0].length)),decodeURIComponent(e)},fileDownLoadUrlToPreviewUrl(t){if(t.startsWith("https")||(t=t.startsWith("http")?t.replace("http","https"):"https://"+t),t.endsWith("/"))return t;t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e="//";t.indexOf(e)>-1&&(t=t.substring(t.indexOf(e)+e.length)),e=".";var r=t.indexOf(e);return e=".com","https://"+t.substr(0,r)+".preview.myqcloud.com"+t.substring(t.indexOf(e)+e.length)+"?cmd=doc_preview&of=pic&page="},fontStyle2CanvasFontStyle(t){var e="";return 0===t?e="":1===t?e="bold":2===t?e="italic":3===t&&(e="italic bold"),e+" "},maxCommonDivisor(t,e){return 0!=e?this.maxCommonDivisor(e,t%e):t},calcRatioWidthHeight(t,e){var r,o;try{var i=t.split(":");r=1*i[0],r=isNaN(r)?e.split(":")[0]:r,o=1*i[1],o=isNaN(o)?e.split(":")[1]:o}catch(t){return this.calcRatioWidthHeight(e)}return{ratioWidth:r,ratioHeight:o}},isMobile:()=>/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),isIOS:()=>/iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase()),canvasTextAutoLine(t,e,r,o,i,n,a){var s=0,l=0,c=e.split("\n"),u=0,d=0,h=a||i-r-10-2-1,p=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,f=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return c.forEach((e,i)=>{if(i>0&&(o+=n),s=0,l=0,""==e)t.fillText(e,r,o),u+=n,s=0;else for(let i=0;i<e.length;i++)p.test(e[i])||f.test(e[i])?s+=2*t.measureText("M").width:s+=t.measureText("M").width,d=Math.max(d,s),s>h+t.measureText(e[i]).width/2&&(t.fillText(e.substring(l,i),r,o,h),d=Math.min(d,h),u+=n,o+=n,s=0,l=i,--i),i==e.length-1&&(t.fillText(e.substring(l,e.length),r,o,h),u+=n)}),[d,u]},calcCanvasTextWidthAndHeight(t,e,r,o,i,n,a=1e4){var s=0,l=e.split("\n"),c=0,u=0,d=Math.min(Math.max(i-r-Math.floor(100*i/1e4),30),a),h=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,p=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return l.forEach((e,r)=>{if(s=0,""==e)c+=n,s=0;else for(let r=0;r<e.length&&(h.test(e[r])||p.test(e[r])?s+=2*t.measureText("M").width:s+=t.measureText("M").width,u=Math.max(u,s),!(s>d&&(u=Math.min(u,d),c+=n,s=0,--r<0)));r++)r==e.length-1&&(c+=n)}),[u,c]},calcCanvasTextHeight(t,e,r,o,i,n){var a=0,s=0;return e.split("\n").forEach((e,o)=>{o>0&&(s+=s),a=0;for(let o=0;o<e.length;o++)(a+=t.measureText(e[o]).width)>i-r-10-2-1&&(a=0,s+=n),o==e.length-1&&(s+=s)}),s},parseQueryString(t){var e={},r=[],o="",i="",n=t.substring(t.indexOf("?")+1,t.length).split("&");for(var a in n)o=(r=n[a].split("="))[0],i=r[1],e[o]=i;return e}};function u(t,e){this.user=t,this.type="line",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.show=e.show,this.status="begin",this.select=!1,this.color=e.color,this.time=c.getTimeStamp(),this.thin=e.thin,this.startSeq=e.belongSeq,this.endSeq=0,this.lines=[{x:e.x,y:e.y,belongSeq:e.belongSeq,seq:e.seq}],this.fitCurve=[],this.border={maxX:e.x,maxY:e.y,minX:e.x,minY:e.y}}u.prototype.setBorder=function(t,e){t+this.thin>this.border.maxX&&(this.border.maxX=c.getEffectivePoint(t+this.thin,this.thin)),t-this.thin<this.border.minX&&(this.border.minX=c.getEffectivePoint(t-this.thin,this.thin)),e+this.thin>this.border.maxY&&(this.border.maxY=c.getEffectivePoint(e+this.thin,this.thin)),e-this.thin<this.border.minY&&(this.border.minY=c.getEffectivePoint(e-this.thin,this.thin))},u.prototype.sort=function(){this.lines.sort(function(t,e){return t.seq-e.seq})};var d=u,h=function(t,e){this.user=t,this.type="graph",this.graph=e.graph,this.seq=e.seq,this.show=e.show,this.status="begin",this.select=!1,this.time=c.getTimeStamp(),this.color=e.color,this.thin=e.thin,this.solid=e.solid||!1,this.style=e.style,this.startPoint={x:e.beginPoint.x,y:e.beginPoint.y,seq:e.beginPoint.seq},this.endPoint={x:e.endPoint.x,y:e.endPoint.y,seq:e.endPoint.seq}},p=function(t,e){this.user=t,this.type="select",this.seq=Math.floor(100*Math.random()),this.show=!0,this.color=e.color,this.startInfo={x:e.startx,y:e.starty},this.location={x:e.x,y:e.y}},f=function(t,e){this.user=t,this.type="raser",this.seq=e.seq,this.show=!0,this.status=1,this.color=e.color,this.radius=e.radius,this.location={x:e.x,y:e.y}},g=function(t,e){this.user=t,this.type="inputtext",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.scale=1,this.color=0,this.typeFace="",this.textSize=0,this.fontStyle=0,this.time=c.getTimeStamp(),this.text="",this.show=!0,this.textWidth=0,this.textHeight=0,this.location={x:e.x,y:e.y}},m={BOARD_ACTION_TYPE:{LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",MOVE:"move","GRAPH-LINE":"graph-line","GRAPH-CIRCLE":"graph-circle","GRAPH-RECT":"graph-rect","GRAPH-OVAL":"graph-oval","GRAPH-CIRCLE-SOLID":"graph-circle-solid","GRAPH-RECT-SOLID":"graph-rect-solid","GRAPH-OVAL-SOLID":"graph-oval-solid",INPUTTEXT:"inputtext",MOUSE:"mouse",ZOOM:"zoom","GRAPH-STRAIGHTLINE":"graph-straightLine","GRAPH-ELLIPSE":"graph-ellipse"},BOARD_MODE:{BOARD:0,FILE:1},BACKGROUND_TYPE:{IMAGE:0,H5:1},FILL_MODE:{DEFAULT:0,LEFT:4,TOP:5,RIGHT:6,BOTTOM:7},COLOR:{RED:4278190335,WHITE:4294967295},EVENT:{HISTROY_DATA_COMPLETE:"histroy_data_complete",ADD_BOARD:"add_board",RT_DATA:"real_time_data",REAL_TIME_DATA:"real_time_data",ADD_DATA_ERROR:"add_data_error",DELETE_BOARD:"delete_board",SWITCH_BOARD:"switch_board",ADD_FILE:"add_group",ADD_H5PPT_FILE:"add_h5ppt_file",DELETE_FILE:"delete_group",SWITCH_FILE:"switch_group",IMG_START_LOAD:"img_start_load",IMG_LOAD:"img_load",IMG_ERROR:"img_error",IMG_ABORT:"img_abort",PRELOAD:"preload",BOARD_CAN_UNDO:"board_can_undo",BOARD_CAN_REDO:"board_can_redo",VERIFY_SDK_SUCC:"verify_sdk_succ",VERIFY_SDK_ERROR:"verify_sdk_error",CANVAS_MOUSEDOWN:"canvas_mousedown",CANVAS_MOUSEMOVE:"canvas_mousemove",CANVAS_MOUSEUP:"canvas_mouseup",CANVAS_MOUSELEAVE:"canvas_mouseleave",CANVAS_TOUCHSTART:"canvas_touchstart",CANVAS_TOUCHMOVE:"canvas_touchmove",CANVAS_TOUCHEND:"CANVAS_touchend",CANVAS_TOUCHCANCEL:"canvas_touchcancel",UPDATE_BACKGROUND_IMAGE_SUCCESS:"update_background_image_success",UPDATE_BACKGROUND_IMAGE_ERROR:"update_background_image_error",COS:{GET_SIGN_ERROR:"get_sign_error",TASK_READY:"task_ready",HASH_PROGRESS:"hash_progress",PROGRESS:"progress",GET_SIGN_SUCCESS:"get_sign_success",DOES_NOT_SUPPORT_UPLOAD:"does_not_support_upload",UPLOAD_SUCCESS:"upload_success",UPLOAD_ERROR:"upload_error"}}};function _(){this.wxSysData=wx.getSystemInfoSync()}_.prototype={APIURL:"https://ilivelog.qcloud.com",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){this.defDatas.brand=this.wxSysData.brand,this.defDatas.model=this.wxSysData.model,this.defDatas.platform=this.wxSysData.platform,this.defDatas.system=this.wxSysData.system,this.defDatas.weixinversion=this.wxSysData.version;try{t=this.fillDatas(t),wx.request({url:this.APIURL,data:JSON.stringify(t),method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){},fail:function(t){}})}catch(t){}},fillDatas:function(t){var e={};for(var r in this.defDatas)["sdkappid","classid","userid"].indexOf(r)>=0?e[r]=this.defDatas[r]:e[r]=void 0!==t[r]?t[r]:this.defDatas[r];return e},datasParseToString:function(t){var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},reporterHandel:function(){return function(t){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:{action:"",version:i.VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:"miniprog",log_time:0,business:"ticsdk",roomid:0,boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:null,userAgent:null,cookie:null,brand:null,model:null,platform:null,system:null,weixinversion:null},setSdkAppid:function(t){null!=t&&null!=t&&(this.defDatas.sdkappid=t)},setRoomId:function(t){null!=t&&null!=t&&(this.defDatas.roomid=t)},setUserId:function(t){null!=t&&null!=t&&(this.defDatas.userid=t)},boardAction(t,e){this.report(t,e)},report(t,e={}){try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:c.getTimeStamp()}))}catch(t){}}};var y=new _;function b(t){if(this.permissions=!1,this.reportEnable=!1,this.option=Object.assign({},t),!this.option.tlsData)throw new Error("not found sdkAppId|userId|userSig");if(!this.option.tlsData.sdkAppId)throw new Error("not found sdkAppId");if(!this.option.tlsData.identifier)throw new Error("not found userId");if(!this.option.tlsData.userSig)throw new Error("not found userSig");this.BOARD_URL=(t.isTest?i.TEST_SERVER_URL:i.SERVER_URL)+this.option.tlsData.sdkAppId,this.COS_SERVER_URL=t.isTest?i.TEST_COS_SERVER_URL:i.COS_SERVER_URL,this.WHITELIST_SERVER_URL=(t.isTest?i.TEST_WHITELIST_SERVER_URL:i.WHITELIST_SERVER_URL)+this.option.tlsData.sdkAppId}b.prototype.setPermissions=function(t=!1){this.permissions=t},b.prototype.setReportEnable=function(t=!1){this.reportEnable=t},b.prototype.reportMsg=function(t,e,r){this.option.classId&&this.permissions&&this.reportEnable&&(t={cmd:"open_conf_svc",sub_cmd:"report_board_data",conf_id:parseInt(this.option.classId,10),board_data_list:t},this.post(t,e,r))},b.prototype.getBoardData=function(t=!0,e,r){var o={first_time:t,cmd:"open_conf_svc",sub_cmd:"get_board_data",seq:l.getSeq(),conf_id:parseInt(this.option.classId,10),version:1};this.post(o,e,r)},b.prototype.getLineData=function(t,e,r){var o=c.getTimeStamp(),i={cmd:"open_conf_svc",sub_cmd:"get_line",conf_id:parseInt(this.option.classId,10),boardId:t.boardId,owner:t.owner,seq:t.seq};this.post(i,t=>{y.report("getLineData",{action_result:0,time_consume:c.getTimeStamp()-o,extra_info:JSON.stringify(t)}),e&&e(t)},t=>{y.report("getLineData",{action_result:-1,time_consume:c.getTimeStamp()-o,extra_info:JSON.stringify(t)}),r&&r(t)})},b.prototype.getFileInfo=function(t,e,r){var o=c.getTimeStamp(),i={cmd:"open_conf_svc",sub_cmd:"get_file",conf_id:parseInt(this.option.classId,10),fid:t.fid};this.post(i,t=>{y.report("getFileInfo",{action_result:0,time_consume:c.getTimeStamp()-o,extra_info:JSON.stringify(t)}),e&&e(t)},t=>{y.report("getFileInfo",{action_result:-1,time_consume:c.getTimeStamp()-o,extra_info:JSON.stringify(t)}),r&&r(t)})},b.prototype.getDocTotalPage=function(t){return this.getPromise(t,{responseType:"blob"})},b.prototype.getCosAuthData=function(){var t=this.COS_SERVER_URL+`?SdkAppId=${this.option.tlsData.sdkAppId}&Identifier=${this.option.tlsData.identifier}&UserSig=${this.option.tlsData.identifier}`;return this.postPromise(t,{cmd:"open_cos_svc",sub_cmd:"get_cos_token",duration:300,version:1})},b.prototype.applyPermissions=function(){var t=this.WHITELIST_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(t,{cmd:"open_conf_svc",sub_cmd:"verify_sdk",sdkappid:1*this.option.tlsData.sdkAppId})},b.prototype.post=function(t,e,r){var o=this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;wx.request({url:o,data:t,method:"POST",header:{"content-type":"application/json"},success:function(t){e(t.data)},fail:r})},b.prototype.postPromise=function(t,e){return t=t||this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier,new Promise((r,o)=>{wx.request({url:t,data:e,method:"POST",header:{"content-type":"application/json"},success:function(t){r(t)},fail:function(){o.apply(this,arguments)}})})},b.prototype.getPromise=function(t,e){return t=t||this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier,new Promise((r,o)=>{wx.request({url:t,data:e,method:"GET",header:{"content-type":"application/json"},responseType:"arraybuffer",success:function(t){r(t)},fail:function(){o.apply(this,arguments)}})})};var T=b;function C(t){this.request=t}C.prototype.reportCreateBoards=function(t,e){var r;if(0!==(r=Array.isArray(e)?e:[e]).length){var o=c.getTimeStamp();this.request.reportMsg([{type:"createBoards",seq:l.getSeq(),content:{fid:c.boardId2Fid(r[0]),createBoards:r,updateTime:c.getTimeStamp()}}],function(e){e.ErrorCode||e.error_code?y.boardAction("createBoards",{action_result:e.ErrorCode?`ErrorCode:${e.ErrorCode}`:`error_code:${e.error_code}`,action_info:e.ErrorInfo||e.error_msg,time_consume:c.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("createBoards",{action_result:0,action_info:null,time_consume:c.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){y.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:c.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})}},C.prototype.reportDeleteBoard=function(t,e){var r=c.getTimeStamp();this.request.reportMsg([{type:"deleteBoards",seq:l.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:c.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?y.boardAction("deleteBoards",{action_result:o.ErrorCode?`ErrorCode:${o.ErrorCode}`:`error_code:${o.error_code}`,action_info:o.ErrorInfo||o.error_msg,time_consume:c.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):y.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:c.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(o){y.boardAction("deleteBoards",{action_result:-9999,action_info:o&&o.message,time_consume:c.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},C.prototype.reportSetBoardBgColor=function(t,e){var r=c.getTimeStamp();this.request.reportMsg([{type:"setBoardBG",seq:l.getSeq(),content:{boardId:t,updateTime:c.getTimeStamp(),colorRGBA:e}}],function(o){o.ErrorCode||o.error_code?y.boardAction("setBoardBG",{action_result:o.ErrorCode?`ErrorCode:${o.ErrorCode}`:`error_code:${o.error_code}`,action_info:o.ErrorInfo||o.error_msg,time_consume:c.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):y.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:c.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(o){y.boardAction("setBoardBG",{action_result:-9999,action_info:o&&o.message,time_consume:c.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},C.prototype.reportClear=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"clean",seq:l.getSeq(),content:{boardId:t,updateTime:c.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("clean",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("clean",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("clean",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},C.prototype.reportClearDraws=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"cleanDraws",seq:l.getSeq(),content:{boardId:t,updateTime:c.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("cleanDraws",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("cleanDraws",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},C.prototype.reportImage=function(t,e,r=m.FILL_MODE.DEFAULT,o=m.BACKGROUND_TYPE.IMAGE){var i=c.getTimeStamp();this.request.reportMsg([{type:"image",seq:l.getSeq(),content:{fid:c.boardId2Fid(t),boardId:t,url:e,updateTime:c.getTimeStamp(),type:o,mode:r}}],function(r){var o={};o[t]=e,r.ErrorCode||r.error_code?y.boardAction("image",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("image",{action_result:0,action_info:null,time_consume:c.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o={};o[t]=e,y.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})})},C.prototype.reportImages=function(t){for(var e=c.getTimeStamp(),r=0,o=Math.ceil(t.length/100);r<o;r++){var i;i=t.slice(100*r,100*(r+1)),this.request.reportMsg(i,function(r){var o=[];t.forEach(t=>{var e={};e[t.content.boardId]=t.content.url,o.push(e)}),r.ErrorCode||r.error_code?y.boardAction("image",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("image",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o=[];t.forEach(t=>{var e={};e[t.content.boardId]=t.content.url,o.push(e)}),y.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})})}},C.prototype.reportSwitchBoard=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"switchBoard",seq:l.getSeq(),content:{boardId:t,updateTime:c.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("switchBoard",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("switchBoard",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},C.prototype.reportGlobalBgColor=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"setGlobalBG",seq:l.getSeq(),content:{updateTime:c.getTimeStamp(),colorRGBA:t}}],function(r){r.ErrorCode||r.error_code?y.boardAction("setGlobalBG",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):y.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(r){y.boardAction("setGlobalBG",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},C.prototype.reportAddLine=function(t){c.getTimeStamp(),this.request.reportMsg([{type:"addLine",seq:l.getSeq(),content:t}],function(t){t.ErrorCode||t.error_code},function(t){})},C.prototype.reportAddText=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"addText",seq:l.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?y.boardAction("addText",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):y.boardAction("addText",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){y.boardAction("addText",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},C.prototype.reportDisplayLine=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"displayLine",seq:l.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?y.boardAction("displayLine",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):y.boardAction("displayLine",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(r){y.boardAction("displayLine",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},C.prototype.reportGraphData=function(t){var e=c.getTimeStamp();this.request.reportMsg(t,function(r){t.forEach(t=>{r.ErrorCode||r.error_code?y.boardAction(t.type,{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):y.boardAction(t.type,{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})},function(r){t.forEach(t=>{y.boardAction(t.type,{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})})},C.prototype.reportAddFile=function(t){var e=t.fid,r=t.title,o=t.downloadURL,i=t.pageCount,n=t.currentPageIndex,a=t.currentPageStep,s=t.uid,u=t.timestamp,d=t.platform,h=t.type,p=c.getTimeStamp();this.request.reportMsg([{type:"addFile",seq:l.getSeq(),content:{updateTime:c.getTimeStamp(),fid:e,title:r,downloadURL:o,pageCount:i,currentPageIndex:n,currentPageStep:a,uid:s,timestamp:u,platform:d,type:h}}],function(t){t.ErrorCode||t.error_code?y.boardAction("addFile",{action_result:t.ErrorCode?`ErrorCode:${t.ErrorCode}`:`error_code:${t.error_code}`,action_info:t.ErrorInfo||t.error_msg,time_consume:c.getTimeDiff(p),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r}):y.boardAction("addFile",{action_result:0,action_info:null,time_consume:c.getTimeDiff(p),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r})},function(t){y.boardAction("addFile",{action_result:-9999,action_info:t&&t.message,time_consume:c.getTimeDiff(p),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r})})},C.prototype.reportDeleteFile=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"deleteFile",seq:l.getSeq(),content:{fid:t,updateTime:c.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("deleteFile",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):y.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(r){y.boardAction("deleteFile",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},C.prototype.reportsetBoardRatio=function(t){this.request.reportMsg([{type:"setRatio",seq:l.getSeq(),content:{ratio:t}}],function(t){},function(t){})},C.prototype.reportCleanAll=function(){var t=c.getTimeStamp();this.request.reportMsg([{type:"cleanAll",seq:l.getSeq()}],e=>{e.ErrorCode||e.error_code?y.boardAction("cleanAll",{action_result:e.ErrorCode?`ErrorCode:${e.ErrorCode}`:`error_code:${e.error_code}`,action_info:e.ErrorInfo||e.error_msg,time_consume:c.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:c.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},e=>{y.boardAction("cleanAll",{action_result:-9999,action_info:e&&e.message,time_consume:c.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})};var E=C,v={postMessage(t,e){t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")},init(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"init",data:e},"*")},count(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"count"},"*")},getCurrentSlideIndex(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_slide_index"},"*")},getCurrentStepIndex(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_step_index"},"*")},getCurrentStepCount(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_step_count"},"*")},nextPage(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"next_page"},"*")},prevPage(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"prev_page"},"*")},gotoNextStep(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"next_step_new",data:e},"*")},gotoPreviousStep(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"prev_step_new",data:e},"*")},gotoSlide(t,e,r){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_slide",data:{slideIndex:e,autoStart:r}},"*")},gotoTimestamp(t,e,r,o,i){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_timestamp",data:{slideIndex:e,stepIndex:r,autoStart:o,timeOffset:i}},"*")},gotoTimestampNew(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_timestamp_new",data:{slideIndex:e.slideIndex,stepIndex:e.stepIndex,resetStep:e.resetStep,usePrevNextStepMethod:e.usePrevNextStepMethod,isPassive:e.isPassive}},"*")},clearIframeCache(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"clear_cache"},"*")},setFid(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"set_fid",data:e},"*")}},S=1,D=3,A=2,x=4,O=6,B=7,I=0;function R(){}R.prototype={APIURL:"https://ilivelog.qcloud.com",method:"POST",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){try{t.userAgent=navigator.userAgent,t=this.fillDatas(t);var e=this.getXHR();e.onreadystatechange=this.reporterHandel(e),e.open(this.method,this.APIURL,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(JSON.stringify(t))}catch(t){}},fillDatas:function(t){var e={};for(var r in this.defDatas)["sdkappid","classid","userid"].indexOf(r)>=0?e[r]=this.defDatas[r]:(e[r]=void 0!==t[r]?t[r]:this.defDatas[r],"boardid_list"===r&&(e[r]=JSON.stringify(this.defDatas[r])),"roomid"===r&&(e[r]=this.defDatas[r]+""));return e.device=i.PLATFORM,e.nativeVersion=i.NATIVEVERSION,e},datasParseToString:function(t){var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},getXHR:function(){var t=null,e=window.ActiveXObject;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(e)try{t=new e("Msxml2.XMLHTTP")}catch(r){try{t=new e("Microsoft.XMLHTTP")}catch(t){}}if(null!=t)return t},reporterHandel:function(t){return function(){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:{action:"",version:i.REPORT_VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:i.PLATFORM,log_time:0,business:"ticsdk",roomid:"",boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:"unknown",userAgent:null},setSdkAppid:function(t){null!=t&&null!=t&&(this.defDatas.sdkappid=t)},setRoomId:function(t){null!=t&&null!=t&&(this.defDatas.roomid=t)},setUserId:function(t){null!=t&&null!=t&&(this.defDatas.userid=t)},boardAction(t,e){this.report(t,e)},report(t,e={}){try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:c.getTimeStamp()}))}catch(t){}}};var P=new R;function w(t){this.request=t}function N(t,e,r,o,i,n){var a,s,l;return a=function(t,e,r,o){var i,n,a,s,l,c,u,d,h,p,f,g,m,_,y,b,T,C=t[0],E=t[t.length-1];for(i=[C,null,null,E],n=F.zeros_Xx2x2(e.length),m=0,_=e.length;m<_;m++)T=1-(b=e[m]),(a=n[m])[0]=F.mulItems(r,3*b*(T*T)),a[1]=F.mulItems(o,3*T*(b*b));for(s=[[0,0],[0,0]],l=[0,0],m=0,_=t.length;m<_;m++)b=e[m],a=n[m],s[0][0]+=F.dot(a[0],a[0]),s[0][1]+=F.dot(a[0],a[1]),s[1][0]+=F.dot(a[0],a[1]),s[1][1]+=F.dot(a[1],a[1]),y=F.subtract(t[m],U.q([C,C,E,E],b)),l[0]+=F.dot(a[0],y),l[1]+=F.dot(a[1],y);return c=s[0][0]*s[1][1]-s[1][0]*s[0][1],u=s[0][0]*l[1]-s[1][0]*l[0],d=l[0]*s[1][1]-l[1]*s[0][1],p=0===c?0:u/c,(h=0===c?0:d/c)<(f=1e-6*(g=F.vectorLen(F.subtract(C,E))))||p<f?(i[1]=F.addArrays(C,F.mulItems(r,g/3)),i[2]=F.addArrays(E,F.mulItems(o,g/3))):(i[1]=F.addArrays(C,F.mulItems(r,h)),i[2]=F.addArrays(E,F.mulItems(o,p))),i}(t,r,o,i),[s,l]=function(t,e,r){var o,i,n,a,s,l,c,u;i=0,n=t.length/2;const d=q(e,10);for(s=0,l=t.length;s<l;s++)c=t[s],u=M(e,r[s],d,10),(o=(a=F.subtract(U.q(e,u),c))[0]*a[0]+a[1]*a[1])>i&&(i=o,n=s);return[i,n]}(t,a,e),n&&n({bez:a,points:t,params:e,maxErr:s,maxPoint:l}),[a,s,l]}function L(t,e,r){return r.map((r,o)=>(function(t,e,r){var o=F.subtract(U.q(t,r),e),i=U.qprime(t,r),n=F.mulMatrix(o,i),a=F.sum(F.squareItems(i))+2*F.mulMatrix(o,U.qprimeprime(t,r));return 0===a?r:r-n/a})(t,e[o],r))}w.prototype.reportCreateBoards=function(t,e){var r;if(0!==(r=Array.isArray(e)?e:[e]).length){var o=c.getTimeStamp();this.request.reportMsg([{type:"createBoards",seq:l.getSeq(),content:{fid:c.boardId2Fid(r[0]),createBoards:r,updateTime:c.getTimeStamp()}}],function(e){e.ErrorCode||e.error_code?P.boardAction("createBoards",{action_result:e.ErrorCode?`ErrorCode:${e.ErrorCode}`:`error_code:${e.error_code}`,action_info:e.ErrorInfo||e.error_msg,time_consume:c.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):P.boardAction("createBoards",{action_result:0,action_info:null,time_consume:c.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){P.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:c.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})}},w.prototype.reportDeleteBoard=function(t,e){var r=c.getTimeStamp();this.request.reportMsg([{type:"deleteBoards",seq:l.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:c.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?P.boardAction("deleteBoards",{action_result:o.ErrorCode?`ErrorCode:${o.ErrorCode}`:`error_code:${o.error_code}`,action_info:o.ErrorInfo||o.error_msg,time_consume:c.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):P.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:c.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(o){P.boardAction("deleteBoards",{action_result:-9999,action_info:o&&o.message,time_consume:c.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},w.prototype.reportSetBoardBgColor=function(t,e){var r=c.getTimeStamp();this.request.reportMsg([{type:"setBoardBG",seq:l.getSeq(),content:{boardId:t,updateTime:c.getTimeStamp(),colorRGBA:e}}],function(o){o.ErrorCode||o.error_code?P.boardAction("setBoardBG",{action_result:o.ErrorCode?`ErrorCode:${o.ErrorCode}`:`error_code:${o.error_code}`,action_info:o.ErrorInfo||o.error_msg,time_consume:c.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):P.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:c.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(o){P.boardAction("setBoardBG",{action_result:-9999,action_info:o&&o.message,time_consume:c.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},w.prototype.reportClear=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"clean",seq:l.getSeq(),content:{boardId:t,updateTime:c.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?P.boardAction("clean",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):P.boardAction("clean",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){P.boardAction("clean",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},w.prototype.reportClearDraws=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"cleanDraws",seq:l.getSeq(),content:{boardId:t,updateTime:c.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?P.boardAction("cleanDraws",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):P.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){P.boardAction("cleanDraws",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},w.prototype.reportImage=function(t,e,r=m.FILL_MODE.DEFAULT,o=m.BACKGROUND_TYPE.IMAGE){var i=c.getTimeStamp();this.request.reportMsg([{type:"image",seq:l.getSeq(),content:{fid:c.boardId2Fid(t),boardId:t,url:e,updateTime:c.getTimeStamp(),type:o,mode:r}}],function(r){var o={};o[t]=e,r.ErrorCode||r.error_code?P.boardAction("image",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null}):P.boardAction("image",{action_result:0,action_info:null,time_consume:c.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o={};o[t]=e,P.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})})},w.prototype.reportImages=function(t){for(var e=c.getTimeStamp(),r=0,o=Math.ceil(t.length/100);r<o;r++){var i;i=t.slice(100*r,100*(r+1)),this.request.reportMsg(i,function(r){var o=[];t.forEach(t=>{var e={};e[t.content.boardId]=t.content.url,o.push(e)}),r.ErrorCode||r.error_code?P.boardAction("image",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null}):P.boardAction("image",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o=[];t.forEach(t=>{var e={};e[t.content.boardId]=t.content.url,o.push(e)}),P.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})})}},w.prototype.reportSwitchBoard=function(t){var e=t.boardId,r=t.fid,o=t.url,i=t.type,n=t.page,a=t.step,s=t.ratio,u=t.scale,d=c.getTimeStamp();this.request.reportMsg([{type:"switchBoard",seq:l.getSeq(),content:{boardId:e,fid:r,url:o,type:i,page:n,step:a,ratio:s,scale:u,updateTime:c.getTimeStamp()}}],function(t){t.ErrorCode||t.error_code?P.boardAction("switchBoard",{action_result:t.ErrorCode?`ErrorCode:${t.ErrorCode}`:`error_code:${t.error_code}`,action_info:t.ErrorInfo||t.error_msg,time_consume:c.getTimeDiff(d),boardid:e,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):P.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:c.getTimeDiff(d),boardid:e,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(t){P.boardAction("switchBoard",{action_result:-9999,action_info:t&&t.message,time_consume:c.getTimeDiff(d),boardid:e,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},w.prototype.reportGlobalBgColor=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"setGlobalBG",seq:l.getSeq(),content:{updateTime:c.getTimeStamp(),colorRGBA:t}}],function(r){r.ErrorCode||r.error_code?P.boardAction("setGlobalBG",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):P.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(r){P.boardAction("setGlobalBG",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},w.prototype.reportAddLine=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"addLine",seq:l.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?P.boardAction("addLine",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):P.boardAction("addLine",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){P.boardAction("addLine",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},w.prototype.reportAddText=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"addText",seq:l.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?P.boardAction("addText",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):P.boardAction("addText",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){P.boardAction("addText",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},w.prototype.reportDisplayLine=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"displayLine",seq:l.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?P.boardAction("displayLine",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):P.boardAction("displayLine",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(r){P.boardAction("displayLine",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},w.prototype.reportGraphData=function(t){var e=c.getTimeStamp();this.request.reportMsg(t,function(r){t.forEach(t=>{r.ErrorCode||r.error_code?P.boardAction(t.type,{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):P.boardAction(t.type,{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})},function(r){t.forEach(t=>{P.boardAction(t.type,{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})})},w.prototype.reportAddFile=function(t){var e=t.fid,r=t.title,o=t.downloadURL,n=t.pageCount,a=t.currentPageIndex,s=t.currentPageStep,u=t.uid,d=t.timestamp,h=t.platform,p=t.type,f=t.ratio,g=t.scale,m=t.isTranscodeFile,_=c.getTimeStamp();this.request.reportMsg([{type:"addFile",seq:l.getSeq(),content:{updateTime:c.getTimeStamp(),fid:e,title:r,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:f,scale:g,isTranscodeFile:m}}],function(t){t.ErrorCode||t.error_code?P.boardAction("addFile",{action_result:t.ErrorCode?`ErrorCode:${t.ErrorCode}`:`error_code:${t.error_code}`,action_info:t.ErrorInfo||t.error_msg,time_consume:c.getTimeDiff(_),extra_info:JSON.stringify({downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:f,scale:g,isTranscodeFile:m}),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r}):P.boardAction("addFile",{action_result:0,action_info:null,time_consume:c.getTimeDiff(_),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r,extra_info:JSON.stringify({downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:f,scale:g,isTranscodeFile:m})})},function(t){P.boardAction("addFile",{action_result:-9999,action_info:t&&t.message,time_consume:c.getTimeDiff(_),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r,extra_info:JSON.stringify({downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:f,scale:g,isTranscodeFile:m})})})},w.prototype.reportDeleteFile=function(t){var e=c.getTimeStamp();this.request.reportMsg([{type:"deleteFile",seq:l.getSeq(),content:{fid:t,updateTime:c.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?P.boardAction("deleteFile",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):P.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(r){P.boardAction("deleteFile",{action_result:-9999,action_info:r&&r.message,time_consume:c.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},w.prototype.reportDrag=function(t){this.request.reportMsg([{type:"drag",seq:l.getSeq(),content:t}],function(t){},function(t){})},w.prototype.reportsetBoardRatio=function(t){this.request.reportMsg([{type:"setRatio",seq:l.getSeq(),content:t}],function(t){},function(t){})},w.prototype.reportsetBoardContentFitMode=function(t){this.request.reportMsg([{type:"setBoardContentFitMode",seq:l.getSeq(),content:t}],function(t){},function(t){})},w.prototype.reportCleanAll=function(){var t=c.getTimeStamp();this.request.reportMsg([{type:"cleanAll",seq:l.getSeq()}],e=>{e.ErrorCode||e.error_code?P.boardAction("cleanAll",{action_result:e.ErrorCode?`ErrorCode:${e.ErrorCode}`:`error_code:${e.error_code}`,action_info:e.ErrorInfo||e.error_msg,time_consume:c.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):P.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:c.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},e=>{P.boardAction("cleanAll",{action_result:-9999,action_info:e&&e.message,time_consume:c.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})};var q=function(t,e){for(var r,o=[0],i=t[0],n=0,a=1;a<=e;a++)r=U.q(t,a/e),n+=F.vectorLen(F.subtract(r,i)),o.push(n),i=r;return o.map(t=>t/n)};function M(t,e,r,o){if(e<0)return 0;if(e>1)return 1;for(var i,n,a,s,l=1;l<=o;l++)if(e<=r[l]){a=(l-1)/o,n=l/o,s=(e-(i=r[l-1]))/(r[l]-i)*(n-a)+a;break}return s}function k(t,e){return F.normalize(F.subtract(t,e))}class F{static zeros_Xx2x2(t){for(var e=[];t--;)e.push([0,0]);return e}static mulItems(t,e){return t.map(t=>t*e)}static mulMatrix(t,e){return t.reduce((t,r,o)=>t+r*e[o],0)}static subtract(t,e){return t.map((t,r)=>t-e[r])}static addArrays(t,e){return t.map((t,r)=>t+e[r])}static addItems(t,e){return t.map(t=>t+e)}static sum(t){return t.reduce((t,e)=>t+e)}static dot(t,e){return F.mulMatrix(t,e)}static vectorLen(t){return Math.hypot(...t)}static divItems(t,e){return t.map(t=>t/e)}static squareItems(t){return t.map(t=>t*t)}static normalize(t){return this.divItems(t,this.vectorLen(t))}}class U{static q(t,e){var r=1-e,o=F.mulItems(t[0],r*r*r),i=F.mulItems(t[1],3*r*r*e),n=F.mulItems(t[2],3*r*e*e),a=F.mulItems(t[3],e*e*e);return F.addArrays(F.addArrays(o,i),F.addArrays(n,a))}static qprime(t,e){var r=1-e,o=F.mulItems(F.subtract(t[1],t[0]),3*r*r),i=F.mulItems(F.subtract(t[2],t[1]),6*r*e),n=F.mulItems(F.subtract(t[3],t[2]),3*e*e);return F.addArrays(F.addArrays(o,i),n)}static qprimeprime(t,e){return F.addArrays(F.mulItems(F.addArrays(F.subtract(t[2],F.mulItems(t[1],2)),t[0]),6*(1-e)),F.mulItems(F.addArrays(F.subtract(t[3],F.mulItems(t[2],2)),t[1]),6*e))}}var G=
/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */
function(t,e,r){if(!Array.isArray(t))return[];let o=!0;if(t.forEach(e=>{Array.isArray(e)&&!e.some(t=>"number"!=typeof t)&&e.length===t[0].length||(o=!1)}),!o)return[];if((t=t.filter((e,r)=>0===r||!e.every((e,o)=>e===t[r-1][o]))).length<2)return[];const i=t.length,n=k(t[1],t[0]),a=k(t[i-2],t[i-1]);return function t(e,r,o,i,n){var a,s,l,c,u,d,h,p,f,g,m,_,y;if(2===e.length)return _=F.vectorLen(F.subtract(e[0],e[1]))/3,[a=[e[0],F.addArrays(e[0],F.mulItems(r,_)),F.addArrays(e[1],F.mulItems(o,_)),e[1]]];if(s=function(t){var e,r,o,i=[];return t.forEach((t,n)=>{e=n?r+F.vectorLen(F.subtract(t,o)):0,i.push(e),r=e,o=t}),i=i.map(t=>t/r)}(e),[a,c,d]=N(e,s,s,r,o,n),c<i)return[a];if(c<i*i)for(l=s,u=c,h=d,y=0;y<20;y++){if(l=L(a,e,l),[a,c,d]=N(e,s,l,r,o,n),c<i)return[a];if(d===h){let t=c/u;if(t>.9999&&t<1.0001)break}u=c,h=d}return m=[],(p=F.subtract(e[d-1],e[d+1])).every(t=>0===t)&&(p=F.subtract(e[d-1],e[d]),[p[0],p[1]]=[-p[1],p[0]]),f=F.normalize(p),g=F.mulItems(f,-1),(m=m.concat(t(e.slice(0,d+1),r,f,i,n))).concat(t(e.slice(d),g,o,i,n))}(t,n,a,e,r)},H=class{constructor(t){this.action=i.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION,this.scale=t.scale,this.xOffsetRatio=t.xOffsetRatio,this.yOffsetRatio=t.yOffsetRatio,this.xOffset=t.xOffset,this.yOffset=t.yOffset}update(t){Object.assign(this,t)}getReportData(){return{updateTime:c.getSecondTime(),xOffset:Math.floor(this.xOffset),yOffset:Math.floor(this.yOffset),scale:Math.floor(this.scale)}}getRealTimeData(){return{action:this.action,time:c.getTimeStamp(),seq:l.getSeq(),scale:Math.floor(this.scale),xOffset:Math.floor(this.xOffset),yOffset:Math.floor(this.yOffset)}}},j=class{constructor(){this.data={}}addDragData(t,e){this.data[t]||(this.data[t]=e)}getDragData(t){return this.data[t]}updateDragData(t,e){this.data[t].update(e)}};function K(t){this.event=t.event,this.options=JSON.parse(JSON.stringify(t)),this.preStep=t.preStep||2,this.context=t.context,this.maxSeq=0,this.request=new T(t),this.report=new E(this.request),this.permissions=0,"[object Undefined]"===Object.prototype.toString.call(t.syncHistroyEnable)||"[object Null]"===Object.prototype.toString.call(t.syncHistroyEnable)?this.syncHistroyEnable=!0:this.syncHistroyEnable=t.syncHistroyEnable,this.identifier=t.tlsData.identifier,this.classId=t.classId,this.user=t.tlsData.identifier,this.data={},this.progressEnable=i.PROGRESS_ENABLE,this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.pptFilePreloaded={},this.boardRatio={},this.dragDataList=new j,this.scale=this.options.scale||i.SCALE,this.ratio=this.options.ratio||i.RATIO,this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.color=0,this.thin=0,this.typeFace=i.TEXT_FONT_FAMILY,this.textSize=0,this.textColor="",this.fontStyle=i.TEXT_FONT_STYLE.NORMAL,this.smoothLevel=0,this.dataSyncEnable=!1,this.preloadDepth=0,this.globalBackgroundColor=0,this.type=null,this.transparent=!1,this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.containerWidth=0,this.containerHeight=0,this.boardWidth=0,this.boardHeight=0,this.ctx=null,this.boardContentFitMode=0,y.setSdkAppid(t.tlsData.sdkAppId),y.setRoomId(this.classId),y.setUserId(t.tlsData.identifier),this.applyPermissions(()=>{}),this.initInterval()}K.prototype.applyPermissions=function(t){var e=c.getTimeStamp();this.request.applyPermissions().then(r=>{0===r.data.error_code&&r.data.level?(l.localTime=c.getTimeStamp(),l.serverTime=r.data.server_time,l.localServerTimeDiff=l.localTime-l.serverTime,this.permissions=r.data.level,this.request.setPermissions(this.permissions),this.setDefaultBoard(),this.initData(this.options),t(),this.syncHistroyEnable&&this.classId&&this.syncHistroyData(),y.report("verify_sdk",{time_consume:c.getTimeStamp()-e,extra_info:JSON.stringify({permissions:this.permissions})}),this.event.fire(this,"TEB_INIT")):(l.localTime=c.getTimeStamp(),l.serverTime=r.data.server_time,l.localServerTimeDiff=l.localTime-l.serverTime,this.permissions=0,this.request.setPermissions(this.permissions),this.event.fire(this,"TEB_ERROR",A,"please purchase the service first"),this.setDefaultBoard(),this.initData(this.options),y.report("verify_sdk",{action_result:r.data.error_code,action_info:JSON.stringify(r.data),time_consume:c.getTimeStamp()-e,extra_info:JSON.stringify({permissions:this.permissions})})),this.setNeedDraw(!0)},t=>{l.localTime=c.getTimeStamp(),l.serverTime=c.getTimeStamp(),l.localServerTimeDiff=l.localTime-l.serverTime,this.permissions=0,this.request.setPermissions(this.permissions),this.event.fire(this,"TEB_ERROR",A,"please purchase the service first"),this.setDefaultBoard(),this.initData(this.options),y.report("verify_sdk",{action_result:-1,action_info:JSON.stringify(t),time_consume:c.getTimeStamp()-e,extra_info:JSON.stringify({permissions:this.permissions})}),this.setNeedDraw(!0)})},K.prototype.createBoardIdForFile=function(t,e,r,o,i){for(var n=1,a=[],s=0;s<o;s++){var l=`${i}_${e}_${r}_${n++}_${t}`;a.push(l)}return a},K.prototype.createBoardId=function(t=this.currentGroup,e){return 0==this.boardIdSeq?(this.boardIdSeq++,i.COMMON_DEFAULT_BOARD):(i.COMMON_GROUP,`${i.PLATFORM}_${this.identifier}_${e||c.getSecondTime()}_${this.boardIdSeq++}_${t}`)},K.prototype.initInterval=function(){this.sendInterval=setInterval(()=>{this.realTimeData.length>0&&this.sendRequest()},200)},K.prototype.resetData=function(){this.data={},this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.setDefaultBoard(),this.initData(this.options)},K.prototype.initData=function(t){this.setProgressEnable(t.progressEnable),this.setColor(t.brushColor),this.setThin(t.brushThin),this.setTextFontFamily(t.textFamily),this.setTextSize(t.textSize),this.setTextColor(t.textColor),this.setTextFontStyle(t.textStyle),this.setSmoothLevel(t.smoothLevel),this.setDataSyncEnable(t.dataSyncEnable),this.setPreloadDepth(t.preloadDepth),this.setBoardContentFitMode(t.boardContentFitMode,!1),"[object Undefined]"!==Object.prototype.toString.call(t.toolType)&&"[object Null]"!==Object.prototype.toString.call(t.toolType)||(t.toolType=1),this.setType(m.BOARD_ACTION_TYPE[["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"][t.toolType]]),this.setGlobalBackgroundColor(t.globalBackgroundColor,!0),this.setTransparent(t.transparent),this.setSelectArea(),setTimeout(()=>{this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())},500)},K.prototype.addBoard=function(t,e=!0){var r=[];if(Array.isArray(t))r=t;else{if(!t)return;r=[t]}var o={};for(var n in r.forEach((t,e)=>{this.userData[t]={},this.userData[t][this.identifier]=[],this.data[t]=[],this.opData[t]=[],this.opIndex[t]=0,this.backgroundColor[t]=this.globalBackgroundColor,this.backgroundPic[t]={url:"",user:t===i.COMMON_DEFAULT_BOARD?this.identifier:c.boardId2Uid(t),show:!0,mode:m.FILL_MODE.DEFAULT,type:m.BACKGROUND_TYPE.IMAGE},-1===this.boardList.indexOf(t)&&this.boardList.push(t);let r=c.boardId2Fid(t);o[r]||(o[r]=[]),o[r].push(t)}),o)this.event.fire(this,"TEB_ADDBOARD",o[n],n);return this.sortBoard(),e&&this.report.reportCreateBoards(this.currentBoard,r),this.boardList},K.prototype.findLine=function(t,e,r){var o,i=this.userData[t][e];for(let t=0,e=i.length;t<e;t++){const e=i[t];if("line"===e.type&&e.seq==r.belongSeq){o=e;break}}return o},K.prototype.setNeedDraw=function(t=!0){this.needDraw=t},K.prototype.getNeedDraw=function(){return this.needDraw},K.prototype.getBoardList=function(){return this.boardList},K.prototype.getBoardPicList=function(){return this.backgroundPic},K.prototype.setDefaultBoard=function(){this.currentGroup=i.COMMON_GROUP;var t=c.getSecondTime();this.addGroup(i.COMMON_GROUP,i.COMMON_GROUP,this.user,null,1,0,t,i.PLATFORM,i.FILE_TYPE.IMG,0),this.currentBoard=this.createBoardId(),this.addBoard(this.currentBoard,!1),this.setBackgroundColor(c.formatColor(this.globalBackgroundColor),!0),delete this.setDefaultBoard},K.prototype.removeBoard=function(t){Array.isArray(t)||(t=[t]);var e=[],r=[],o=!1,n={};for(let g=0,m=t.length;g<m;g++){var a,s=t[g];if(s!==i.COMMON_DEFAULT_BOARD&&(a=this.boardList.indexOf(s))>-1){e.push(s);let t=c.boardId2Fid(s);if(n[t]||(n[t]=[]),n[t].push(s),delete this.userData[s],delete this.data[s],delete this.opData[s],delete this.opIndex[s],delete this.backgroundColor[s],delete this.backgroundPic[s],s==this.currentBoard){o=!0;var l=this.getBoardByGroup(this.currentGroup),u=l.indexOf(s);if(this.currentBoard=0===u?l[u+1]:l[u-1],!this.currentBoard){var d=this.getBoardByGroup(i.COMMON_GROUP);this.currentBoard=d[this.getFileInfo(i.COMMON_GROUP).currentPageIndex]}}this.boardList.splice(a,1);var h=c.boardId2Fid(s),p=this.getBoardByGroup(h),f=this.getFileInfo(h);0===p.length?f&&(this.deleteGroup(h),r.push(h)):f&&(f.pageCount=f.pageCount-1,f.pageCount===f.currentPageIndex&&(f.currentPageIndex=f.currentPageIndex-1),this.updateFileInfo(f))}}var g=c.boardId2Fid(this.currentBoard),m=this.getBoardByGroup(g);for(var _ in(f=this.getFileInfo(g))&&(f.pageCount=m.length,f.currentPageIndex=m.indexOf(this.currentBoard),this.updateFileInfo(f)),this.currentGroup=c.boardId2Fid(this.currentBoard),n)this.event.fire(this,"TEB_DELETEBOARD",n[_],_);return o&&this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,c.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),{deleteBoards:e,deleteFids:r}},K.prototype.deleteBoard=function(t=this.currentBoard,e){var{deleteBoards:r,deleteFids:o}=this.removeBoard(t)||[];if(r.length){var n=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";n&&this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:n,time:c.getTimeStamp(),seq:l.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var a=[];e?o.indexOf(e)>-1?a=o:a.push(e):a=o;var s=this.getBoardByGroup(this.currentGroup),u=s.indexOf(this.currentBoard);this.realTimeData.push({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),toBoardId:this.currentBoard,deleteBoards:a.length?[]:r,deleteFiles:a.length?a:[],page:u,step:0}),this.report.reportDeleteBoard(r,this.currentBoard);var d=this.getFileInfo(this.currentGroup);d.currentPageIndex=u,d.currentPageStep=0,d.pageCount=s.length,this.report.reportAddFile(d)}return r},K.prototype.getGroup=function(){var t=Object.assign([],this.groups);return t.forEach(t=>{var e=[];t.type===i.FILE_TYPE.IMG&&(this.getBoardByGroup(t.fid)||[]).forEach(t=>{var r=new class{constructor(t,e,r){this.boardId=t||"",this.backgroundUrl="",e&&(this.backgroundUrl=e.url||""),this.backgroundColor=r||""}setBoardId(t){this.boardId=t}setBackgroundUrl(t){this.backgroundUrl=t}getBoardId(){return this.boardId}getBackgroundUrl(){return this.backgroundUrl}setBackgroundColor(t){this.backgroundColor=t}getBackgroundColor(){return this.backgroundColor}}(t,this.backgroundPic[t],this.backgroundColor[t]);e.push(r)}),t.boardInfoList=e}),t},K.prototype.getFileInfo=function(t=i.COMMON_GROUP){var e=null,r=this.getGroup();for(let o=0,i=r.length;o<i;o++){const i=r[o];if(t===i.fid){e=i;break}}return e},K.prototype.getBoardByGroup=function(t=i.COMMON_GROUP){return this.boardList.filter(e=>t===i.COMMON_GROUP&&e===i.COMMON_DEFAULT_BOARD||e.indexOf(`_${t}`)>-1)},K.prototype.addGroupNotReport=function(t,e,r,o,n,a,s,l=i.PLATFORM,c=i.FILE_TYPE.IMG,u,d,h){for(var p=!1,f=0,g=this.groups.length;f<g;f++)if(this.groups[f].fid==t){p=!0;break}if(p)return this.groups;c==i.FILE_TYPE.IMG?this.event.fire(this,"TEB_ADDFILE",t):this.event.fire(this,"TEB_ADDH5PPTFILE",t);var m={fid:t,title:e||t,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:u,uid:r,timestamp:s,platform:l,ratio:d,type:c,scale:h};return this.groups.push(m)},K.prototype.addGroup=function(t,e,r,o,n,a,s,l=i.PLATFORM,c=i.FILE_TYPE.IMG,u,d,h){for(var p=!1,f=0,g=this.groups.length;f<g;f++)if(this.groups[f].fid==t){p=!0;break}if(p)return this.groups;c==i.FILE_TYPE.IMG?this.event.fire(this,"TEB_ADDFILE",t):this.event.fire(this,"TEB_ADDH5PPTFILE",t);var m={fid:t,title:e||t,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:u,uid:r,timestamp:s,platform:l,ratio:d,type:c,scale:h};return t&&t!==i.COMMON_GROUP&&this.report.reportAddFile(m),this.groups.push(m)},K.prototype.deleteGroup=function(t,e=!0){if(t===i.COMMON_GROUP)return[];for(var r=-1,o=0,n=this.groups.length;o<n;o++)if(this.groups[o].fid==t){r=o;break}return r>-1&&(this.groups.splice(r,1),v.clearIframeCache(this.iframeDom)),e&&this.report.reportDeleteFile(t),this.getBoardByGroup(t)},K.prototype.setColor=function(t){t||(t=m.COLOR.RED),this.cancelSelect(),"number"==typeof t?this.color=c.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.color=t):this.color=c.hexToRgba(t)},K.prototype.getColor=function(){return this.color},K.prototype.setThin=function(t){t||(t=i.THIN),this.cancelSelect(),this.thin=t},K.prototype.getThin=function(){return this.thin},K.prototype.setSmoothLevel=function(t){"[object Undefined]"!==Object.prototype.toString.call(t)&&"[object Null]"!==Object.prototype.toString.call(t)||(t=i.SMOOTH_LEVEL),t=Math.max(0,Math.min(1,t)),this.smoothLevel=t},K.prototype.getSmoothLevel=function(){return this.smoothLevel},K.prototype.setTextSize=function(t){t||(t=i.TEXT_SIZE),this.cancelSelect(),this.textSize=t},K.prototype.getTextSize=function(){return this.textSize},K.prototype.setTextColor=function(t){t||(t=i.TEXT_COLOR),this.cancelSelect(),"number"==typeof t?this.textColor=c.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.textColor=t):this.textColor=c.hexToRgba(t)},K.prototype.getTextColor=function(){return this.textColor},K.prototype.setTextFontFamily=function(t){t||(t=i.TEXT_FONT_FAMILY),this.cancelSelect(),this.typeFace=t},K.prototype.getTextFontFamily=function(){return this.typeFace},K.prototype.setTextFontStyle=function(t){t||(t=i.TEXT_FONT_STYLE.NORMAL),this.cancelSelect(),this.fontStyle=t},K.prototype.getTextFontStyle=function(){return this.fontStyle},K.prototype.setDataSyncEnable=function(t=i.DATA_SYNC_ENABLE){this.request.setReportEnable(t),this.dataSyncEnable=t},K.prototype.isDataSyncEnable=function(){return this.dataSyncEnable},K.prototype.setProgressEnable=function(t=i.PROGRESS_ENABLE){this.progressEnable=t},K.prototype.isProgressEnable=function(){return this.progressEnable},K.prototype.setPreloadDepth=function(t=i.PRELOAD_DEPTH){this.preloadDepth=t},K.prototype.setType=function(t){var e=Object.values(m.BOARD_ACTION_TYPE);this.cancelSelect(),e.indexOf(t)>-1?this.type=t:this.type=m.BOARD_ACTION_TYPE.LINE},K.prototype.getType=function(){return this.type},K.prototype.setTransparent=function(t=!1){this.transparent=t},K.prototype.getTransparent=function(){return this.transparent},K.prototype.setBackgroundColor=function(t=m.COLOR.WHITE,e){var r=this.currentBoard;"object"==typeof t&&(r=t.boardId,t=t.color);var o=0;"number"==typeof t?(this.backgroundColor[r]=c.dealColor(t),o=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.backgroundColor[r]=t,o=c.formatColor(t)):(this.backgroundColor[r]=c.hexToRgba(t),o=c.formatColor(c.hexToRgba(t))),this.setNeedDraw(!0),e||(this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),color:o,isGlobal:0}),this.report.reportSetBoardBgColor(r,o))},K.prototype.getBackgroundColor=function(){return this.backgroundColor[this.getCurrentBoard()]},K.prototype.setSelectArea=function(t=0,e=0,r=0,o=0){this.selectArea={x:t,y:e,width:r,height:o}},K.prototype.getSelectArea=function(){return this.selectArea},K.prototype.getCurrentBoard=function(){return this.currentBoard},K.prototype.getCurrentFile=function(){return this.currentGroup},K.prototype.getData=function(){return this.data},K.prototype.getCurrentBoardData=function(){return{data:this.data[this.currentBoard],userData:this.userData[this.currentBoard],opData:this.opData[this.currentBoard],opIndex:this.opIndex[this.currentBoard],backgroundPic:this.backgroundPic[this.currentBoard],backgroundColor:this.backgroundColor[this.currentBoard],ratio:this.boardRatio[this.currentBoard],scale:this.getBoardScale()}},K.prototype.getCurrentBoardPic=function(){return this.backgroundPic[this.currentBoard]},K.prototype.getCurrentBoardColor=function(){return this.backgroundColor[this.currentBoard]},K.prototype.getSelectList=function(){return this.selectedList},K.prototype.clearBoard=function(t){this.currentBoard&&(this.data[this.currentBoard]=[],this.opData[this.currentBoard]=[],this.opIndex[this.currentBoard]=0,this.userData[this.currentBoard]={},this.userData[this.currentBoard][this.identifier]=[],t||(this.backgroundPic[this.currentBoard]={show:!1,mode:m.FILL_MODE.DEFAULT,url:"",type:m.BACKGROUND_TYPE.IMAGE,user:""},this.backgroundColor[this.currentBoard]=this.globalBackgroundColor),this.cancelSelect(),this.setNeedDraw(!0))},K.prototype.clearFileDrawData=function(t){t.forEach(t=>{(this.getBoardByGroup(t)||[]).forEach(t=>{this.data[t]=[],this.opData[t]=[],this.opIndex[t]=0,this.userData[t]={},this.userData[t][this.identifier]=[]})}),this.cancelSelect(),this.setNeedDraw(!0)},K.prototype.clear=function(){this.clearBoard(),this.realTimeData.push({action:101,seq:l.getSeq()}),this.report.reportClear(this.currentBoard)},K.prototype.clearDraws=function(){this.clearBoard(!0),this.realTimeData.push({action:102,seq:l.getSeq()}),this.report.reportClearDraws(this.currentBoard)},K.prototype.clearFileDraws=function(t){if(t){Array.isArray(t)||(t=[t]),this.clearFileDrawData(t);var e=[];t.forEach(t=>{e=e.concat(this.getBoardByGroup(t))}),this.realTimeData.push({action:i.PROTOCOL_ACTION.FILE_CLEAR_ACTION,seq:l.getSeq(),fids:t}),this.report.reportClearDraws(e)}},K.prototype.clearAll=function(){this.report.reportCleanAll(),this.realTimeData.push({action:i.PROTOCOL_ACTION.RESET_DATA_ACTION,seq:l.getSeq()}),this.sendRequest(),this.resetData()},K.prototype.addBackgroundPic=function({boardIds:t,urls:e,type:r=m.BACKGROUND_TYPE.IMAGE,needReport:o=!0,position:n=m.FILL_MODE.DEFAULT}){var a=[],s=[];if(Array.isArray(t)){if(!Array.isArray(e)||t.length!=e.length)return!1;a=t,s=e}else{if(Array.isArray(e))return!1;a=[t],s=[e]}var u=[];this.cancelSelect(),a.forEach((t,e)=>{t===this.currentBoard&&o&&this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:encodeURI(s[e]),time:c.getTimeStamp(),seq:l.getSeq(),mode:n,type:r,cleanBoard:0}),this.data[t]||this.addBoard(t),this.backgroundPic[t].url=s[e],this.backgroundPic[t].show=!0,this.backgroundPic[t].mode=n,this.backgroundPic[t].type=r,u.push({type:"image",seq:l.getSeq(),content:{fid:c.boardId2Fid(t),boardId:t,url:s[e],updateTime:c.getTimeStamp(),type:r,mode:n}})}),o&&this.report.reportImages(u),this.setNeedDraw(!0)},K.prototype.setBackgroundPic=function(t,e=m.FILL_MODE.DEFAULT){t&&(this.cancelSelect(),this.addBackgroundPic({boardIds:this.currentBoard,urls:t,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1,position:e}),this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:c.getTimeStamp(),seq:l.getSeq(),mode:e,type:m.BACKGROUND_TYPE.IMAGE,cleanBoard:0}),this.report.reportImage(this.currentBoard,t,e))},K.prototype.setBackgroundH5=function(t){this.cancelSelect(),this.addBackgroundPic({boardIds:this.currentBoard,urls:t,type:m.BACKGROUND_TYPE.H5,needReport:!1}),this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:c.getTimeStamp(),seq:l.getSeq(),mode:m.FILL_MODE.DEFAULT,type:m.BACKGROUND_TYPE.H5,cleanBoard:0}),this.report.reportImage(this.currentBoard,t,m.FILL_MODE.DEFAULT,m.BACKGROUND_TYPE.H5)},K.prototype.updateCurrentFillMode=function(t){var e=this.backgroundPic[this.currentBoard];e&&e.url&&this.setBackgroundPic(e.url,t)},K.prototype.deleteBackgroundPic=function(t){this.cancelSelect(),this.backgroundPic[t].show=!1,this.setNeedDraw(!0)},K.prototype.cancelBackgroundPic=function(){this.cancelSelect(),this.deleteBackgroundPic(this.currentBoard),this.img.style.display="none",this.realTimeData.push({action:i.PROTOCOL_ACTION.DELETE_BG_IMG_ACTION,seq:this.getSeq()}),this.report.reportImage(this.currentBoard,"",0)},K.prototype.clearGlobalBgColor=function(){this.setGlobalBackgroundColor(this.options.globalBackgroundColor)},K.prototype.switchPage=function(t=0){var e,r;return e=(r=this.getBoardByGroup(this.getCurrentFile()))[t=Math.min(t,r.length-1)],this.switchBoard(e)},K.prototype.switchH5Board=function({fid:t,slideIndex:e,stepIndex:r}){this.cancelSelect();var o=this.getBoardByGroup(t),n=this.getFileInfo(t),a=o[e];this.currentBoard=a,this.currentGroup=t,n.currentPageIndex=e,n.currentPageStep=r,n.pageCount=o.length;var s=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";return s&&this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:s,time:c.getTimeStamp(),seq:l.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0}),this.realTimeData.push({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),toBoardId:a,deleteBoards:[],deleteFiles:[],page:n.currentPageIndex,step:r}),this.sendRequest(),this.report.reportSwitchBoard(a),this.report.reportAddFile(n),this.event.fire(this,"TEB_GOTOBOARD",a,t),this.setNeedDraw(!0),a},K.prototype.switchBoard=function(t){if(this.cancelSelect(),t&&!this.data[t])return!1;t||(t=this.createBoardId(),this.addBoard(t)),this.currentBoard=t,this.currentGroup=c.boardId2Fid(t);var e=this.getBoardByGroup(this.currentGroup),r=this.getFileInfo(this.currentGroup),o=e.indexOf(t),n=r.currentPageStep;r.currentPageIndex=o,r.currentPageStep=n,r.pageCount=e.length;var a=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";return a&&this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:a,time:c.getTimeStamp(),seq:l.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0}),this.realTimeData.push({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),toBoardId:t,deleteBoards:[],deleteFiles:[],page:r.currentPageIndex,step:n}),this.sendRequest(),this.report.reportSwitchBoard(t),this.report.reportAddFile(r),this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,c.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),t},K.prototype.setGlobalBackgroundColor=function(t,e){t||(t=m.COLOR.WHITE);var r=0;"number"==typeof t?(this.globalBackgroundColor=c.dealColor(t),r=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.globalBackgroundColor=t,r=c.formatColor(t)):(this.globalBackgroundColor=c.hexToRgba(t),r=c.formatColor(c.hexToRgba(t))),this.boardList.forEach(t=>{this.backgroundColor[t]=this.globalBackgroundColor}),this.setNeedDraw(!0),e||(this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),color:r,isGlobal:1}),this.report.reportGlobalBgColor(r))},K.prototype.getGlobalBackgroundColor=function(){return this.globalBackgroundColor},K.prototype.preloadBoard=function(){let t=[];for(let e=0;e<this.groups.length;++e){let r=this.groups[e];if(r.type!==i.FILE_TYPE.H5){let e=this.getBoardByGroup(r.fid);t=t.concat(e)}else if(!this.pptFilePreloaded[r.fid]){if(r.fid===this.currentGroup){this.pptFilePreloaded[r.fid]=!0;continue}!function(t,e){setTimeout(function(){let e=document.createElement("iframe");e.setAttribute("style","position:fixed;visibility:hidden;width:0px;height:0px;border:none;"),document.body.appendChild(e),e.onload=function(){e.remove()},e.setAttribute("src",t)},1e3)}(r.downloadURL),this.pptFilePreloaded[r.fid]=!0}}let e=t.indexOf(this.currentBoard);for(let r=-this.preloadDepth;r<this.preloadDepth;++r){let o=e+r;if(o<0||o>=t.length)continue;let i=t[o],n=this.backgroundPic[i];if(n&&!n.preloaded&&void 0!==n.url&&""!==n.url){if(0===r){n.preloaded=!0;continue}n.type===m.BACKGROUND_TYPE.IMAGE?function(t,e){setTimeout(function(){let e=new Image;e.onload=function(){},e.onabort=function(){},e.onerror=function(){},e.src=t},e)}(n.url,200*(Math.abs(r)-1)):n.type===m.BACKGROUND_TYPE.H5&&function(t,e){setTimeout(function(){let e=document.createElement("iframe");e.setAttribute("style","position:fixed;visibility:hidden;width:0px;height:0px;border:none;"),document.body.appendChild(e),e.onload=function(){e.remove()},e.setAttribute("src",t)},e)}(n.url,200*(Math.abs(r)-1)),n.preloaded=!0}}},K.prototype.resetOperation=function(){this.opData[this.currentBoard]=this.opData[this.currentBoard].slice(0,this.opIndex[this.currentBoard])},K.prototype.collectLineData=function(){return{start:(t,e)=>{var r=l.getSeq();this.belongLineSeq=r;var o=new d(this.identifier,{color:this.color,thin:this.thin,x:t,y:e,show:!0,seq:r,belongSeq:r});this.userData[this.currentBoard][this.identifier].push(o),this.data[this.currentBoard].push(o),this.opData[this.currentBoard].push(new n(this.identifier,{seq:o.seq,type:this.type})),this.opIndex[this.currentBoard]++;var a={action:i.PROTOCOL_ACTION.LINE_START_ACTION,color:c.formatColor(o.color),scale:100,thin:o.thin,time:c.getTimeStamp(),seq:o.seq,belongSeq:o.belongSeq,x:t,y:e};this.realTimeData.push(a)},draw:(t,e)=>{var r=this.userData[this.currentBoard][this.identifier].length,o=this.userData[this.currentBoard][this.identifier][r-1];o.setBorder(t,e);var n=l.getSeq();o.lines.push({x:t,y:e,seq:n});var a={action:i.PROTOCOL_ACTION.LINE_MOVE_ACTION,seq:n,belongSeq:this.belongLineSeq,x:t,y:e};this.realTimeData.push(a)},end:(t,e)=>{var r=this.userData[this.currentBoard][this.identifier].length,o=this.userData[this.currentBoard][this.identifier][r-1];o.setBorder(t,e);var n=l.getSeq();if(o.lines.push({x:t,y:e,seq:n}),this.smoothLevel>0){let t=[];o.lines.forEach(e=>{t.push([e.x,e.y])}),o.fitCurve=G(t,1e4*this.smoothLevel,null)}var a={action:i.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:this.belongLineSeq,seq:n,x:t,y:e};this.realTimeData.push(a),this.setNeedDraw(!0);var s=[];o.lines.forEach(t=>{s.push({seq:t.seq,x:t.x,y:t.y})}),this.currentBoard,this.identifier,c.formatColor(this.color),this.thin,o.time,c.getTimeStamp(),o.seq,this.report.reportAddLine({boardId:this.currentBoard,uid:o.user,colorRGBA:c.formatColor(this.color),scale:100,width:this.thin,time:o.time,updateTime:c.getTimeStamp(),seq:o.seq,hidden:0,points:s})},over(t,e){this.end(t,e)}}},K.prototype.collectTextInputData=function(){return{start:(t,e)=>{var r,o=l.getSeq();try{var i=this.data[this.currentBoard],a={seq:0,index:-1};if(i.forEach((r,o)=>{if("inputtext"===r.type&&r.show&&r.user===this.identifier){var i=5/this.boardWidth*1e4,n=5/this.boardHeight*1e4,s=r.location.x-i,l=r.location.y-n,c=r.location.x+r.textWidth/this.boardWidth*1e4+i,u=r.location.y+r.textHeight/this.boardHeight*1e4+n;t>=s&&t<=c&&e>=l&&e<=u&&r.belongSeq>a.seq&&(a={seq:r.belongSeq,index:o})}}),a.index>-1){var s=this.data[this.currentBoard].splice(a.index,1)[0];s.show=!1,this.setNeedDraw(!0),r=s,(this.userData[this.currentBoard][this.identifier]||[]).forEach((t,e)=>{t.belongSeq===r.belongSeq&&this.userData[this.currentBoard][this.identifier].splice(e,1)})}}catch(t){}r||((r=new g(this.identifier,{x:t,y:e,belongSeq:o})).color=this.getTextColor(),r.textSize=this.getTextSize(),r.typeFace=this.getTextFontFamily(),r.fontStyle=this.getTextFontStyle()),this.userData[this.currentBoard][this.identifier].push(r),this.data[this.currentBoard].push(r);for(var c=!1,u=0,d=this.opData[this.currentBoard].length;u<d;u++)if(this.opData[this.currentBoard][u].seq===r.belongSeq){c=!0;break}return c||(this.opData[this.currentBoard].push(new n(this.identifier,{seq:r.belongSeq,type:this.type})),this.opIndex[this.currentBoard]++),r},inputting:(t,e,r)=>{var o=this.userData[this.currentBoard][this.identifier].length,n=this.userData[this.currentBoard][this.identifier][o-1],a=l.getSeq();n.text=t,n.seq=a,n.textWidth=e,n.textHeight=r;var s={action:i.PROTOCOL_ACTION.INPUT_TEXT_ACTION,seq:a,belongSeq:n.belongSeq,color:c.formatColor(n.color),scale:100,typeFace:n.typeFace,textSize:Math.floor(n.textSize),fontStyle:n.fontStyle,time:c.getTimeStamp(),x:n.location.x,y:n.location.y,text:t};this.realTimeData.push(s)},draw:t=>{var e=this.userData[this.currentBoard][this.identifier].length,r=this.userData[this.currentBoard][this.identifier][e-1];if(!t&&!t.trim()){for(var o=-1,i=0,n=this.opData[this.currentBoard].length;i<n;i++)if(this.opData[this.currentBoard][i].seq===r.belongSeq){o=i;break}return o>-1&&(this.opData[this.currentBoard].splice(o,1),this.opIndex[this.currentBoard]--),this.userData[this.currentBoard][this.identifier].splice(e-1,1),void this.data[this.currentBoard].splice(this.data[this.currentBoard].length-1,1)}r.text=t,r.show=!0,this.report.reportAddText({belongSeq:r.belongSeq,time:r.time,boardId:this.currentBoard,uid:r.user,x:Math.floor(r.location.x),y:Math.floor(r.location.y),colorRGBA:c.formatColor(r.color),scale:100,updateTime:c.getTimeStamp(),hidden:0,typeface:r.typeFace,textSize:Math.floor(r.textSize),fontStyle:r.fontStyle,text:t}),this.setNeedDraw(!0)}}},K.prototype.collectEraserData=function(t,e){var r=this.eraserImpactCheck(t,e,this.thin/2);if(r.length>0){this.opData[this.currentBoard].push(new n(this.identifier,{seq:r,type:this.type})),this.opIndex[this.currentBoard]++;var o={action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:c.getTimeStamp(),seq:l.getSeq(),x:0,y:0,lines:r};r.length&&(this.realTimeData.push(o),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:0,lines:r})),this.setNeedDraw(!0)}},K.prototype.collectRaserData=function(){return{start:(t,e)=>{var r=new f(this.identifier,{color:c.dealColor(m.COLOR.RED),radius:this.thin/2,x:t,y:e,seq:l.getSeq()});this.seq=r.seq,this.userData[this.currentBoard][this.identifier].push(r),this.data[this.currentBoard].push(r);var o={action:i.PROTOCOL_ACTION.RASER_SHOW_ACTION,r:r.radius,seq:r.seq,x:t,y:e};this.realTimeData.push(o),this.setNeedDraw(!0)},draw:(t,e)=>{var r=this.userData[this.currentBoard][this.identifier].length,o=this.userData[this.currentBoard][this.identifier][r-1];o.location={x:t,y:e},this.setNeedDraw(!0),this.realTimeData.push({action:i.PROTOCOL_ACTION.RASER_SHOW_ACTION,seq:l.getSeq(),x:t,y:e,r:o.radius})},end:(t,e)=>{var r=this.userData[this.currentBoard][this.identifier].length,o=this.userData[this.currentBoard][this.identifier][r-1];o.point={x:t,y:e},o.status=0;var n={action:i.PROTOCOL_ACTION.RASER_HIDE_ACTION,seq:o.seq};this.realTimeData.push(n),this.setNeedDraw(!0)},over:()=>{var t=this.userData[this.currentBoard][this.identifier].length;this.userData[this.currentBoard][this.identifier][t-1].status=0,this.setNeedDraw(!0)}}},K.prototype.collectSelectData=function(){return{start:(t,e)=>{this.beforeMoveType="select";var r=new p(this.identifier,{startx:t,starty:e,x:t,y:e});this.seq=r.seq,this.userData[this.currentBoard][this.identifier].push(r),this.data[this.currentBoard].push(r)},draw:(t,e)=>{var r=this.userData[this.currentBoard][this.identifier].length;this.userData[this.currentBoard][this.identifier][r-1].location={x:t,y:e},this.setNeedDraw(!0)},end:(t,e,r,o)=>{for(var i=t>r?t:r,n=e>o?e:o,a=t+r-i,s=e+o-n,l=this.data[this.currentBoard].length-1;l>=0;l--){var c=this.data[this.currentBoard][l];if("line"==c.type&&c.show)i>=c.border.maxX&&n>=c.border.maxY&&a<=c.border.minX&&s<=c.border.minY&&(c.select=!0,this.selectedList.push(c));else if("graph"==c.type&&c.show)i>=c.endPoint.x&&n>=c.endPoint.y&&a<=c.startPoint.x&&s<=c.startPoint.y&&(c.select=!0,this.selectedList.push(c));else if("inputtext"==c.type&&c.show&&c.text){var u=c.location.x,d=c.location.y,h=c.location.x+c.textWidth/this.boardWidth*1e4,p=c.location.y+c.textHeight/this.boardHeight*1e4;i>=h&&n>=p&&a<=u&&s<=d&&(c.select=!0,this.selectedList.push(c))}}this.selectArea={x:a,y:s,width:i-a,height:n-s},this.userData[this.currentBoard][this.identifier][this.userData[this.currentBoard][this.identifier].length-1].show=!1,this.setNeedDraw(!0)}}},K.prototype.collectPointSelectData=function(t,e){this.beforeMoveType="pointselect";for(var r=!1,o=this.data[this.currentBoard].length-1;o>=0;o--){var i=this.data[this.currentBoard][o];if("line"==i.type&&i.show){if(t<i.border.maxX&&t>i.border.minX&&e<i.border.maxY&&e>i.border.minY){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:i.border.minX,y:i.border.minY,width:i.border.maxX-i.border.minX,height:i.border.maxY-i.border.minY};break}}else if("graph"==i.type&&i.show){var n=i.endPoint.x,a=i.endPoint.y,s=i.startPoint.x,l=i.startPoint.y;if(n<s&&(n+=s,n-=s=n-s),a<l&&(a+=l,a-=l=a-l),a+=this.thin,n+=this.thin,s-=this.thin,l-=this.thin,t>=s&&t<=n&&e>=l&&e<=a){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:s,y:l,width:n-s,height:a-l};break}}else if("inputtext"===i.type&&i.show&&i.text){var c=5/this.boardWidth*1e4,u=5/this.boardHeight*1e4,d=i.location.x-c,h=i.location.y-u,p=i.location.x+i.textWidth/this.boardWidth*1e4+c,f=i.location.y+i.textHeight/this.boardHeight*1e4+u;if(t>=d&&t<=p&&e>=h&&e<=f){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:d,y:h,width:p-d,height:f-h};break}}}r&&this.setNeedDraw(!0)},K.prototype.collectMoverData=function(){return{beforeStart:(t,e)=>{if(0==this.selectedList.length)return!1;for(var r=!1,o=0;o<this.selectedList.length;o++){var i=this.selectedList[o];if("line"==i.type){var n=1.5*this.thin,a=1.5*this.thin;if(i.border.minX-n<=t&&i.border.maxX+n>=t&&i.border.minY-a<=e&&i.border.maxY+a>=e){r=!0;break}}else if("graph"==i.type){var s=i.startPoint.x,l=i.endPoint.x,c=i.startPoint.y,u=i.endPoint.y;if(l<s&&(l+=s,l-=s=l-s),u<c&&(u+=c,u-=c=u-c),u+=this.thin,l+=this.thin,c-=this.thin,(s-=this.thin)<=t&&l>=t&&c<=e&&u>=e){r=!0;break}}else if("inputtext"===i.type){var d=5/this.boardWidth*1e4,h=5/this.boardHeight*1e4,p=i.location.x-d,f=i.location.y-h,g=i.location.x+i.textWidth/this.boardWidth*1e4+d,m=i.location.y+i.textHeight/this.boardHeight*1e4+h;if(t>=p&&t<=g&&e>=f&&e<=m){r=!0;break}}}return!!r||(this.cancelSelect(),!1)},start:(t,e)=>{var r=[];this.selectedList.forEach(t=>{"line"==t.type?r.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?r.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"==t.type&&r.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})}),this.opData[this.currentBoard].push(new n(this.identifier,{seq:{origin:r,final:[]},type:"move"}))},draw:(t,e,r,o)=>{if(this.selectedList.length>0){for(var i=0;i<this.selectedList.length;i++){var n=this.selectedList[i],a=t-r,s=e-o;"line"==n.type?(n.border.maxX+=a,n.border.minX+=a,n.border.maxY+=s,n.border.minY+=s,n.lines.forEach(t=>{t.x+=a,t.y+=s}),0!==n.fitCurve.length&&n.fitCurve.forEach(t=>{t[1][0]+=a,t[1][1]+=s,t[2][0]+=a,t[2][1]+=s,t[3][0]+=a,t[3][1]+=s})):"graph"==n.type?(n.startPoint.x+=a,n.startPoint.y+=s,n.endPoint.x+=a,n.endPoint.y+=s):"inputtext"===n.type&&(n.location.x+=a,n.location.y+=s)}this.selectArea.x+=a,this.selectArea.y+=s,this.setNeedDraw(!0)}},end:()=>{this.setNeedDraw(!0);var t=[];if(0!=this.selectedList.length){this.selectedList.forEach(e=>{"line"==e.type?t.push({seq:e.seq,x:e.lines[0].x,y:e.lines[0].y,uid:e.user}):"graph"==e.type?t.push({seq:e.startPoint.seq,x:e.startPoint.x,y:e.startPoint.y,uid:e.user}):"inputtext"===e.type&&t.push({seq:e.belongSeq,x:e.location.x,y:e.location.y,uid:e.user})});var e={action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,seq:l.getSeq(),moves:t,time:c.getTimeStamp()};this.realTimeData.push(e);var r=[];this.selectedList.forEach(t=>{"line"==t.type?r.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?r.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"===t.type&&r.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})}),this.opData[this.currentBoard][this.opData[this.currentBoard].length-1].seq.final=r,this.opIndex[this.currentBoard]++;var o=[];t.forEach(t=>{for(var e=t.uid,r=0;r<this.userData[this.currentBoard][e].length;r++){var i=this.userData[this.currentBoard][e][r];if("line"==i.type&&t.seq==i.seq){var n=[];i.lines.forEach(t=>{n.push({seq:t.seq,x:t.x,y:t.y})}),o.push({type:"addLine",seq:l.getSeq(),content:{boardId:this.currentBoard,uid:i.user,colorRGBA:c.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:c.getTimeStamp(),seq:i.seq,hidden:0,points:n}})}else if("graph"==i.type&&t.seq==i.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:l.getSeq(),content:{boardId:this.currentBoard,uid:i.user,colorRGBA:c.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:c.getTimeStamp(),hidden:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}};"oval"==i.graph||"circle"==i.graph?a.content.fillRect=i.solid?1:0:"rect"==i.graph&&(a.content.fillRect=i.solid?1:0,a.content.cornerRadius=0),o.push(a)}else"inputtext"===i.type&&t.seq==i.belongSeq&&o.push({type:"addText",seq:l.getSeq(),content:{belongSeq:i.belongSeq,time:c.getTimeStamp(),boardId:this.currentBoard,uid:i.user,x:i.location.x,y:i.location.y,colorRGBA:c.formatColor(i.color),scale:i.scale,updateTime:c.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:i.textSize,fontStyle:i.fontStyle,text:i.text}})}}),this.report.reportGraphData(o)}}}},K.prototype.collectGraphData=function(){return{start:(t,e)=>{var r=this.type.split("-")[1],o=new h(this.identifier,{graph:r,color:this.color,thin:this.thin,seq:l.getSeq(),beginPoint:{x:t,y:e,seq:l.getSeq()},endPoint:{x:t,y:e,seq:l.getSeq()},show:!0,solid:this.type.indexOf("solid")>-1});this.seq=o.seq,this.userData[this.currentBoard][this.identifier].push(o),this.data[this.currentBoard].push(o),this.opData[this.currentBoard].push(new n(this.identifier,{seq:o.startPoint.seq,type:"graph"})),this.opIndex[this.currentBoard]++},draw:(t,e)=>{var r=this.userData[this.currentBoard][this.identifier].length,o=this.userData[this.currentBoard][this.identifier][r-1];o.endPoint.x=t,o.endPoint.y=e,"circle"==o.graph&&this.circleFix(o),this.setNeedDraw(!0)},end:(t,e)=>{var r=this.userData[this.currentBoard][this.identifier].length,o=this.userData[this.currentBoard][this.identifier][r-1];o.endPoint.x=t,o.endPoint.y=e,"circle"==o.graph&&this.circleFix(o),"line"!=o.graph&&this.graphFix(o),this.setNeedDraw(!0);var i={seq:o.seq,time:c.getTimeStamp(),color:c.formatColor(this.color),scale:100,thin:this.thin,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}};i.action={line:10,oval:11,circle:11,rect:12}[o.graph];var n={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[o.graph],seq:l.getSeq(),content:{boardId:this.currentBoard,uid:o.user,colorRGBA:c.formatColor(this.color),scale:100,width:this.thin,time:o.time,updateTime:c.getTimeStamp(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}},a=this.type.indexOf("solid")>-1?1:0;i.action>10&&(i.fillRect=a,n.content.fillRect=a),12==i.action&&(i.cornerRadius=0,n.content.cornerRadius=0),this.realTimeData.push(i),this.report.reportGraphData([n])},over(t,e){this.end(t,e)}}},K.prototype.collectDragData=function(){return{start:t=>{var e=t.currentTarget.getElementsByClassName("tx_board_canvas_box")[0];getComputedStyle(e).getPropertyValue("transform"),e.style.left,e.style.top},draw:(t,e,r,o,i)=>{var n=t.currentTarget.getElementsByClassName("tx_board_canvas_box")[0];let a=r-i,s=(e-o)/this.boardWidth*100,l=a/this.boardHeight*100;var c,u,d,h;this.boardWidth/this.boardHeight>this.containerWidth/this.containerHeight?(this.boardHeight>this.containerHeight?(d=50+(this.boardHeight-this.containerHeight)/2/this.boardHeight*100,h=50-(this.boardHeight-this.containerHeight)/2/this.boardHeight*100):(d=50,h=50),c=50+(this.boardWidth-this.containerWidth)/2/this.boardWidth*100,u=50-(this.boardWidth-this.containerWidth)/2/this.boardWidth*100):(d=50+(this.boardHeight-this.containerHeight)/2/this.boardHeight*100,h=50-(this.boardHeight-this.containerHeight)/2/this.boardHeight*100,this.boardWidth>this.containerWidth?(c=50+(this.boardWidth-this.containerWidth)/2/this.boardWidth*100,u=50-(this.boardWidth-this.containerWidth)/2/this.boardWidth*100):(c=50,u=50));var p=1*n.style.left.replace("%","")+s;p=Math.min(c,Math.max(u,p)),n.style.left=p+"%";var f=1*n.style.top.replace("%","")+l;f=Math.min(d,Math.max(h,f)),n.style.top=f+"%";var g=n.getAttribute("style");-1===g.indexOf("-webkit-transform")&&(g+="-webkit-transform: translateX(-50%) translateY(-50%);"),n.setAttribute("style",g),this.dragDataList.getDragData(this.currentBoard)?this.dragDataList.updateDragData(this.currentBoard,{xOffset:p,yOffset:f}):this.dragDataList.addDragData(this.currentBoard,new H({scale:this.getBoardScale(),xOffset:p,yOffset:f})),this.realTimeData.push(this.dragDataList.getDragData(this.currentBoard).getRealTimeData())},scaleDraw:(t,e)=>{if(e.length){var r,o=this.dragDataList.getDragData(this.currentBoard);o&&(r=parseInt(t*e[e.length-1]),r=Math.max(i.MIN_SCALE,Math.min(i.MAX_SCALE,r)),o.scale=r),this.setNeedDraw(!0)}},end:()=>{this.report.reportDrag(Object.assign(this.dragDataList.getDragData(this.currentBoard).getReportData(),{boardId:this.currentBoard}))},touchEnd:t=>{if(t.length){var e=this.dragDataList.getDragData(this.currentBoard);this.setBoardScale(e.scale)}else this.report.reportDrag(Object.assign(this.dragDataList.getDragData(this.currentBoard).getReportData(),{boardId:this.currentBoard}))},over:()=>{this.report.reportDrag(Object.assign(this.dragDataList.getDragData(this.currentBoard).getReportData(),{boardId:this.currentBoard}))}}},K.prototype.cancelSelect=function(){for(var t=this.selectedList.length,e=0;e<t;e++)this.selectedList[e].select=!1;this.selectedList=[],this.selectArea={x:0,y:0,width:0,height:0},t&&this.setNeedDraw(!0)},K.prototype.eraserImpactCheck=function(t,e,r){var o=[];return this.data[this.currentBoard].forEach(i=>{let n=i.thin/2;if("line"==i.type&&i.show){var a=i.border.maxX+n,s=i.border.maxY+n,l=i.border.minX-n,c=i.border.minY-n,u=0;if(t+r<l||t-r>a||e+r<c||e-r>s)return;let d=!1;if(1===i.lines.length){let o=i.lines[0];this.getDistance(t,e,o.x,o.y,o.x,o.y)<=(r+n)*(r+n)&&(d=!0)}else for(let o=1;o<i.lines.length;o++){let a=i.lines[o-1],s=i.lines[o];if(this.getDistance(t,e,a.x,a.y,s.x,s.y)<=(r+n)*(r+n)){d=!0;break}}d&&(i.show=!1,o.push({uid:i.user,seq:i.seq}))}else if("graph"==i.type&&i.show){if("line"==i.graph)(u=this.getDistance(t,e,i.startPoint.x,i.startPoint.y,i.endPoint.x,i.endPoint.y))<=(r+n)*(r+n)&&(i.show=!1,o.push({uid:i.user,seq:i.startPoint.seq}));else if("rect"==i.graph)if(i.solid)t>i.startPoint.x&&e>i.startPoint.y&&t<i.endPoint.x&&e<i.endPoint.y&&(i.show=!1,o.push({uid:i.user,seq:i.startPoint.seq}));else{var d=this.getDistance(t,e,i.startPoint.x,i.startPoint.y,i.startPoint.x,i.endPoint.y),h=this.getDistance(t,e,i.startPoint.x,i.startPoint.y,i.endPoint.x,i.startPoint.y),p=this.getDistance(t,e,i.endPoint.x,i.endPoint.y,i.startPoint.x,i.endPoint.y),f=this.getDistance(t,e,i.endPoint.x,i.endPoint.y,i.endPoint.x,i.startPoint.y);Math.min(d,h,p,f)<=(r+n)*(r+n)&&(i.show=!1,o.push({uid:i.user,seq:i.startPoint.seq}))}else if("circle"==i.graph){let a=(i.startPoint.x+i.endPoint.x)/2,s=(i.startPoint.y+i.endPoint.y)/2;var g=Math.sqrt(Math.pow(i.startPoint.x-i.endPoint.x,2)+Math.pow(i.startPoint.y-i.endPoint.y,2))/2;u=Math.sqrt(Math.pow(t-a,2)+Math.pow(e-s,2)),i.solid?u<g+r&&(i.show=!1,o.push({uid:i.user,seq:i.startPoint.seq})):Math.abs(g-u)<=r+n&&(i.show=!1,o.push({uid:i.user,seq:i.startPoint.seq}))}else if("oval"==i.graph){let r=(i.startPoint.x+i.endPoint.x)/2,a=(i.startPoint.y+i.endPoint.y)/2;var m=Math.abs(i.startPoint.x-i.endPoint.x)/2,_=Math.abs(i.startPoint.y-i.endPoint.y)/2;if(m===_&&0===m)return;var y=Math.pow(t-r,2)/Math.pow(m,2)+Math.pow(e-a,2)/Math.pow(_,2),b=Math.pow(t-r+n,2)/Math.pow(m,2)+Math.pow(e-a+n,2)/Math.pow(_,2),T=Math.pow(t-r+n,2)/Math.pow(m,2)+Math.pow(e-a-n,2)/Math.pow(_,2),C=Math.pow(t-r-n,2)/Math.pow(m,2)+Math.pow(e-a+n,2)/Math.pow(_,2),E=Math.pow(t-r-n,2)/Math.pow(m,2)+Math.pow(e-a-n,2)/Math.pow(_,2);i.solid?(y<=1.2||b<=1.2||T<=1.2||C<=1.2||E<=1.2)&&(i.show=!1,o.push({uid:i.user,seq:i.startPoint.seq})):(y<=1.2&&y>=.8||b<=1.2&&b>=.8||T<=1.2&&T>=.8||C<=1.2&&C>=.8||E<=1.2&&E>=.8)&&(i.show=!1,o.push({uid:i.user,seq:i.startPoint.seq}))}}else if("inputtext"==i.type&&i.show){var v=i.location.x-0,S=i.location.y-0,D=i.location.x+i.textWidth/this.boardWidth*1e4+0,A=i.location.y+i.textHeight/this.boardHeight*1e4+0;t>v&&e>S&&t<D&&e<A&&(i.show=!1,o.push({uid:i.user,seq:i.belongSeq}))}}),o},K.prototype.getDistance=function(t,e,r,o,i,n){var a,s,l=i-r,c=n-o,u=l*l+c*c,d=-1;0!=u&&(d=((t-r)*l+(e-o)*c)/u),d<0?(a=r,s=o):d>1?(a=i,s=n):(a=r+d*l,s=o+d*c);var h=t-a,p=e-s;return h*h+p*p},K.prototype.circleFix=function(t){var e=Math.abs(t.startPoint.x-t.endPoint.x)*this.boardWidth/1e4,r=Math.abs(t.startPoint.y-t.endPoint.y)*this.boardHeight/1e4;e>r?(t.endPoint.x=t.startPoint.x<t.endPoint.x?t.startPoint.x+1e4*r/this.boardWidth:t.startPoint.x-1e4*r/this.boardWidth,t.endPoint.x=parseInt(t.endPoint.x)):(t.endPoint.y=t.startPoint.y<t.endPoint.y?t.startPoint.y+1e4*e/this.boardHeight:t.startPoint.y-1e4*e/this.boardHeight,t.endPoint.y=parseInt(t.endPoint.y))},K.prototype.graphFix=function(t){var e=t.startPoint.x,r=t.startPoint.y,o=t.endPoint.x,i=t.endPoint.y;t.startPoint={x:e>o?o:e,y:r>i?i:r,seq:t.startPoint.seq},t.endPoint={x:e>o?e:o,y:r>i?r:i,seq:t.endPoint.seq}},K.prototype.sendRequest=function(){if(this.dataSyncEnable){if(this.permissions){var t=JSON.parse(JSON.stringify(this.realTimeData)),e={seq:l.getSeq(),timestamp:c.getTimeStamp(),value:{boardId:this.currentBoard,operator:this.identifier,actions:t}};this.realTimeData=[],this.event.fire(this,"TEB_SYNCDATA",e)}}else this.realTimeData=[]},K.prototype.addHistory=function(t){var e=this;this.sortBoard(),t.forEach(t=>{var r,o;if(t.content=JSON.parse(t.content),"setGlobalBG"===t.type);else if("createBoards"===t.type)t.content&&t.content.createBoards.forEach(t=>{(r=t)&&!e.userData[r]&&e.addBoard(r,!1)});else if("addFile"===t.type){for(var n=t.content.fid,a=t.content.title,s=t.content.downloadURL,l=t.content.pageCount,u=t.content.currentPageIndex,p=t.content.currentPageStep||0,f=t.content.timestamp,_=t.content.uid,b=t.content.platform,T=t.content.type,C=t.content.ratio,E=t.content.scale,v=!1,S=0,D=e.groups.length;S<D;S++){var A=e.groups[S];if(A.fid==n){A.title=a,A.downloadURL=s,A.pageCount=l,A.currentPageIndex=u,A.currentPageStep=p,A.timestamp=f,A.uid=_,A.type=T,A.ratio=C,A.scale=E,v=!0;break}}if(v?v&&n===i.COMMON_GROUP&&e.event.fire(this,"TEB_ADDFILE",n):e.addGroupNotReport(n,a,_,s,l,u,f,b,T,p,C,E),!f&&!_)return;if(n!=i.COMMON_GROUP){let t=[];var x=e.createBoardIdForFile(n,_,f,l,b),O=[],B=s?c.fileDownLoadUrlToPreviewUrl(s):"";for(let o=0;o<l;o++)r=x[o],B&&O.push(B+(o+1)),r&&!e.userData[r]&&t.push(r);e.addBoard(t),T==i.FILE_TYPE.IMG&&s&&e.addBackgroundPic({boardIds:x,urls:O,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1})}e.sortGroup()}else r=t.content.boardId,o=t.content.uid,r&&!e.userData[r]&&e.addBoard(r,!1),r&&!e.userData[r][o]&&(e.userData[r][o]=[]);if(t.content.colorRGBA&&(t.content.color=c.dealColor(t.content.colorRGBA)),t.content.width&&(t.content.thin=t.content.width),"addLine"==t.type){var I;for(let e=0;e<t.content.points.length;e++){var R=t.content.points[e].x,P=t.content.points[e].y,w=t.content.points[0].seq;0==e?I=new d(o,{color:t.content.color,thin:t.content.thin,x:R,y:P,seq:t.content.points[e].seq,belongSeq:w,show:!t.content.hidden}):(I.lines.push({x:R,y:P,belongSeq:w,seq:t.content.points[e].seq}),e==t.content.points.length-1&&(I.sort(),I.endSeq=t.content.points[e].seq)),I.setBorder(R,P)}I&&(e.userData[r][o].push(I),e.data[r].push(I))}else if("addText"==t.type){var N=new g(o,{belongSeq:t.content.belongSeq,x:t.content.x,y:t.content.y});N.seq=t.content.belongSeq,N.scale=t.content.scale,N.color=t.content.color,N.typeFace=t.content.typeface,N.textSize=t.content.textSize,N.fontStyle=t.content.fontStyle,N.time=t.content.time,N.text=unescape(decodeURI(t.content.text)),N.show=!t.content.hidden,e.userData[r][o].push(N),e.data[r].push(N)}else if("displayLine"==t.type)t.content.lines.forEach(r=>{for(var i=0;i<e.userData[e.currentBoard][o].length;i++){var n=e.userData[e.currentBoard][o][i];"line"==n.type&&n.startSeq==r.seq?n.show=!!t.content.display:"graph"==n.type&&n.startPoint.seq==r.seq?n.show=!!t.content.display:"inputtext"==n.type&&n.belongSeq==r.seq&&(n.show=!!t.content.display)}});else if("addPatternLine"==t.type||"addPatternCircle"==t.type||"addPatternRectangle"==t.type){t.content.graph={addPatternLine:"line",addPatternCircle:"oval",addPatternRectangle:"rect"}[t.type],t.content.seq=t.content.beginPoint.seq,t.content.show=!t.content.hidden,t.content.solid=!!t.content.fillRect;var L=new h(o,t.content);e.userData[r][o].push(L),e.data[r].push(L)}else if("image"==t.type)t.content.url?e.addBackgroundPic({boardIds:t.content.boardId,urls:t.content.url,type:t.content.type,needReport:!1,position:t.content.mode}):e.deleteBackgroundPic(t.content.boardId);else if("clean"==t.type)e.clearBoard(!1);else if("cleanDraws"==t.type)e.clearBoard(!0);else if("switchBoard"==t.type){if(!r)return;(1*t.seq||0)>e.maxSeq?(e.maxSeq=t.seq,e.data[r]||e.addBoard(r,!1),e.currentBoard=r,r===i.COMMON_DEFAULT_BOARD?e.currentGroup=i.COMMON_GROUP:e.currentGroup=r.match(/\d+_#\w+$/)[0].split("_")[1],e.event.fire(this,"TEB_GOTOBOARD",r,c.boardId2Fid(r))):y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:e.maxSeq,boardId:r,method:"addHistory"})})}else if("setBoardBG"==t.type)e.setBackgroundColor({boardId:r,color:t.content.colorRGBA},!0);else if("setGlobalBG"==t.type)e.setGlobalBackgroundColor(t.content.colorRGBA,!0);else if("drag"==t.type)this.dragDataList.addDragData(r,new H({scale:t.content.scale,xOffset:t.content.xOffset,yOffset:t.content.yOffset}));else if("setRatio"==t.type){let e=t.content||{};for(var q in e)this.boardRatio[q]=e[q]}}),e.setNeedDraw(!0)},K.prototype.undo=function(){this.cancelSelect();var t=this.opData[this.currentBoard][this.opIndex[this.currentBoard]-1];if(t){if("line"==t.type)for(var e=0;e<this.userData[this.currentBoard][t.user].length;e++){var r=this.userData[this.currentBoard][t.user][e];if(t.seq==r.seq){r.show=!1,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:c.getTimeStamp(),seq:l.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:0,lines:[{uid:t.user,seq:t.seq}]});break}}else if("eraser"==t.type)t.seq.forEach(t=>{for(var e=t.uid,r=0;r<this.userData[this.currentBoard][e].length;r++){var o=this.userData[this.currentBoard][e][r];"line"==o.type&&t.seq==o.seq?o.show=!0:"graph"==o.type&&t.seq==o.startPoint.seq?o.show=!0:"inputtext"==o.type&&t.seq==o.belongSeq&&(o.show=!0)}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:c.getTimeStamp(),seq:l.getSeq(),lines:t.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:1,lines:t.seq});else if("graph"==t.type)for(let e=0;e<this.userData[this.currentBoard][t.user].length;e++){let r=this.userData[this.currentBoard][t.user][e];if("graph"==r.type&&t.seq==r.startPoint.seq){r.show=!1,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:c.getTimeStamp(),seq:l.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:0,lines:[{uid:t.user,seq:t.seq}]});break}}else if("inputtext"==t.type)for(let e=0;e<this.userData[this.currentBoard][t.user].length;e++){let r=this.userData[this.currentBoard][t.user][e];if("inputtext"==r.type&&t.seq==r.belongSeq){r.show=!1,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:c.getTimeStamp(),seq:l.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:0,lines:[{uid:t.user,seq:t.seq}]});break}}else if("move"==t.type){var o=[];t.seq.origin.forEach(t=>{for(var e=t.uid,r=0;r<this.userData[this.currentBoard][e].length;r++){var i=this.userData[this.currentBoard][e][r],n=0,a=0;"line"==i.type&&t.seq==i.seq?(n=t.x-i.lines[0].x,a=t.y-i.lines[0].y,i.border.maxX+=n,i.border.minX+=n,i.border.maxY+=a,i.border.minY+=a,i.lines.forEach(t=>{t.x+=n,t.y+=a}),0!==i.fitCurve.length&&i.fitCurve.forEach(t=>{t[1][0]+=n,t[1][1]+=a,t[2][0]+=n,t[2][1]+=a,t[3][0]+=n,t[3][1]+=a}),o.push({uid:e,seq:t.seq,x:t.x,y:t.y})):"graph"==i.type&&t.seq==i.startPoint.seq?(n=t.x-i.startPoint.x,a=t.y-i.startPoint.y,i.startPoint.x+=n,i.startPoint.y+=a,i.endPoint.x+=n,i.endPoint.y+=a,o.push({uid:e,seq:t.seq,x:t.x,y:t.y})):"inputtext"==i.type&&t.seq==i.belongSeq&&(i.location.x=t.x,i.location.y=t.y,o.push({uid:e,seq:i.belongSeq,x:t.x,y:t.y}))}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),moves:o});var n=[];t.seq.origin.forEach(t=>{for(var e=t.uid,r=0;r<this.userData[this.currentBoard][e].length;r++){var o=this.userData[this.currentBoard][e][r];if("line"==o.type&&t.seq==o.seq){var i=[];o.lines.forEach(t=>{i.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:l.getSeq(),content:{boardId:this.currentBoard,uid:o.user,colorRGBA:c.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:c.getTimeStamp(),seq:o.seq,hidden:0,points:i}})}else if("graph"==o.type&&t.seq==o.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[o.graph],seq:l.getSeq(),content:{boardId:this.currentBoard,uid:o.user,colorRGBA:c.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:c.getTimeStamp(),hidden:0,fillRect:o.solid?1:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}};"rect"==o.graph&&(a.content.cornerRadius=0),n.push(a)}else"inputtext"===o.type&&t.seq==o.belongSeq&&n.push({type:"addText",seq:l.getSeq(),content:{belongSeq:o.belongSeq,time:c.getTimeStamp(),boardId:this.currentBoard,uid:o.user,x:o.location.x,y:o.location.y,colorRGBA:c.formatColor(o.color),scale:o.scale,updateTime:c.getTimeStamp(),hidden:0,typeface:o.typeFace,textSize:o.textSize,fontStyle:o.fontStyle,text:o.text}})}}),this.report.reportGraphData(n)}this.opIndex[this.currentBoard]--,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},K.prototype.canUndo=function(){return 0!=this.opIndex[this.currentBoard]},K.prototype.redo=function(){this.cancelSelect();var t=this.opData[this.currentBoard][this.opIndex[this.currentBoard]];if(t){if("line"==t.type)for(var e=0;e<this.userData[this.currentBoard][t.user].length;e++){var r=this.userData[this.currentBoard][t.user][e];if(t.seq==r.seq){r.show=!0,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:c.getTimeStamp(),seq:l.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:1,lines:[{uid:t.user,seq:t.seq}]});break}}else if("inputtext"==t.type)for(let e=0;e<this.userData[this.currentBoard][t.user].length;e++){let r=this.userData[this.currentBoard][t.user][e];if("inputtext"==r.type&&t.seq==r.belongSeq){r.show=!0,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:c.getTimeStamp(),seq:l.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:1,lines:[{uid:t.user,seq:t.seq}]});break}}else if("eraser"==t.type)t.seq.forEach(t=>{var e=t.uid;for(let r=0;r<this.userData[this.currentBoard][e].length;r++){let o=this.userData[this.currentBoard][e][r];"line"==o.type&&t.seq==o.seq?o.show=!1:"graph"==o.type&&t.seq==o.startPoint.seq?o.show=!1:"inputtext"===o.type&&t.seq==o.belongSeq&&(o.show=!1)}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:c.getTimeStamp(),seq:l.getSeq(),lines:t.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:0,lines:t.seq});else if("graph"==t.type)for(let e=0;e<this.userData[this.currentBoard][t.user].length;e++){let r=this.userData[this.currentBoard][t.user][e];if("graph"==r.type&&t.seq==r.startPoint.seq){r.show=!0,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:c.getTimeStamp(),seq:l.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:c.getTimeStamp(),display:1,lines:[{uid:t.user,seq:t.seq}]});break}}else if("move"==t.type){var o=[];t.seq.final.forEach(t=>{for(var e=t.uid,r=0;r<this.userData[this.currentBoard][e].length;r++){var i=this.userData[this.currentBoard][e][r],n=0,a=0;"line"==i.type&&t.seq==i.seq?(n=t.x-i.lines[0].x,a=t.y-i.lines[0].y,i.border.maxX+=n,i.border.minX+=n,i.border.maxY+=a,i.border.minY+=a,i.lines.forEach(t=>{t.x+=n,t.y+=a}),0!==i.fitCurve.length&&i.fitCurve.forEach(t=>{t[1][0]+=n,t[1][1]+=a,t[2][0]+=n,t[2][1]+=a,t[3][0]+=n,t[3][1]+=a}),o.push({uid:e,seq:t.seq,x:t.x,y:t.y})):"graph"==i.type&&t.seq==i.startPoint.seq?(n=t.x-i.startPoint.x,a=t.y-i.startPoint.y,i.startPoint.x+=n,i.startPoint.y+=a,i.endPoint.x+=n,i.endPoint.y+=a,o.push({uid:e,seq:t.seq,x:t.x,y:t.y})):"inputtext"==i.type&&t.seq==i.belongSeq&&(i.location.x=t.x,i.location.y=t.y,o.push({uid:e,seq:i.belongSeq,x:t.x,y:t.y}))}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),moves:o});var n=[];t.seq.final.forEach(t=>{for(var e=t.uid,r=0;r<this.userData[this.currentBoard][e].length;r++){var o=this.userData[this.currentBoard][e][r];if("line"==o.type&&t.seq==o.seq){var i=[];o.lines.forEach(t=>{i.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:l.getSeq(),content:{boardId:this.currentBoard,uid:o.user,colorRGBA:c.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:c.getTimeStamp(),seq:o.seq,hidden:0,points:i}})}else if("graph"==o.type&&t.seq==o.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[o.graph],seq:l.getSeq(),content:{boardId:this.currentBoard,uid:o.user,colorRGBA:c.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:c.getTimeStamp(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}};"oval"==o.graph||"circle"==o.graph?a.content.fillRect=0:"rect"==o.graph&&(a.content.fillRect=0,a.content.cornerRadius=0),n.push(a)}else"inputtext"===o.type&&t.seq==o.belongSeq&&n.push({type:"addText",seq:l.getSeq(),content:{belongSeq:o.belongSeq,time:c.getTimeStamp(),boardId:this.currentBoard,uid:o.user,x:o.location.x,y:o.location.y,colorRGBA:c.formatColor(o.color),scale:o.scale,updateTime:c.getTimeStamp(),hidden:0,typeface:o.typeFace,textSize:o.textSize,fontStyle:o.fontStyle,text:o.text}})}}),this.report.reportGraphData(n)}this.opIndex[this.currentBoard]++,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},K.prototype.canRedo=function(){return this.opIndex[this.currentBoard]!=this.opData[this.currentBoard].length},K.prototype.syncHistroyData=function(){var t=this;t.clearBoard();var e=[],r=[],o=[],i=0,n=(a,s,l)=>{var u=c.getTimeStamp();new Promise((e,r)=>{this.request.getBoardData(a,function(o){o.error_code?(y.report("getBoardData",{action_result:o.error_code,action_info:o.error_msg,time_consume:c.getTimeStamp()-u,extra_info:JSON.stringify(o)}),r(`error_code:${o.error_code} error_msg:${o.error_msg}`),t.event.fire(this,"TEB_ERROR",O,"sync data error")):(y.report("getBoardData",{time_consume:c.getTimeStamp()-u,extra_info:JSON.stringify(o)}),e(o))},function(e){r(`error_code:${e} error_msg:HTTP请求错误，请重试`),t.event.fire(this,"TEB_ERROR",O,"sync data error")})}).then(t=>{(t.board_data_list||[]).forEach(t=>{"setGlobalBG"===t.type?e.push(t):"addFile"===t.type?o.push(t):r.push(t)}),i++,!t.is_finish&&i<100?n(!1,s,l):s()}).catch(e=>{try{t.event.fire(this,"TEB_ERROR",O,e.toString())}catch(e){t.event.fire(this,"TEB_ERROR",O,"sync data error")}})};return new Promise((i,a)=>{n(!0,function(){t.addHistory(e),t.addHistory(o),t.addHistory(r),t.fixBoardData(),t.sortBoard(),t.syncBoardSeq(),setTimeout(()=>{t.event.fire(this,"TEB_HISTROYDATA_SYNCCOMPLETED")},200)})})},K.prototype.fixBoardData=function(){try{var t=[];this.getGroup().forEach(e=>{t.push(e.fid)});var e=[];this.boardList.forEach((r,o)=>{var n=c.boardId2Fid(r);n!=i.COMMON_GROUP&&-1===t.indexOf(n)&&(e.push(o),delete this.userData[r],delete this.data[r],delete this.opData[r],delete this.opIndex[r],delete this.backgroundPic[r],delete this.backgroundColor[r])}),e.sort((t,e)=>e-t),e.forEach(t=>{this.boardList.splice(t,1)})}catch(t){}},K.prototype.sortBoard=function(){this.boardList=this.boardList.sort((t,e)=>{var r=t===i.COMMON_DEFAULT_BOARD?0:t.match(/\d+_\d+_#\w+$/)[0].split("_")[0],o=e===i.COMMON_DEFAULT_BOARD?0:e.match(/\d+_\d+_#\w+$/)[0].split("_")[0];return r!=o?r-o:(t===i.COMMON_DEFAULT_BOARD?0:t.match(/\d+_#\w+$/)[0].split("_")[0])-(e===i.COMMON_DEFAULT_BOARD?0:e.match(/\d+_#\w+$/)[0].split("_")[0])})},K.prototype.syncBoardSeq=function(){1==this.boardList.length&&this.boardList[0]===i.COMMON_DEFAULT_BOARD?this.boardIdSeq=1:this.boardList[this.boardList.length-1]&&(this.boardIdSeq=1*this.boardList[this.boardList.length-1].match(/\d+_#\w+$/)[0].split("_")[0]+1)},K.prototype.sortGroup=function(){this.groups=this.groups.sort((t,e)=>t.fid===i.COMMON_GROUP?-1:e.fid===i.COMMON_GROUP?1:1*t.fid.replace(/\D*/,"")-1*e.fid.replace(/\D*/,""))},K.prototype.addData=function(t){if(this.permissions){if("[object String]"===Object.prototype.toString.call(t))try{t=JSON.parse(t)}catch(e){this.event.fire(this,"TEB_WARNING",S,e.message+", "+t)}var e=t.value.operator,r=t.value.actions,o=t.value.boardId;this.userData[o]||this.addBoard(o,!1),this.userData[o][e]||(this.userData[o][e]=[]),this.userData[o][e].length,r.forEach(t=>{var r;if(t.color&&(t.color=c.dealColor(t.color)),1==t.action){if((r=this.findLine(o,e,t))?(r.color=t.color,r.thin=t.thin,r.show=!0,r.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),r.sort(),r.setBorder(t.x,t.y)):((r=new d(e,t)).show=!0,this.userData[o][e].push(r),this.data[o].push(r)),0!==r.endSeq&&this.smoothLevel>0){let t=[];r.lines.forEach(e=>{t.push([e.x,e.y])}),r.fitCurve=G(t,1e4*this.smoothLevel,null)}}else if(2==t.action||3==t.action){if((r=this.findLine(o,e,t))?(r.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),r.sort(),r.setBorder(t.x,t.y)):(r=new d(e,t),this.userData[o][e].push(r),this.data[o].push(r)),3==t.action&&(r.endSeq=t.seq,((t,e)=>{setTimeout(()=>{t.color&&t.thin||this.request.getLineData({boardId:e,owner:t.user,seq:t.belongSeq},t=>{t.error_code||(this.addHistory([{content:t.content,type:t.type}]),this.sortBoard(),this.syncBoardSeq())})},500)})(r,o)),0!==r.endSeq&&this.smoothLevel>0){let t=[];r.lines.forEach(e=>{t.push([e.x,e.y])}),r.fitCurve=G(t,1e4*this.smoothLevel,null)}}else if(6==t.action){this.userData[o][e].forEach(t=>{"raser"==t.type&&(t.status=0)});var n=new f(this.identifier,{color:t.color,radius:t.r,x:t.x,y:t.y,seq:l.getSeq()});this.userData[o][e].push(n),this.data[o].push(n)}else if(7==t.action)this.userData[o][e].forEach(t=>{"raser"==t.type&&(t.status=0)});else if(8==t.action){if(!t.lines)return;t.lines.forEach(e=>{for(var r=0;r<this.userData[o][e.uid].length;r++){var i=this.userData[o][e.uid][r];"line"==i.type&&i.startSeq==e.seq?i.show=!!t.display:"graph"==i.type&&i.startPoint.seq==e.seq?i.show=!!t.display:"inputtext"==i.type&&i.belongSeq==e.seq&&(i.show=!!t.display)}})}else if(9==t.action){if(!t.moves)return;t.moves.forEach(t=>{for(var e=0;e<this.userData[o][t.uid].length;e++){var r=this.userData[o][t.uid][e],i=0,n=0;"line"==r.type&&r.startSeq==t.seq?(i=t.x-r.lines[0].x,n=t.y-r.lines[0].y,r.border.maxX+=i,r.border.minX+=i,r.border.maxY+=n,r.border.minY+=n,r.lines.forEach(t=>{t.x+=i,t.y+=n}),0!==r.fitCurve.length&&r.fitCurve.forEach(t=>{t[1][0]+=i,t[1][1]+=n,t[2][0]+=i,t[2][1]+=n,t[3][0]+=i,t[3][1]+=n})):"graph"==r.type&&r.startPoint.seq==t.seq?(i=t.x-r.startPoint.x,n=t.y-r.startPoint.y,r.startPoint.x+=i,r.startPoint.y+=n,r.endPoint.x+=i,r.endPoint.y+=n):"inputtext"==r.type&&r.belongSeq==t.seq&&(r.location.x=t.x,r.location.y=t.y)}})}else if(10==t.action||11==t.action||12==t.action){t.graph={10:"line",11:"oval",12:"rect"}[t.action],t.solid=!!t.fillRect,t.show=!0;var a=new h(e,t);this.userData[o][e].push(a),this.data[o].push(a)}else if(13==t.action)if((1*t.seq||0)>this.maxSeq){this.maxSeq=t.seq;for(var s=null,u=0;u<this.userData[o][e].length;u++){var p=this.userData[o][e][u];if(p.belongSeq===t.belongSeq){t.seq>p.seq&&(p.seq=t.seq),s=p;break}}s?s.text=unescape(decodeURI(t.text)):((s=new g(e,{x:t.x,y:t.y,belongSeq:t.belongSeq})).color=t.color,s.scale=t.scale,s.typeFace=t.typeFace,s.textSize=t.textSize,s.fontStyle=t.fontStyle,s.time=t.time,s.text=unescape(decodeURI(t.text)),this.userData[o][e].push(s),this.data[o].push(s))}else y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:this.maxSeq,boardId:o,method:"addData"})});else if(101==t.action)this.clearBoard(!1);else if(102==t.action)this.clearBoard(!0);else if(103==t.action)try{this.clearFileDrawData(t.fids)}catch(t){}else if(104==t.action)this.resetData();else if(t.action==i.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION)this.setBoardRatio(o,t.ratio,!1);else if(201==t.action)this.addBackgroundPic({boardIds:o,urls:t.url,type:t.type,needReport:!1,position:t.mode});else if(202==t.action)this.deleteBackgroundPic(o);else if(203==t.action)t.color&&(t.color=c.formatColor(t.color)),t.isGlobal?this.setGlobalBackgroundColor(t.color,!0):this.setBackgroundColor(t.color,!0);else if(t.action==i.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION){if((1*t.seq||0)>this.maxSeq){this.maxSeq=t.seq;let e=this.dragDataList.getDragData(o);e?this.dragDataList.updateDragData(o,{scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}):(e=new H({scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}),this.dragDataList.addDragData(o,e))}}else 401==t.action?this.resolveSwitchBoardAction(t):501==t.action&&this.resolveAddFileAction(t.file)}),this.setNeedDraw(!0)}},K.prototype.resolveSwitchBoardAction=function(t){var e=t.toBoardId,r=[],o=[];if((1*t.seq||0)>this.maxSeq){this.maxSeq=t.seq,r=t.deleteFiles||[],o=t.deleteBoards||[],r.forEach(t=>{this.deleteGroup(t,!1),o=o.concat(this.getBoardByGroup(t))}),o.forEach(t=>{this.removeBoard(t)}),this.data[e]||this.addBoard(e,!1),this.currentBoard=e;var n=c.boardId2Fid(e);this.currentGroup=n;var a=Math.max(t.page,0),s=Math.max(t.step,0),l=this.getFileInfo(n);l?(l.type===i.FILE_TYPE.H5&&v.gotoTimestampNew(this.iframeDom,{slideIndex:a,stepIndex:s,isPassive:!0}),this.updateFileInfo({fid:n,pageCount:this.getBoardByGroup(n).length,currentPageIndex:a||0,currentPageStep:s||0}),this.event.fire(this,"TEB_GOTOBOARD",e,c.boardId2Fid(e))):this.request.getFileInfo({fid:n},t=>{t&&0==t.error_code&&(l=JSON.parse(t.content),this.resolveAddFileAction(l),this.setNeedDraw(!0),setTimeout(()=>{l.type===i.FILE_TYPE.H5&&v.gotoTimestampNew(this.iframeDom,{slideIndex:a,stepIndex:s,isPassive:!0}),this.updateFileInfo({fid:n,pageCount:this.getBoardByGroup(n).length,currentPageIndex:a||0,currentPageStep:s||0}),this.event.fire(this,"TEB_GOTOBOARD",e,c.boardId2Fid(e))},200))},t=>{})}else r=t.deleteFiles||[],o=t.deleteBoards||[],r.forEach(t=>{this.deleteGroup(t,!1),o=o.concat(this.getBoardByGroup(t))}),o.forEach(t=>{this.removeBoard(t)}),y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:this.maxSeq,boardId:e,method:"addData"})})},K.prototype.resolveAddFileAction=function(t){var e=null,r=[];if(t.type===i.FILE_TYPE.H5){r=[];for(let o=0;o<t.pageCount;o++)e=`${t.platform}_${t.uid}_${t.timestamp}_${o+1}_${t.fid}`,r.push(e);this.addBoard(r,!1),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,i.FILE_TYPE.H5,0,t.ratio,t.scale)}else{var o=t.downloadURL.replace(/cos\..*\.myqcloud/gi,"preview.myqcloud");r=[];for(var n=[],a=0;a<t.pageCount;a++)e=`${t.platform}_${t.uid}_${t.timestamp}_${a+1}_${t.fid}`,r.push(e),n.push(o+"?cmd=doc_preview&of=pic&page="+(a+1));this.addBoard(r,!1),this.addBackgroundPic({boardIds:r,urls:n,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1}),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,i.FILE_TYPE.IMAGE,0,t.ratio,t.scale)}},K.prototype.addFile=function(t,e,r,o){if(Array.isArray(t)){var n,a,s,u,d,h=`#${c.getTimeStamp()}`,p=c.getSecondTime();if(n=this.createBoardIdForFile(h,this.user,p,t.length,i.PLATFORM)||[],o=(s=(a=2===this.boardContentFitMode||1===this.boardContentFitMode?c.calcRatioWidthHeight(o,i.RATIO):c.calcRatioWidthHeight(this.ratio,i.RATIO)).ratioWidth)+":"+(u=a.ratioHeight),2===this.boardContentFitMode){var f=this.containerWidth/s,g=this.containerHeight/u,m=Math.min(f,g);d=Math.max(f,g)/m*100}else this.boardContentFitMode,d=100;this.addGroup(h,e,this.user,r,t.length,0,p,i.PLATFORM,i.FILE_TYPE.IMG,0,o,d),this.addBoard(n),this.addBackgroundPic({boardIds:n,urls:t});var _={action:i.PROTOCOL_ACTION.ADD_FILE_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),file:{fid:h,title:e,downloadURL:r,pageCount:t.length,uid:this.identifier,timestamp:p,platform:i.PLATFORM,type:i.FILE_TYPE.IMG,ratio:o,scale:d}};return this.realTimeData.push(_),n.length&&this.switchFile(h),h}},K.prototype.addH5PPTFile=function(t,e,r,o,n){for(var a=!1,s=this.getGroup()||[],u=0,d=s.length;u<d;u++)if(s[u].downloadURL==t){a=!0;break}if(!a){var h,p=`#${c.getTimeStamp()}`,f=c.getSecondTime();h=this.createBoardIdForFile(p,this.user,f,r,i.PLATFORM)||[];var g,m,_,y,b=null;if(o&&n){var T=c.maxCommonDivisor(o,n);b=o/T+":"+n/T}else b=this.ratio;if(b=(m=(g=2===this.boardContentFitMode||1===this.boardContentFitMode?c.calcRatioWidthHeight(b,i.RATIO):c.calcRatioWidthHeight(this.ratio,i.RATIO)).ratioWidth)+":"+(_=g.ratioHeight),2===this.boardContentFitMode){var C=this.containerWidth/m,E=this.containerHeight/_,v=Math.min(C,E);y=Math.max(C,E)/v*100}else this.boardContentFitMode,y=100;this.addGroup(p,e,this.user,t,r,0,f,i.PLATFORM,i.FILE_TYPE.H5,0,b,y),this.addBoard(h);var S={action:i.PROTOCOL_ACTION.ADD_FILE_ACTION,time:c.getTimeStamp(),seq:l.getSeq(),file:{fid:p,title:e,downloadURL:t,pageCount:r,uid:this.identifier,timestamp:f,platform:i.PLATFORM,type:i.FILE_TYPE.H5,ratio:b,scale:y}};return this.realTimeData.push(S),h.length&&this.switchFile(p),p}},K.prototype.deleteFile=function(t=this.getCurrentFile()){if(t===i.COMMON_GROUP)return!1;var e=this.deleteGroup(t);return this.event.fire(this,"TEB_DELETEFILE",t),this.switchFile(i.COMMON_GROUP),!(!e||!e.length||(this.deleteBoard(e,t),0))},K.prototype.switchFile=function(t){for(var e=!1,r=0,o=this.groups.length;r<o;r++)if(this.groups[r].fid==t){e=!0;break}if(e){this.currentGroup=t;var i=this.getFileInfo(t),n=Math.max(0,i.currentPageIndex),a=this.getBoardByGroup(t)[n];return this.event.fire(this,"TEB_SWITCHFILE",t),this.switchBoard(a),t}return!1},K.prototype.setBoardSize=function(t,e){this.boardWidth=t,this.boardHeight=e},K.prototype.setContainerSize=function(t,e){this.containerWidth=t,this.containerHeight=e},K.prototype.setCanvasContext=function(t){this.ctx=t},K.prototype.setIframeDom=function(t){this.iframeDom=t},K.prototype.setBoardRatio=function(t,e,r=!0){this.boardRatio[t]=e;var o={};o[t]=e,r&&this.realTimeData.push({action:i.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION,seq:l.getSeq(),ratio:e}),r&&this.report.reportsetBoardRatio(o)},K.prototype.getBoardRatio=function(){if(this.getCurrentFile()===i.COMMON_GROUP)return this.boardRatio[this.currentBoard]||this.ratio;var t=this.boardRatio[this.currentBoard];if(t)return t;var e=this.getFileInfo(this.getCurrentFile());return e&&e.ratio?e.ratio:this.ratio},K.prototype.addDragData=function(t,e){var r=new H(e);this.dragDataList.addDragData(t,r)},K.prototype.getDragData=function(){return this.dragDataList.getDragData(this.currentBoard)},K.prototype.setBoardScale=function(t){t||(t=i.SCALE),t=Math.max(i.MIN_SCALE,Math.min(i.MAX_SCALE,t));var e=this.dragDataList.getDragData(this.currentBoard);e?this.dragDataList.updateDragData(this.currentBoard,{scale:t}):(e=new H({scale:t,xOffset:50,yOffset:50}),this.dragDataList.addDragData(this.currentBoard,e)),this.realTimeData.push(e.getRealTimeData()),this.report.reportDrag(Object.assign(e.getReportData(),{boardId:this.currentBoard})),this.setNeedDraw(!0)},K.prototype.getBoardScale=function(){var t,e=this.dragDataList.getDragData(this.currentBoard);if(e)t=e.scale;else{var r=this.getFileInfo(this.getCurrentFile());r&&(t=r.scale),t||(t=this.scale)}return t},K.prototype.setBoardContentFitMode=function(t){this.boardContentFitMode=t||I},K.prototype.getBoardContentFitMode=function(){return this.boardContentFitMode||I},K.prototype.updateFileInfo=function(t){for(var e=t.fid,r=!1,o=0,i=this.groups.length;o<i;o++){var n=this.groups[o];if(n.fid==e){n.title=n.title||t.title,n.pageCount=t.pageCount,n.currentPageIndex=void 0===t.currentPageIndex?n.currentPageIndex:t.currentPageIndex,n.currentPageStep=void 0===t.currentPageStep?n.currentPageStep:t.currentPageStep,n.downloadURL=n.downloadURL||t.downloadURL,n.uid=n.uid||t.uid,n.timestamp=n.timestamp||t.timestamp,n.ratio=t.ratio||n.ratio,n.scale=t.scale||n.scale,r=!0;break}}r||this.groups.push({fid:t.fid,title:t.title,pageCount:t.pageCount,currentPageIndex:t.currentPageIndex||0,currentPageStep:t.currentPageStep||0,downloadURL:t.downloadURL,uid:t.uid,timestamp:t.timestamp,type:t.type||0,ratio:t.ratio||0,scale:t.scale})},K.prototype.isExistH5PPTUrl=function(t){for(var e=!1,r=this.getGroup()||[],o=0,i=r.length;o<i;o++)if(r[o].downloadURL==t){e=!0;break}return e},K.prototype.getH5PPTByUrl=function(t){for(var e={},r=this.getGroup()||[],o=0,i=r.length;o<i;o++)if(r[o].downloadURL==t){e=r[o];break}return e};var W=K;function z(t){if(!(this instanceof z))return new z(t);this.option=Object.assign({},t),this.event=this.option.event,this.orientation=this.option.orientation||"vertical",this.classId=this.option.classId,this.canDraw=!0,"[object Undefined]"===Object.prototype.toString.call(t.drawEnable)||"[object Null]"===Object.prototype.toString.call(t.drawEnable)?this.canDraw=!0:this.canDraw=!!t.drawEnable,this.pinchScale=[],this.beforePinchScale,this.isMoving=!1,this.minLineWidth=t.minLineWidth||i.MIN_LINE_WIDTH,this.store=new W(t),this.img=t.img,this.width=this.option.width,this.height=this.option.height,this.store.setBoardSize(this.width,this.height),this.canvasComponent=this.option.canvasComponent,this.canvasDrawComponent=this.option.canvasDrawComponent,this.containerOffset=this.option.containerOffset,this.context=this.option.context,this.store.setCanvasContext(this.canvasComponent),this.touchData={onoff:!1,startx:-10,starty:-10,oldx:-10,oldy:-10,inCanvas:!1},this.init()}z.prototype.resize=function(t,e){this.width=t,this.height=e,this.store.setBoardSize(t,e),this.store.setNeedDraw(!0)},z.prototype.getEventLocation=function(t){var e={x:0,y:0};if(e.x=t.changedTouches[0].pageX-this.containerOffset.left,e.y=t.changedTouches[0].pageY-this.containerOffset.top,"vertical"===this.orientation)e.x=parseInt(e.x/this.width*1e4),e.y=parseInt(e.y/this.height*1e4);else{var r=1e4-parseInt(e.x/this.height*1e4),o=parseInt(e.y/this.width*1e4);e.x=o,e.y=r}return e},z.prototype.draw=function(){var t=this,e=this.canvasComponent,r=this.canvasDrawComponent;"horizontal"===this.orientation&&this.setCanvasTranslate(),e.clearRect(0,0,t.width,t.height),this.store.getTransparent();var o=this.store.getCurrentBoardData(),n=o.backgroundPic;n.url&&n.show?this.context.setCurrentImg(n.url,this.getCurrentBoard()):this.context.setCurrentImg("",this.getCurrentBoard()),o.backgroundColor?this.context.setBoardBgColor(o.backgroundColor):this.context.setBoardBgColor(""),function(){var r=o.data;if((r=r.sort((t,e)=>t.seq-e.seq)).forEach(r=>{if("line"==r.type&&r.show)t.drawLine(e,r);else if("raser"==r.type&&r.status){let o=0,i=0,n=0;o=r.location.x/1e4*t.width,i=r.location.y/1e4*t.height,n=r.radius/1e4*t.height,e.beginPath(),e.arc(o,i,n,0,2*Math.PI),e.setFillStyle(c.dealColor(m.COLOR.RED)),e.fill(),e.closePath()}else if("select"==r.type&&r.show){let o=0,i=0,n=0,a=0;o=r.startInfo.x/1e4*t.width,i=r.startInfo.y/1e4*t.height,n=(r.location.x-r.startInfo.x)/1e4*t.width,a=(r.location.y-r.startInfo.y)/1e4*t.height,e.setLineDash([15,5]),e.setLineWidth(1),e.setStrokeStyle(t.store.color),e.strokeRect(o,i,n,a),e.setLineDash([])}else if("graph"==r.type&&r.show){let o=0,i=0,n=0,a=0,s=0;if(o=r.startPoint.x/1e4*t.width,i=r.startPoint.y/1e4*t.height,n=r.endPoint.x/1e4*t.width,a=r.endPoint.y/1e4*t.height,s=r.thin/1e4*t.height,"line"==r.graph)e.beginPath(),e.moveTo(o,i),e.lineTo(n,a),e.setLineWidth(s),e.setStrokeStyle(r.color),e.setLineCap("round"),e.stroke();else if("rect"==r.graph){let t=o>n?n:o,l=i>a?a:i,c=o+n-2*t,u=i+a-2*l;e.setStrokeStyle(r.color),e.setLineWidth(s),r.solid?(e.setFillStyle(r.color),e.fillRect(t,l,c,u)):e.strokeRect(t,l,c,u)}else if("circle"==r.graph||"oval"==r.graph){let t=(o+n)/2,l=(i+a)/2,c=Math.abs(o-n)/2,u=Math.abs(i-a)/2;e.setStrokeStyle(r.color),e.setLineWidth(s),function(t,e,r,o,i,n,a){var s=.5522848,l=o*s,c=i*s;t.beginPath(),t.moveTo(e-o,r),t.bezierCurveTo(e-o,r-c,e-l,r-i,e,r-i),t.bezierCurveTo(e+l,r-i,e+o,r-c,e+o,r),t.bezierCurveTo(e+o,r+c,e+l,r+i,e,r+i),t.bezierCurveTo(e-l,r+i,e-o,r+c,e-o,r),t.closePath(),t.stroke(),n&&(t.setFillStyle(a),t.fill())}(e,t,l,c,u,r.solid,r.color),e.stroke()}}else if("inputtext"==r.type&&r.show){let a=Math.max(i.MIN_FONT_SIZE,Math.ceil(r.textSize/1e4*t.height));e.beginPath(),e.setFontSize(a),e.setTextBaseline("top"),e.setFillStyle(r.color);var o=c.canvasTextAutoLine(e,r.text,r.location.x/1e4*t.width,r.location.y/1e4*t.height,t.width,a);r.textHeight=o;var n=0;(r.text.split("\n")||[]).forEach(t=>{n=Math.max(n,Math.ceil(e.measureText(t).width+10))}),r.textWidth=n,e.stroke()}}),t.isMoving){var n=t.store.getSelectArea(),a=t.store.getThin();e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((n.x-a)/1e4*t.width,(n.y-a)/1e4*t.height,(n.width+2*a)/1e4*t.width,(n.height+2*a)/1e4*t.height),e.setLineDash([])}else{this.store.getSelectList().forEach(r=>{if("line"==r.type)e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((r.border.minX-2*r.thin)/1e4*t.width,(r.border.minY-2*r.thin)/1e4*t.height,(r.border.maxX-r.border.minX+4*r.thin)/1e4*t.width,(r.border.maxY-r.border.minY+4*r.thin)/1e4*t.height),e.setLineDash([]);else if("graph"==r.type){var o=r.endPoint.x,i=r.endPoint.y,n=r.startPoint.x,a=r.startPoint.y;o<n&&(o+=n,o-=n=o-n),i<a&&(i+=a,i-=a=i-a),e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((n-2*r.thin)/1e4*t.width,(a-2*r.thin)/1e4*t.height,(o-n+4*r.thin)/1e4*t.width,(i-a+4*r.thin)/1e4*t.height),e.setLineDash([])}else"inputtext"==r.type&&(e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect(r.location.x/1e4*t.width-5,r.location.y/1e4*t.height-5,r.textWidth+10,r.textSize/1e4*t.height+10),e.setLineDash([]))})}e.draw()}.apply(this),r.clearRect(0,0,this.width,this.height),r.draw(!1)},z.prototype.addBoard=function(){return this.store.switchFile(i.COMMON_GROUP),this.store.switchBoard()},z.prototype.getBoardData=function(){return JSON.parse(JSON.stringify(this.store.getData()))},z.prototype.addHistory=function(t){this.store.addHistory(t)},z.prototype.addData=function(t){this.store.addData(t)},z.prototype.deleteBoard=function(t=this.store.getCurrentBoard()){c.boardId2Fid(t)==i.COMMON_GROUP&&this.store.deleteBoard(t)},z.prototype.getBoardList=function(){return JSON.parse(JSON.stringify(this.store.getBoardList()))},z.prototype.getBoardPicList=function(){return JSON.parse(JSON.stringify(this.store.getBoardPicList()))},z.prototype.getCurrentBoard=function(){return this.store.currentBoard},z.prototype.getCurrentFile=function(){return this.store.getCurrentFile()},z.prototype.addBoard=function(){return this.store.getCurrentFile()!=i.COMMON_GROUP&&this.store.switchFile(i.COMMON_GROUP),this.store.switchBoard()},z.prototype.switchBoard=function(t,e){if(-1===this.getBoardList().indexOf(t)&&(t=i.COMMON_DEFAULT_BOARD),t){var r=c.boardId2Fid(t);if(this.getFileInfo(r).type===i.FILE_TYPE.H5){var o=this.getBoardByGroup(r).indexOf(t);v.gotoTimestampNew(this.iframeDOM,{slideIndex:o,resetStep:e,isPassive:!1})}else this.store.switchBoard(t)}else clearTimeout(this.bgH5LoadTask),this.bgH5.removeAttribute("src"),this.bgH5LoadTask=setTimeout(()=>{this.store.switchBoard(t)},50)},z.prototype.switchPage=function(t=0){return this.store.switchPage(t)},z.prototype.prevBoard=function(t){var e=this.getFileInfo(this.getCurrentFile()),r=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<1||this.switchBoard(r[e.currentPageIndex-1],t)},z.prototype.prevStep=function(){var t=this.store.getFileInfo(this.store.getCurrentFile());t.type==i.FILE_TYPE.H5?v.gotoPreviousStep(this.iframeDOM,{currentPageIndex:t.currentPageIndex,currentPageStep:t.currentPageStep}):this.prevBoard()},z.prototype.nextBoard=function(t){var e=this.getFileInfo(this.getCurrentFile()),r=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<e.pageCount-1&&this.switchBoard(r[e.currentPageIndex+1],t)},z.prototype.nextStep=function(){this.store.getFileInfo(this.store.getCurrentFile()).type==i.FILE_TYPE.H5?v.gotoNextStep(this.iframeDOM,{}):this.nextBoard()},z.prototype.setGlobalBackgroundColor=function(t){this.store.setGlobalBackgroundColor(t)},z.prototype.setBackgroundColor=function(t){this.store.setBackgroundColor(t)},z.prototype.init=function(){y.report("init",{extra_info:JSON.stringify({orientation:this.orientation,width:this.width,height:this.height})}),this.drawInterval=setInterval(()=>{if(this.store.getNeedDraw()){try{this.draw()}catch(t){this.event.fire(this,"TEB_ERROR",B,"render failed"),y.report("drawerror",{boardid:this.store.getCurrentBoard(),extra_info:t.message})}this.store.setNeedDraw(!1)}},50)},z.prototype.stopDefaultEvent=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},z.prototype.canvasTouchStart=function(t){var e=this.store.getType();"mouse"!=e?(this.stopDefaultEvent(t),this.canDraw&&(this.touchData.inCanvas=!0,this.touchData.onoff=!0,this.store.resetOperation(),this.touchData.oldx=this.touchData.startx=this.getEventLocation(t).x,this.touchData.oldy=this.touchData.starty=this.getEventLocation(t).y,"line"==e?(this.store.cancelSelect(),this.store.collectLineData().start(this.touchData.startx,this.touchData.starty)):"eraser"==e?(this.store.cancelSelect(),this.store.collectEraserData(this.touchData.startx,this.touchData.starty)):"raser"==e?(this.store.cancelSelect(),this.store.collectRaserData().start(this.touchData.startx,this.touchData.starty)):"select"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)?this.isMoving=!0:(this.store.cancelSelect(),this.store.collectSelectData().start(this.touchData.startx,this.touchData.starty)):"pointselect"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0):"keyboardinput"==e||("move"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0,this.store.collectMoverData().start(this.touchData.startx,this.touchData.starty)):e.indexOf("graph")>-1&&(this.store.cancelSelect(),this.store.collectGraphData().start(this.touchData.startx,this.touchData.starty))),1==this.isMoving&&this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0,this.store.collectMoverData().start(this.touchData.startx,this.touchData.starty)))):this.nextStep()},z.prototype.canvasTouchMove=function(t){if(this.stopDefaultEvent(t),this.canDraw){var e=this.store.getType(),r=this.store.getColor(),o=this.store.getThin(),i=this.canvasDrawComponent;if(this.touchData.onoff){var n=this.getEventLocation(t).x,a=this.getEventLocation(t).y;"line"==e?(i.beginPath(),i.moveTo(this.touchData.oldx/1e4*this.width,this.touchData.oldy/1e4*this.height),i.lineTo(n/1e4*this.width,a/1e4*this.height),i.setStrokeStyle(r),i.setLineWidth(o/1e4*this.height),i.setLineCap("round"),i.stroke(),i.draw(!0),this.store.collectLineData().draw(n,a)):"eraser"==e?this.store.collectEraserData(n,a):"raser"==e?this.store.collectRaserData().draw(n,a):"select"==e?this.store.collectSelectData().draw(n,a):"pointselect"==e||("move"==e?this.store.collectMoverData().draw(n,a,this.touchData.oldx,this.touchData.oldy):e.indexOf("graph")>-1&&this.store.collectGraphData().draw(n,a)),this.isMoving&&this.store.collectMoverData().draw(n,a,this.touchData.oldx,this.touchData.oldy),this.touchData.oldx=n,this.touchData.oldy=a}}},z.prototype.canvasTouchEnd=function(t){if(this.stopDefaultEvent(t),this.canDraw){this.touchData.onoff=!1;var e=this.store.getType(),r=this.getEventLocation(t).x,o=this.getEventLocation(t).y;if("line"==e){if(!this.touchData.inCanvas)return;this.store.collectLineData().end(r,o)}else{if("eraser"==e)return;"raser"==e?this.store.collectRaserData().end(r,o):"select"!=e||this.isMoving?"pointselect"!=e||this.isMoving?e.indexOf("graph")>-1&&this.store.collectGraphData().end(r,o):this.store.collectPointSelectData(r,o):this.store.collectSelectData().end(this.touchData.startx,this.touchData.starty,r,o)}this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo())}},z.prototype.canvasTouchCancel=function(t){if(this.stopDefaultEvent(t),this.canDraw){var e,r=this.store.getType(),o=this.getEventLocation(t).x,i=this.getEventLocation(t).y;this.touchData.inCanvas=!1,1==this.touchData.onoff&&("line"==r?(e=this.store.getThin(),o=c.getEffectivePoint(o,e),i=c.getEffectivePoint(i,e),this.store.collectLineData().over(o,i)):"raser"==r?this.store.collectRaserData().over():"select"!=r||this.isMoving?r.indexOf("graph")>-1&&(e=this.store.getThin(),o=c.getEffectivePoint(o,e),i=c.getEffectivePoint(i,e),this.store.collectGraphData().over(o,i)):this.store.collectSelectData().end(this.touchData.startx,this.touchData.starty,o,i),this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),this.touchData.onoff=!1,this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo()))}},z.prototype.setColor=function(t){this.store.setColor(t)},z.prototype.setThin=function(t){this.store.setThin(t)},z.prototype.setTextSize=function(t){this.store.setTextSize(t)},z.prototype.getTextSize=function(){return this.store.getTextSize()},z.prototype.setTextColor=function(t){this.store.setTextColor(t)},z.prototype.getTextColor=function(){return this.store.getTextColor()},z.prototype.setType=function(t){this.store.setType(m.BOARD_ACTION_TYPE[["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"][t]])},z.prototype.undo=function(){this.store.undo()},z.prototype.canUndo=function(){return this.store.canUndo()},z.prototype.redo=function(){this.store.redo()},z.prototype.canRedo=function(){return this.store.canRedo()},z.prototype.clearBoard=function(t){this.store.clearBoard(t)},z.prototype.clear=function(){this.store.clear()},z.prototype.clearDraws=function(){this.store.clearDraws()},z.prototype.clearAll=function(){this.store.clearAll()},z.prototype.addBackgroundPic=function(t,e,r){this.store.addBackgroundPic(t,e,r)},z.prototype.setBackgroundPic=function(t,e=m.FILL_MODE.DEFAULT){this.store.setBackgroundPic(t,e)},z.prototype.setBackgroundH5=function(t){this.store.setBackgroundH5(t)},z.prototype.updateCurrentFillMode=function(t=m.FILL_MODE.DEFAULT){this.store.updateCurrentFillMode(t)},z.prototype.deleteBackgroundPic=function(t){this.store.deleteBackgroundPic(t)},z.prototype.cancelBackgroundPic=function(){this.store.cancelBackgroundPic()},z.prototype.clearGlobalBgColor=function(){this.store.clearGlobalBgColor()},z.prototype.cancelSelect=function(){this.store.cancelSelect()},z.prototype.setCanDraw=function(t=!1){this.canDraw=t},z.prototype.addFile=function(t,e,r,o){return this.store.addFile(t,e,r,o)},z.prototype.addH5PPTFile=function(t){if(!this.store.isExistH5PPTUrl(t)&&this.iframeDOM.getAttribute("src")!==t)return t.indexOf("?")>-1?t+="&page=0&step=0":t+="?page=0&step=0",void this.iframeDOM.setAttribute("src",t);this.event.fire(this,"TEB_WARNING",D,t)},z.prototype.deleteFile=function(t){return this.store.deleteFile(t)},z.prototype.switchFile=function(t){t&&t!=this.store.getCurrentFile()&&(clearTimeout(this.pptH5LoadTask),this.iframeDOM.removeAttribute("src"),this.bgH5.removeAttribute("src"),this.pptH5LoadTask=setTimeout(()=>{this.store.switchFile(t)},50))},z.prototype.getGroup=function(){return this.store.getGroup()},z.prototype.getFileInfo=function(t){return this.store.getFileInfo(t)},z.prototype.getBoardByGroup=function(t){return this.store.getBoardByGroup(t)},z.prototype.clearFileDraws=function(t){return this.store.clearFileDraws(t)},z.prototype.setOrientation=function(t){this.orientation=t,this.store.setNeedDraw(!0)},z.prototype.setCanvasTranslate=function(){this.canvasComponent.translate(this.height/2,this.width/2),this.canvasComponent.rotate(.5*Math.PI),this.canvasComponent.translate(-this.width/2,-this.height/2),this.canvasDrawComponent.translate(this.height/2,this.width/2),this.canvasDrawComponent.rotate(.5*Math.PI),this.canvasDrawComponent.translate(-this.width/2,-this.height/2)},z.prototype.layout=function(){var t=this.container.clientWidth,e=this.container.clientHeight,r=this.store.getBoardRatio()||this.option.ratio,o=16,i=9;if(!1===r)this.width=t,this.height=e;else{if(void 0===r)o=16,i=9;else try{var n=r.split(":");o=1*n[0],o=isNaN(o)?16:o,i=1*n[1],i=isNaN(i)?9:i}catch(t){o=16,i=9}t/e>o/i?(this.width=e*o/i,this.height=e):(this.width=t,this.height=t*i/o)}this.width=Math.floor(this.width),this.height=Math.floor(this.height)},z.prototype.drawLine=function(t,e){var r=e.lines,o=e.color,i=e.thin;t.lineWidth=i/1e4*this.height,t.lineCap="round",t.strokeStyle=o,t.fillStyle=o;var n=this.store.getSmoothLevel();if(n>0&&e.endSeq&&!e.fitCurve.length){let t=[];e.lines.forEach(e=>{t.push([e.x,e.y])}),e.fitCurve=G(t,1e4*n,null)}if(t.beginPath(),r.length<2)return t.arc(r[0].x/1e4*this.width,r[0].y/1e4*this.height,t.lineWidth/2,0,2*Math.PI,!0),t.fill(),void t.closePath();if(t.moveTo(r[0].x/1e4*this.width,r[0].y/1e4*this.height),0===e.fitCurve.length){for(let e=1;e<r.length-2;e++){let o=r[e],i=r[e+1],n=(o.x+i.x)/2/1e4*this.width,a=(o.y+i.y)/2/1e4*this.height;t.quadraticCurveTo(o.x/1e4*this.width,o.y/1e4*this.height,n,a)}let e=r[r.length-1];t.lineTo(e.x/1e4*this.width,e.y/1e4*this.height)}else e.fitCurve.forEach(e=>{var r=e[1][0]/1e4*this.width,o=e[1][1]/1e4*this.height,i=e[2][0]/1e4*this.width,n=e[2][1]/1e4*this.height,a=e[3][0]/1e4*this.width,s=e[3][1]/1e4*this.height;t.bezierCurveTo(r,o,i,n,a,s)});t.stroke()},z.prototype.isDrawEnable=function(){return this.canDraw},z.prototype.getGlobalBackgroundColor=function(){return this.store.getGlobalBackgroundColor()},z.prototype.getBackgroundColor=function(){return this.store.getBackgroundColor()},z.prototype.getToolType=function(){var t=function(t,e=((t,e)=>t===e)){return Object.keys(m.BOARD_ACTION_TYPE).find(r=>e(m.BOARD_ACTION_TYPE[r],t))}(this.store.getType());return["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"].indexOf(t)},z.prototype.getBrushColor=function(){return this.store.getColor()},z.prototype.getBrushThin=function(){return this.store.getThin()},z.prototype.setDataSyncEnable=function(t){this.store.setDataSyncEnable(t)},z.prototype.isDataSyncEnable=function(){return this.store.isDataSyncEnable()},z.prototype.setTextFontFamily=function(t){this.store.setTextFontFamily(t)},z.prototype.getTextFontFamily=function(){return this.store.getTextFontFamily()},z.prototype.setTextFontStyle=function(t){this.store.setTextFontStyle(t)},z.prototype.getTextFontStyle=function(){return this.store.getTextFontStyle()},z.prototype.setBoardRatio=function(t){this.store.setBoardRatio(this.store.getCurrentBoard(),t),this.draw()},z.prototype.getBoardRatio=function(){return this.store.getBoardRatio()||this.option.ratio},z.prototype.setBoardScale=function(t){this.store.setBoardScale(t),this.draw()},z.prototype.getBoardScale=function(){return this.store.getBoardScale()},z.prototype.setBoardContentFitMode=function(t){this.store.setBoardContentFitMode(t)},z.prototype.getBoardContentFitMode=function(){return this.store.getBoardContentFitMode()},z.prototype.setContainerOffset=function(t){this.containerOffset=t};var Y=z;function $(){}$.prototype.on=function(t,e){return this._cbs=this._cbs||{},(this._cbs[t]||(this._cbs[t]=[])).unshift(e),this},$.prototype.off=function(t,e){if(this._cbs=this._cbs||{},!t)return this._cbs={};if(!e)return delete this._cbs[t];for(var r,o=this._cbs[t]||[];o&&~(r=o.indexOf(e));)o.splice(r,1);return this},$.prototype.fire=function(t=this,e,...r){this._cbs=this._cbs||{};var o=this._cbs[e];if(o)for(var i=o.length;i--;)o[i].apply(t,[...r]);return this};var V=$,X=r(2),J=r.n(X),Z=1,Q=2,tt=r(0),et=r.n(tt);function rt(t){this.cos=null,this.options=t,this.options.cosData=t.cosData||{},this.options.cosData.appid=t.cosData.appid||1257240443,this.options.cosData.bucket=t.cosData.bucket||this.genBucket(this.options.tlsData.sdkAppId),this.options.cosData.region=t.cosData.region||"ap-shanghai",this.options.cosData.path=t.cosData.path||"TIC/MINIPROGRAM/",this.request=new T(t),this.init(this.options),this.userDataKeyMap={},this.event=t.event}rt.prototype.init=function(t){if(et.a){var e=this;this.cos=new et.a({getAuthorization:(t,r)=>{var o=this.userDataKeyMap["/"+t.Query.prefix];this.request.getCosAuthData().then(t=>{try{if(t&&t.data&&0==t.data.error_code){var i=t.data;r({TmpSecretId:i.tmp_secret_id,TmpSecretKey:i.tmp_secret_key,XCosSecurityToken:i.session_token,ExpiredTime:i.expired_time})}else e.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:t.data.error_code,userData:o,errorMsg:`get cos securitytoken fail, ${t.data.error_msg}`})}catch(t){e.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:-1,userData:o,errorMsg:"get cos securitytoken fail"})}}).catch(t=>{e.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:-2,userData:o,errorMsg:"get cos securitytoken fail"})})}})}},rt.prototype.uploadImgFile=function(t,e){var r=c.getTimeStamp(),o=this;this.uploadCosFile(t).then(o=>{var i=t.name,n=`https://${o.Location}`,a=o.userData;e&&e(n),event.fire(this,"TEB_SETBACKGROUNDIMAGE",i,n,a),y.report("cos_upload_file",{time_consume:c.getTimeStamp()-r,extra_info:JSON.stringify({bucket:this.options.cosData.bucket,cos_appid:this.options.cosData.appid,region:this.options.cosData.region,data:o})})}).catch(e=>{var i;i="[object File]"===Object.prototype.toString.call(t)?"":t.userData,Object.assign(e,{userData:i}),o.event.fire(this,"TEB_ERROR",x,`setbackgroundimg fail, ${e}`),y.report("cos_upload_file",{action_result:1,action_info:JSON.stringify(e),time_consume:c.getTimeStamp()-r,extra_info:JSON.stringify({bucket:this.options.cosData.bucket,cos_appid:this.options.cosData.appid,region:this.options.cosData.region,userData:i})})})},rt.prototype.uploadFile=function(t,e,r){var o=this,i=c.getTimeStamp();this.uploadCosFile(t).then(r=>{var n=c.getTimeStamp(),a=0,s=function(){o.getDocTotalPage(r).then(l=>{if(200===l.statusCode&&l.header["User-ReturnCode"]){var u=1*l.header["User-ReturnCode"],d=o.getFileUrl(r,u);d.fileName=t.name,Object.assign(d,{code:0,errorMsg:"",userData:r.userData}),o.getImgNaturalSize(d.picUrls[0]).then(({width:t,height:r})=>{d.ratio=t+":"+r,e&&e(u,d),o.event.fire(this,"TEB_FILEUPLOADSTATUS",Z,d)},()=>{d.ratio=null,e&&e(u,d),o.event.fire(this,"TEB_FILEUPLOADSTATUS",Z,d)}),y.report("get_file_total_page",{time_consume:c.getTimeStamp()-i,extra_info:JSON.stringify({extra_info:{totalPage:u,info:d}})})}else a++>3?o.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:-4,userData:r.userData,errorMsg:"failed to get the total number of pages"}):setTimeout(()=>{s()},1e3),y.report("get_file_total_page",{action_result:1,action_info:JSON.stringify(l),time_consume:c.getTimeStamp()-n,extra_info:JSON.stringify({retryCount:a})})}).catch(t=>{a++>3?o.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:-4,userData:r.userData,errorMsg:"failed to get the total number of pages"}):setTimeout(()=>{s()},1e3),y.report("get_file_total_page",{action_result:1,action_info:JSON.stringify(t),time_consume:c.getTimeStamp()-n,extra_info:JSON.stringify({retryCount:a})})})};s(),y.report("cos_upload_file",{time_consume:c.getTimeStamp()-i,extra_info:JSON.stringify({bucket:this.options.cosData.bucket,cos_appid:this.options.cosData.appid,region:this.options.cosData.region,data:r})})}).catch(e=>{var r;r="[object File]"===Object.prototype.toString.call(t)?"":t.userData,y.report("cos_upload_file",{action_result:1,action_info:JSON.stringify(e),time_consume:c.getTimeStamp()-i,extra_info:JSON.stringify({bucket:this.options.cosData.bucket,cos_appid:this.options.cosData.appid,region:this.options.cosData.region,userData:r})})})},rt.prototype.uploadCosFile=function(t){var e=this;return new Promise((r,o)=>{!function(t,r,o){let i=e.options.cosData.path+c.getTimeStamp()+"_"+o.name;e.userDataKeyMap[i]=o.userData,e.cos.postObject({Bucket:e.options.cosData.bucket+"-"+e.options.cosData.appid,Region:e.options.cosData.region,Key:i,FilePath:o.path,onProgress:function(t){e.event.fire(e,"TEB_FILEUPLOADPROGRESS",Object.assign({userData:o.userData},t))}},function(i,n){n&&200===n.statusCode?(Object.assign(n,{userData:o.userData}),t(n)):(e.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:i.statusCode?i.statusCode:-3,userData:o.userData,errorMsg:JSON.stringify(i.error)}),r(i))})}(r,o,t)})},rt.prototype.addFileFromCosUrl=function(t,e,r){if(c.isCosUrl(t)){var o=c.fileDownLoadUrlToPreviewUrl(t),i=0,n=this,a=function(){n.request.getDocTotalPage(`${o}1`).then(s=>{if(200===s.statusCode&&s.header["User-ReturnCode"]){for(var l=1*s.header["User-ReturnCode"],u=[],d=0;d<l;d++)u.push(`${o}${d+1}`);var h=c.cosUrlExtractFileName(t);n.getImgNaturalSize(u[0]).then(({width:r,height:o})=>{e&&e(l,u,h,r+":"+o),n.event.fire(this,"TEB_FILEUPLOADSTATUS",Z,{code:0,errorMsg:"",fileName:h,fileUrl:t,picUrls:u})},()=>{e&&e(l,u,h,null),n.event.fire(this,"TEB_FILEUPLOADSTATUS",Z,{code:0,errorMsg:"",fileName:h,fileUrl:t,picUrls:u})})}else i++>3?(r&&r(s),n.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:-4,userData:"",errorMsg:"failed to get the total number of pages"})):setTimeout(()=>{a()},1e3)}).catch(t=>{i++>3?(r&&r(t),n.event.fire(this,"TEB_FILEUPLOADSTATUS",Q,{code:-4,userData:"",errorMsg:"failed to get the total number of pages"})):setTimeout(()=>{a()},1e3)})};a()}else r&&r()},rt.prototype.getDocTotalPage=function(t){var e=`https://${t.Location.replace(/cos\.{1}.+\.{1}myqcloud/,"preview.myqcloud")}?cmd=doc_preview&of=pic&page=1`;return this.request.getDocTotalPage(e)},rt.prototype.getFileUrl=function(t,e=0){for(var r=[],o=0;o<e;o++)r.push(`https://${t.Location.replace(/cos\.{1}.+\.{1}myqcloud/,"preview.myqcloud")}?cmd=doc_preview&of=pic&page=${o+1}`);return{picUrls:r,fileUrl:"https://"+t.Location}},rt.prototype.getInstance=function(){return this.cos},rt.prototype.genBucket=function(t){var e="edu-"+t;return J()(e).substring(0,4)+"-"+e},rt.prototype.getImgNaturalSize=function(t){return new Promise((e,r)=>{wx.getImageInfo({src:t,success(t){var r=t.width,o=t.height,i=c.maxCommonDivisor(r,o);e({width:r/i,height:o/i})},fail(){r()}})})};var ot=rt;function it(t){i.setNativeVersion("2.1.0"),i.setPlatform("miniprogram"),t.tlsData={sdkAppId:t.sdkAppId,identifier:t.userId,userSig:t.userSig},this.event=new V,t.event=this.event,this.board=new Y(t),this.fileCos=new ot(t),this.version=i.VERSION}it.EVENT={TEB_INIT:"TEB_INIT",TEB_OPERATE_CANUNDO_STATUS_CHANGED:"TEB_OPERATE_CANUNDO_STATUS_CHANGED",TEB_OPERATE_CANREDO_STATUS_CHANGED:"TEB_OPERATE_CANREDO_STATUS_CHANGED",TEB_ADDBOARD:"TEB_ADDBOARD",TEB_SYNCDATA:"TEB_SYNCDATA",TEB_ERROR:"TEB_ERROR",TEB_WARNING:"TEB_WARNING",TEB_HISTROYDATA_SYNCCOMPLETED:"TEB_HISTROYDATA_SYNCCOMPLETED",TEB_IMAGE_STATUS_CHANGED:"TEB_IMAGE_STATUS_CHANGED",TEB_H5BACKGROUND_STATUS_CHANGED:"TEB_H5BACKGROUND_STATUS_CHANGED",TEB_DELETEBOARD:"TEB_DELETEBOARD",TEB_GOTOBOARD:"TEB_GOTOBOARD",TEB_ADDH5PPTFILE:"TEB_ADDH5PPTFILE",TEB_ADDFILE:"TEB_ADDFILE",TEB_DELETEFILE:"TEB_DELETEFILE",TEB_FILEUPLOADSTATUS:"TEB_FILEUPLOADSTATUS",TEB_SWITCHFILE:"TEB_SWITCHFILE",TEB_SETBACKGROUNDIMAGE:"TEB_SETBACKGROUNDIMAGE",TEB_FILEUPLOADPROGRESS:"TEB_FILEUPLOADPROGRESS",TEB_LAYOUT:"TEB_LAYOUT"},it.TOOL_TYPE={TEDU_BOARD_TOOL_TYPE_MOUSE:0,TEDU_BOARD_TOOL_TYPE_PEN:1,TEDU_BOARD_TOOL_TYPE_ERASER:2,TEDU_BOARD_TOOL_TYPE_LASER:3,TEDU_BOARD_TOOL_TYPE_LINE:4,TEDU_BOARD_TOOL_TYPE_OVAL:5,TEDU_BOARD_TOOL_TYPE_RECT:6,TEDU_BOARD_TOOL_TYPE_OVAL_SOLID:7,TEDU_BOARD_TOOL_TYPE_RECT_SOLID:8,TEDU_BOARD_TOOL_TYPE_POINT_SELECT:9,TEDU_BOARD_TOOL_TYPE_RECT_SELECT:10,TEDU_BOARD_TOOL_TYPE_TEXT:11,TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG:12,TEDU_BOARD_TOOL_TYPE_STRAIGHT_LINE:13,TEDU_BOARD_TOOL_TYPE_ELLIPSE:14},it.prototype.on=function(t,e){this.event.on(t,e)},it.prototype.off=function(t,e){this.event.off(t,e)},it.prototype.getVersion=function(){return this.version},it.prototype.addBoard=function(t,e){var r=this.board.addBoard();return this.board.setBackgroundPic(t,e),r},it.prototype.deleteBoard=function(t){this.board.deleteBoard(t)},it.prototype.prevBoard=function(){this.board.prevBoard()},it.prototype.nextBoard=function(){this.board.nextBoard()},it.prototype.gotoBoard=function(t){t&&this.board.switchBoard(t)},it.prototype.getCurrentBoard=function(){return this.board.getCurrentBoard()},it.prototype.getBoardList=function(){return this.board.getBoardList()},it.prototype.addFile=function(t){if("[object Object]"===Object.prototype.toString.call(t))t.name,"image"===t.type?this.fileCos.uploadImgFile(t,t=>{this.board.setBackgroundPic(t)}):"file"===t.type&&this.fileCos.uploadFile(t,(t,e)=>{this.board.addFile(e.picUrls,e.fileName,e.fileUrl,e.ratio)});else if("[object String]"===Object.prototype.toString.call(t)){var e=t;this.fileCos.addFileFromCosUrl(e,(t,r,o,i)=>{this.board.addFile(r,o,e,i)},()=>{})}},it.prototype.addH5PPTFile=function(t){this.board.addH5PPTFile(t)},it.prototype.deleteFile=function(t){this.board.deleteFile(t)},it.prototype.switchFile=function(t){this.board.switchFile(t)},it.prototype.getCurrentFile=function(){return this.board.getCurrentFile()},it.prototype.getFileInfo=function(t){return this.board.getFileInfo(t)},it.prototype.getFileInfoList=function(){return this.board.getGroup()},it.prototype.getFileBoardList=function(t){return this.board.getBoardByGroup(t)},it.prototype.clearFileDraws=function(t){this.board.clearFileDraws(t)},it.prototype.reset=function(){this.board.clearAll()},it.prototype.addSyncData=function(t){this.board.addData(t)},it.prototype.setDrawEnable=function(t){this.board.setCanDraw(t)},it.prototype.isDrawEnable=function(){return this.board.isDrawEnable()},it.prototype.setGlobalBackgroundColor=function(t){this.board.setGlobalBackgroundColor(t)},it.prototype.getGlobalBackgroundColor=function(){return this.board.getGlobalBackgroundColor()},it.prototype.setBackgroundColor=function(t){this.board.setBackgroundColor(t)},it.prototype.getBackgroundColor=function(){return this.board.getBackgroundColor()},it.prototype.setToolType=function(t){this.board.setType(t)},it.prototype.getToolType=function(){return this.board.getToolType()},it.prototype.setBrushColor=function(t){this.board.setColor(t)},it.prototype.getBrushColor=function(){return this.board.getBrushColor()},it.prototype.setBrushThin=function(t){this.board.setThin(t)},it.prototype.getBrushThin=function(){return this.board.getBrushThin()},it.prototype.clear=function(t){t?this.board.clear():this.board.clearDraws()},it.prototype.setBackgroundImage=function(t,e){if("[object String]"===Object.prototype.toString.call(t))this.board.setBackgroundPic(t,e);else if("[object Object]"===Object.prototype.toString.call(t)){var r=t;this.fileCos.uploadImgFile(r,t=>{this.board.setBackgroundPic(t,e)})}},it.prototype.undo=function(){this.board.undo()},it.prototype.redo=function(){this.board.redo()},it.prototype.resize=function(t,e){this.board.resize(t,e)},it.prototype.setTextStyle=function(t){this.board.setTextFontStyle(t)},it.prototype.getTextStyle=function(){return this.board.getTextFontStyle()},it.prototype.setTextFamily=function(t){this.board.setTextFontFamily(t)},it.prototype.getTextFamily=function(){return this.board.getTextFontFamily()},it.prototype.canvasTouchStart=function(t){this.board.canvasTouchStart(t)},it.prototype.canvasTouchMove=function(t){this.board.canvasTouchMove(t)},it.prototype.canvasTouchEnd=function(t){this.board.canvasTouchEnd(t)},it.prototype.canvasTouchCancel=function(t){this.board.canvasTouchCancel(t)},it.prototype.setOrientation=function(t="vertical"){this.board.setOrientation(t)},it.prototype.setContainerOffset=function(t){this.board.setContainerOffset(t)},it.prototype.setDataSyncEnable=function(t){this.board.setDataSyncEnable(t)},it.prototype.isDataSyncEnable=function(){return this.board.isDataSyncEnable()},e.default=it}]).default});